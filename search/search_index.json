{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"HomeBudget Python wrapper","text":"<ul> <li>Overview</li> <li>Situation</li> <li>Aims</li> <li>Reference resources</li> </ul>"},{"location":"#overview","title":"Overview","text":"<p>The HomeBudget Python wrapper is a Python library and CLI that provides programmatic access to HomeBudget data. It enables full CRUD operations for expenses, income, and transfers with automatic sync to mobile devices. The wrapper is designed to be easy to use and integrate into automation scripts and workflows.</p>"},{"location":"#situation","title":"Situation","text":"<p>The HomeBudget application is a legacy application with a UI and a sqlite database backend. It is time consuming and tedious to perform routine operations such as adding, updating, deleting transactions through the Desktop UI. A proof-of-concept Python wrapper module (homebudget.py) was developed with limited functionality for adding expenses via direct calls to the sqlite database.</p>"},{"location":"#aims","title":"Aims","text":"<p>The aim of the wrapper is to</p> <ol> <li>expand the wrapper's functionality to cover more operations and features of the HomeBudget application with full CRUD operations for income, expenses, transfers and operations in foreign currencies.</li> <li>package the wrapper as a Python library that can be easily installed and used by other developers.</li> <li>provide a command-line interface (CLI) for interacting with the wrapper.</li> </ol>"},{"location":"#reference-resources","title":"Reference resources","text":"<ul> <li>HomeBudget application</li> <li>POC Python wrapper module (homebudget.py, local reference)</li> <li>hb-finances reference implementation (local reference)</li> <li>sample HB sqlite database (local reference)</li> </ul>"},{"location":"cli-guide/","title":"HomeBudget CLI Guide","text":""},{"location":"cli-guide/#table-of-contents","title":"Table of contents","text":"<ul> <li>Overview</li> <li>Setup</li> <li>Configuration</li> <li>Global options</li> <li>Expense commands</li> <li>Income commands</li> <li>Transfer commands</li> <li>Batch commands</li> <li>UI control commands</li> </ul>"},{"location":"cli-guide/#overview","title":"Overview","text":"<p>The HomeBudget CLI provides command-line access to database operations. All write operations (add, update, delete) automatically manage the HomeBudget UI to ensure data consistency.</p> <p>When sync is enabled (default):</p> <ul> <li>HomeBudget UI automatically closes before database operations</li> <li>Database changes are applied atomically while UI is closed</li> <li>HomeBudget UI automatically reopens after operations complete</li> <li>This prevents data inconsistency and database locks during updates</li> </ul>"},{"location":"cli-guide/#setup","title":"Setup","text":"<p>After setting up the virtual environment and installing dependencies, activate the main environment and run the CLI from the repository root.</p> <pre><code>source env/Scripts/activate\n</code></pre>"},{"location":"cli-guide/#configuration","title":"Configuration","text":"<p>The CLI uses a configuration file for database path and settings. For complete setup and configuration options, see Configuration Guide.</p> <p>Quick reference:</p> <ul> <li>Config location: <code>%USERPROFILE%\\OneDrive\\Documents\\HomeBudgetData\\hb-config.json</code></li> <li>Sample: <code>config/hb-config.json.sample</code></li> </ul> <p>Override config:</p> <pre><code>homebudget --db \"C:/path/to/homebudget.db\" expense list\n</code></pre>"},{"location":"cli-guide/#global-options","title":"Global options","text":"<p><code>--db PATH</code></p> <p>Override database path instead of using config file.</p> <pre><code>homebudget --db \"C:/path/to/homebudget.db\" expense list\n</code></pre> <p>Sync control:</p> <p>Sync updates are enabled by default and cannot be disabled via CLI. This ensures consistency between local and remote devices. When a write command is executed, SyncUpdate records are automatically created and the HomeBudget UI is automatically managed to prevent conflicts.</p>"},{"location":"cli-guide/#expense-commands","title":"Expense commands","text":""},{"location":"cli-guide/#add","title":"Add","text":"<p>Base currency account:</p> <pre><code>homebudget expense add \\\n  --date 2026-02-16 \\\n  --category Dining \\\n  --subcategory Restaurant \\\n  --amount 25.50 \\\n  --account Wallet \\\n  --notes \"Lunch\"\n</code></pre> <p>Foreign currency:</p> <pre><code>homebudget expense add \\\n  --date 2026-02-16 \\\n  --category Dining \\\n  --subcategory Restaurant \\\n  --currency EUR \\\n  --currency-amount 12.00 \\\n  --exchange-rate 1.10 \\\n  --account Wallet \\\n  --notes \"Lunch\"\n</code></pre>"},{"location":"cli-guide/#list","title":"List","text":"<p>With filters:</p> <pre><code>homebudget expense list \\\n  --start-date 2026-02-01 \\\n  --end-date 2026-02-28 \\\n  --account Wallet \\\n  --limit 50\n</code></pre>"},{"location":"cli-guide/#get","title":"Get","text":"<p>Retrieve by key:</p> <pre><code>homebudget expense get 13074\n</code></pre>"},{"location":"cli-guide/#update","title":"Update","text":"<p>Base currency:</p> <pre><code>homebudget expense update 13074 \\\n  --amount 27.50 \\\n  --notes \"Lunch with tip\"\n</code></pre> <p>Foreign currency:</p> <pre><code>homebudget expense update 13074 \\\n  --currency EUR \\\n  --currency-amount 15.00 \\\n  --exchange-rate 1.08 \\\n  --notes \"Lunch with tip\"\n</code></pre>"},{"location":"cli-guide/#delete","title":"Delete","text":"<pre><code>homebudget expense delete 13074 --yes\n</code></pre>"},{"location":"cli-guide/#income-commands","title":"Income commands","text":""},{"location":"cli-guide/#add_1","title":"Add","text":"<p>Base currency:</p> <pre><code>homebudget income add \\\n  --date 2026-02-28 \\\n  --name \"Salary\" \\\n  --amount 5000.00 \\\n  --account Bank \\\n  --notes \"February salary\"\n</code></pre> <p>Foreign currency:</p> <pre><code>homebudget income add \\\n  --date 2026-02-28 \\\n  --name \"Salary\" \\\n  --currency EUR \\\n  --currency-amount 4200.00 \\\n  --exchange-rate 1.19 \\\n  --account Bank \\\n  --notes \"February salary\"\n</code></pre>"},{"location":"cli-guide/#list_1","title":"List","text":"<pre><code>homebudget income list \\\n  --start-date 2026-02-01 \\\n  --end-date 2026-02-28\n</code></pre>"},{"location":"cli-guide/#get_1","title":"Get","text":"<pre><code>homebudget income get 14021\n</code></pre>"},{"location":"cli-guide/#update_1","title":"Update","text":"<p>Base currency:</p> <pre><code>homebudget income update 14021 \\\n  --notes \"Updated notes\"\n</code></pre> <p>Foreign currency:</p> <pre><code>homebudget income update 14021 \\\n  --currency EUR \\\n  --currency-amount 4500.00 \\\n  --exchange-rate 1.17 \\\n  --notes \"Updated notes\"\n</code></pre>"},{"location":"cli-guide/#delete_1","title":"Delete","text":"<pre><code>homebudget income delete 14021 --yes\n</code></pre>"},{"location":"cli-guide/#transfer-commands","title":"Transfer commands","text":"<p>Transfers support a currency normalization layer that allows flexible input for mixed-currency transfers. You can specify the amount in either the from_account or to_account currency.</p>"},{"location":"cli-guide/#add_2","title":"Add","text":"<p>Same currency:</p> <pre><code>homebudget transfer add \\\n  --date 2026-02-20 \\\n  --from-account \"Bank\" \\\n  --to-account \"Wallet\" \\\n  --amount 200.00 \\\n  --notes \"Cash withdrawal\"\n</code></pre> <p>Mixed currency, amount inferred:</p> <pre><code>homebudget transfer add \\\n  --date 2026-02-20 \\\n  --from-account \"TWH - Personal\" \\\n  --to-account \"TWH IB USD\" \\\n  --amount 200.00 \\\n  --notes \"Transfer to USD account\"\n</code></pre> <p>Mixed currency, explicit from-currency:</p> <pre><code>homebudget transfer add \\\n  --date 2026-02-20 \\\n  --from-account \"TWH IB USD\" \\\n  --to-account \"TWH - Personal\" \\\n  --currency USD \\\n  --currency-amount 150.00 \\\n  --exchange-rate 1.35 \\\n  --notes \"Transfer to SGD account\"\n</code></pre> <p>Mixed currency, explicit to-currency (normalized):</p> <pre><code>homebudget transfer add \\\n  --date 2026-02-20 \\\n  --from-account \"TWH IB USD\" \\\n  --to-account \"Cash TWH EUR\" \\\n  --currency EUR \\\n  --currency-amount 90.00 \\\n  --exchange-rate 0.92 \\\n  --notes \"Transfer to EUR account\"\n</code></pre>"},{"location":"cli-guide/#list_2","title":"List","text":"<pre><code>homebudget transfer list \\\n  --start-date 2026-02-01 \\\n  --end-date 2026-02-28\n</code></pre>"},{"location":"cli-guide/#get_2","title":"Get","text":"<pre><code>homebudget transfer get 21007\n</code></pre>"},{"location":"cli-guide/#update_2","title":"Update","text":"<pre><code>homebudget transfer update 21007 \\\n  --amount 250.00 \\\n  --notes \"Updated transfer amount\"\n</code></pre> <p>Mixed currency:</p> <pre><code>homebudget transfer update 21007 \\\n  --currency USD \\\n  --currency-amount 180.00 \\\n  --exchange-rate 1.35 \\\n  --notes \"Updated with explicit USD amount\"\n</code></pre>"},{"location":"cli-guide/#delete_2","title":"Delete","text":"<pre><code>homebudget transfer delete 21007 --yes\n</code></pre>"},{"location":"cli-guide/#batch-commands","title":"Batch commands","text":"<p>Execute multiple CRUD operations on transactions via JSON file. Run with default stop-on-error:</p> <pre><code>homebudget batch run --file operations.json\n</code></pre> <p>Run with continue-on-error:</p> <pre><code>homebudget batch run --file operations.json --continue-on-error\n</code></pre> <p>Output error report:</p> <pre><code>homebudget batch run --file operations.json --error-report batch_errors.json\n</code></pre>"},{"location":"cli-guide/#json-structure","title":"JSON structure","text":"<p>Each entry is an object with <code>resource</code> (expense, income, transfer), <code>operation</code> (add, update, delete), and <code>parameters</code> using the same fields as single-record CLI commands.</p> <pre><code>[\n  {\n    \"resource\": \"expense\",\n    \"operation\": \"add\",\n    \"parameters\": {\n      \"date\": \"2026-02-16\",\n      \"category\": \"Dining\",\n      \"subcategory\": \"Restaurant\",\n      \"amount\": \"25.50\",\n      \"account\": \"Wallet\",\n      \"notes\": \"Lunch\"\n    }\n  },\n  {\n    \"resource\": \"income\",\n    \"operation\": \"update\",\n    \"parameters\": {\n      \"key\": 14021,\n      \"notes\": \"Updated notes\"\n    }\n  },\n  {\n    \"resource\": \"transfer\",\n    \"operation\": \"delete\",\n    \"parameters\": {\n      \"key\": 21007\n    }\n  }\n]\n</code></pre>"},{"location":"cli-guide/#ui-control-commands","title":"UI control commands","text":""},{"location":"cli-guide/#start","title":"Start","text":"<pre><code>homebudget ui start\n</code></pre> <p>With custom verification settings:</p> <pre><code>homebudget ui start --verify-attempts 10 --verify-delay 0.3 --settle-time 3.0\n</code></pre>"},{"location":"cli-guide/#close","title":"Close","text":"<pre><code>homebudget ui close\n</code></pre> <p>Without verification:</p> <pre><code>homebudget ui close --no-verify\n</code></pre>"},{"location":"cli-guide/#refresh","title":"Refresh","text":"<pre><code>homebudget ui refresh\n</code></pre> <p>Without force kill:</p> <pre><code>homebudget ui refresh --no-force\n</code></pre>"},{"location":"cli-guide/#status","title":"Status","text":"<pre><code>homebudget ui status\n</code></pre>"},{"location":"configuration/","title":"Configuration Guide","text":""},{"location":"configuration/#overview","title":"Overview","text":"<p>The HomeBudget wrapper uses a JSON configuration file to manage database paths, sync settings, and forex preferences. This eliminates the need to specify these settings for every command.</p>"},{"location":"configuration/#configuration-file-location","title":"Configuration File Location","text":"<p>Default path: <pre><code>%USERPROFILE%\\OneDrive\\Documents\\HomeBudgetData\\hb-config.json\n</code></pre></p> <p>Alternative locations checked (in order):</p> <ol> <li>Path specified by <code>HB_CONFIG</code> environment variable</li> <li>Default path shown above</li> </ol>"},{"location":"configuration/#configuration-file-format","title":"Configuration File Format","text":"<p>Complete configuration example:</p> <pre><code>{\n  \"db_path\": \"C:\\\\Users\\\\taylo\\\\OneDrive\\\\Documents\\\\HomeBudgetData\\\\Data\\\\homebudget.db\",\n  \"sync_enabled\": true,\n  \"base_currency\": \"SGD\",\n  \"forex\": {\n    \"cache_ttl_hours\": 1\n  }\n}\n</code></pre>"},{"location":"configuration/#configuration-fields","title":"Configuration Fields","text":"Field Type Required Default Description <code>db_path</code> string Yes N/A Absolute path to HomeBudget database file <code>sync_enabled</code> boolean No <code>true</code> Enable/disable SyncUpdate creation <code>base_currency</code> string No From DB Base currency code (e.g., \"SGD\", \"USD\") <code>forex.cache_ttl_hours</code> number No <code>1</code> Forex rate cache validity in hours <p>Default database path: <pre><code>%USERPROFILE%\\OneDrive\\Documents\\HomeBudgetData\\Data\\homebudget.db\n</code></pre></p>"},{"location":"configuration/#setup-instructions","title":"Setup Instructions","text":""},{"location":"configuration/#first-time-setup","title":"First-Time Setup","text":"<p>Create configuration directory and file:</p> <pre><code># Windows PowerShell\n$configDir = \"$env:USERPROFILE\\OneDrive\\Documents\\HomeBudgetData\"\nNew-Item -ItemType Directory -Force -Path $configDir\nCopy-Item config\\hb-config.json.sample \"$configDir\\hb-config.json\"\n</code></pre> <p>Edit the configuration file:</p> <p>Open <code>%USERPROFILE%\\OneDrive\\Documents\\HomeBudgetData\\hb-config.json</code> and update:</p> <ol> <li>Set <code>db_path</code> to your operational HomeBudget database location</li> <li>Verify <code>base_currency</code> matches your database</li> <li>Adjust <code>sync_enabled</code> if needed (default: <code>true</code>)</li> </ol>"},{"location":"configuration/#uat-user-acceptance-testing-setup","title":"UAT (User Acceptance Testing) Setup","text":"<p>For UAT tests with live database and mobile sync:</p> <ul> <li>Set <code>db_path</code> to operational database</li> <li>Set <code>sync_enabled</code> to <code>true</code></li> <li>Ensure HomeBudget apps (Windows and mobile) use the same database</li> </ul>"},{"location":"configuration/#sit-system-integration-testing-setup","title":"SIT (System Integration Testing) Setup","text":"<p>For SIT tests with headless fixtures:</p> <ul> <li>No configuration file needed</li> <li>Tests use fixtures from <code>tests/fixtures/</code></li> <li>Configuration is ignored during SIT</li> </ul>"},{"location":"configuration/#using-configuration","title":"Using Configuration","text":""},{"location":"configuration/#with-methods","title":"With methods","text":"<p>Configuration is loaded automatically when creating a client:</p> <pre><code>from homebudget import HomeBudgetClient\n\n# Uses config file automatically\nwith HomeBudgetClient() as client:\n    expenses = client.list_expenses()\n</code></pre> <p>Override with explicit path:</p> <pre><code># Ignore config file, use explicit path\nwith HomeBudgetClient(db_path=\"C:/path/to/homebudget.db\") as client:\n    expenses = client.list_expenses()\n</code></pre>"},{"location":"configuration/#with-cli","title":"With CLI","text":"<p>Configuration is loaded automatically for all commands:</p> <pre><code># Uses config file automatically\nhomebudget expense list --limit 10\n</code></pre> <p>Override with <code>--db</code> flag:</p> <pre><code># Ignore config file, use explicit path\nhomebudget --db \"C:\\path\\to\\homebudget.db\" expense list\n</code></pre>"},{"location":"configuration/#configuration-behavior","title":"Configuration Behavior","text":""},{"location":"configuration/#loading-priority","title":"Loading Priority","text":"<p>The wrapper loads configuration in this order (first found wins):</p> <ol> <li>Explicit parameter: Methods <code>db_path</code> parameter or CLI <code>--db</code> flag</li> <li>Environment variable: <code>HB_CONFIG</code> pointing to config file</li> <li>Default location: <code>%USERPROFILE%\\OneDrive\\Documents\\HomeBudgetData\\hb-config.json</code></li> </ol>"},{"location":"configuration/#sync-control","title":"Sync Control","text":"<p>Sync behavior is determined by configuration:</p> <ol> <li>Config file: <code>sync_enabled</code> setting (default: <code>true</code>)</li> <li>Default: <code>true</code> if not specified</li> </ol> <p>Sync is always enabled via CLI and cannot be disabled to ensure consistency between local and remote devices.</p>"},{"location":"configuration/#missing-configuration","title":"Missing Configuration","text":"<p>If no configuration file exists:</p> <ul> <li>Methods: Must provide <code>db_path</code> parameter, or will raise error</li> <li>CLI: Must provide <code>--db</code> flag, or will raise error</li> </ul>"},{"location":"configuration/#sample-configuration-file","title":"Sample Configuration File","text":"<p>A complete sample is provided at <code>config/hb-config.json.sample</code>:</p> <pre><code>{\n  \"db_path\": \"C:\\\\Users\\\\USERNAME\\\\OneDrive\\\\Documents\\\\HomeBudgetData\\\\Data\\\\homebudget.db\",\n  \"sync_enabled\": true,\n  \"base_currency\": \"SGD\",\n  \"forex\": {\n    \"cache_ttl_hours\": 1\n  }\n}\n</code></pre> <p>To use:</p> <ol> <li>Copy to the default location</li> <li>Replace <code>USERNAME</code> with your actual username</li> <li>Adjust paths and currency as needed</li> </ol>"},{"location":"configuration/#troubleshooting","title":"Troubleshooting","text":""},{"location":"configuration/#config-file-not-found-error","title":"\"Config file not found\" Error","text":"<p>Problem: CLI or methods cannot locate configuration file.</p> <p>Solution:</p> <ul> <li>Check file exists at default location</li> <li>Verify path in error message</li> <li>Use <code>--db</code> flag or <code>db_path</code> parameter as workaround</li> </ul>"},{"location":"configuration/#database-path-not-in-config-error","title":"\"Database path not in config\" Error","text":"<p>Problem: Config file exists but <code>db_path</code> field is missing.</p> <p>Solution:</p> <ul> <li>Open config file</li> <li>Add <code>\"db_path\": \"C:\\\\path\\\\to\\\\homebudget.db\"</code></li> <li>Ensure path uses double backslashes on Windows</li> </ul>"},{"location":"configuration/#sync-not-working","title":"Sync Not Working","text":"<p>Problem: Changes don't appear in mobile app.</p> <p>Solution:</p> <ul> <li>Verify <code>sync_enabled: true</code> in config</li> <li>Confirm DeviceInfo exists in database</li> <li>Verify mobile app uses same database</li> </ul>"},{"location":"configuration/#related-documentation","title":"Related Documentation","text":"<ul> <li>User Guide - Getting started and usage examples</li> <li>Developer Guide - Development workflow and testing</li> <li>CLI Guide - Command-line usage examples</li> <li>Sync Update Mechanism - How sync works</li> </ul>"},{"location":"dependencies/","title":"Dependencies","text":""},{"location":"dependencies/#requests","title":"Requests","text":"<p>The project relies on the requests library for the forex rates fetch feature.</p>"},{"location":"design/","title":"HomeBudget wrapper design","text":""},{"location":"design/#table-of-contents","title":"Table of contents","text":"<ul> <li>Overview</li> <li>Scope and sources</li> <li>Architecture summary</li> <li>Module structure</li> <li>Methods surface and data objects</li> <li>User configuration</li> <li>Schema mapping</li> <li>Idempotency and conflict policy</li> <li>Sync update design</li> <li>CLI design</li> <li>Forex input rules</li> <li>Packaging and repository layout</li> <li>Testing and validation strategy</li> <li>Rollout plan and success metrics</li> <li>Deprecated design files</li> </ul>"},{"location":"design/#overview","title":"Overview","text":"<p>This document consolidates the wrapper design steps into a single reference. It captures the methods surface, schema mapping, sync update approach, and validation strategy.</p>"},{"location":"design/#scope-and-sources","title":"Scope and sources","text":"<p>Scope</p> <ul> <li>Wrapper design for SQLite based HomeBudget data</li> <li>Expenses and income operations</li> <li>Sync update support for Issue 001</li> <li>CLI command design and workflow alignment</li> <li>UI control for managing HomeBudget application during database operations</li> </ul> <p>Primary sources</p> <ul> <li>docs/sqlite-schema.md</li> <li>docs/sync-update.md</li> <li>docs/workflow.md</li> <li>docs/test-cases.md</li> <li>HomeBudget Windows guide (local reference)</li> <li>hb-finances reference implementation (local reference)</li> </ul> <p>Related implementation guides</p> <ul> <li>docs/user-guide.md</li> <li>docs/developer-guide.md</li> <li>docs/methods.md</li> </ul>"},{"location":"design/#architecture-summary","title":"Architecture summary","text":"<ul> <li>Package name is homebudget with library and CLI interfaces</li> <li>HomeBudgetClient is the primary entry point</li> <li>Data objects are typed dataclasses for validation and clarity</li> <li>Repository layer handles SQLite operations and transactions</li> <li>SyncUpdateManager writes sync payloads in the same transaction</li> </ul>"},{"location":"design/#module-structure","title":"Module structure","text":"<pre><code>src/python/homebudget/\n  __init__.py\n  __version__.py\n  client.py\n  models.py\n  sync.py\n  repository.py\n  schema.py\n  exceptions.py\n  persistence.py\n  ui_control.py\n  cli/\n    __init__.py\n    main.py\n    expense.py\n    income.py\n    ui.py\n    common.py\n</code></pre>"},{"location":"design/#methods-surface-and-data-objects","title":"Methods surface and data objects","text":"<p>Public methods interface</p> <ul> <li>HomeBudgetClient with context manager support</li> </ul> <p>Transaction data objects</p> <ul> <li>ExpenseDTO: Validated expense input for persistence</li> <li>IncomeDTO: Validated income input for persistence</li> <li>TransferDTO: Validated transfer input for persistence with currency normalization</li> </ul> <p>Batch operation data objects</p> <ul> <li>BatchOperation: Single batch operation for mixed resource workflows</li> <li>BatchOperationResult: Result of mixed batch operation run</li> <li>BatchResult: Result of single-resource batch operation</li> </ul> <p>Reference data objects</p> <ul> <li>Account, Category, SubCategory, Currency querying supported</li> </ul> <p>UI Control</p> <ul> <li>HomeBudgetUIController provides methods to open, close, and check status of the HomeBudget UI</li> <li>Client integrates UI control with transactions when enable_ui_control is set</li> <li>UI control automatically closes UI before database operations and reopens after</li> </ul> <p>Method list reference</p> <ul> <li>See docs/methods.md</li> </ul>"},{"location":"design/#user-configuration","title":"User configuration","text":"<p>The wrapper uses a JSON configuration file for database path, sync settings, and forex preferences. For complete configuration documentation, see Configuration Guide.</p> <p>Configuration file location: <pre><code>%USERPROFILE%\\OneDrive\\Documents\\HomeBudgetData\\hb-config.json\n</code></pre></p> <p>Configuration behavior:</p> <ul> <li>Client and CLI load config automatically when present</li> <li>Explicit <code>db_path</code> parameter or <code>--db</code> flag overrides config</li> <li>Sync is always enabled via CLI to ensure consistency between devices</li> </ul>"},{"location":"design/#schema-mapping","title":"Schema mapping","text":"<p>Core tables</p> <ul> <li>Expense, Income, Transfer, AccountTrans, Account, Category, SubCategory, Currency</li> </ul> <p>Supporting tables</p> <ul> <li>SyncInfo, SyncUpdate, DeviceInfo, Settings</li> </ul> <p>Mapping highlights</p> <ul> <li>AccountTrans links transaction tables with transType and transKey</li> <li>Currency values are stored as text and parsed to decimal</li> <li>Account currency is required for linked transactions</li> </ul>"},{"location":"design/#idempotency-and-conflict-policy","title":"Idempotency and conflict policy","text":"<ul> <li>Duplicate detection uses composite field matching</li> <li>DuplicateError is raised on exact composite match</li> <li>No automatic override, user resolves duplicates manually</li> <li>Composite fields include date, account, amount, currency, category or name, notes</li> </ul>"},{"location":"design/#sync-update-design","title":"Sync update design","text":"<ul> <li>Sync updates are written for create, update, and delete operations</li> <li>Payload encoding uses JSON, zlib, and base64</li> <li>DeviceInfo provides primary device identity</li> <li>Sync updates are written in the same transaction as data writes</li> <li>Batch operations perform one sync update step after the batch completes</li> </ul>"},{"location":"design/#cli-design","title":"CLI design","text":"<ul> <li>Command groups for expense, income, transfer, batch, sync, and ui</li> <li>Global options include db path and sync toggle</li> <li>UI control commands support managing the HomeBudget application</li> <li>Batch operations support CSV/JSON import for single resources and mixed-operation JSON</li> <li>Transfer operations support currency normalization layer for flexible user input</li> </ul>"},{"location":"design/#forex-input-rules","title":"Forex input rules","text":"<p>Forex inputs follow one of three paths: base currency path for expenses/income, base currency or foreign currency path for expenses/income, and transfer path.</p>"},{"location":"design/#expenses-and-income","title":"Expenses and Income","text":"<p>User Input Semantics</p> <p>When users specify <code>--amount</code>, the semantic meaning depends on the account:</p> <ul> <li>For base currency accounts (SGD): <code>--amount</code> = amount in base currency</li> <li>For non-base currency accounts (USD, RUB, etc.): <code>--amount</code> = amount in that account's currency</li> </ul> <p>When specifying <code>--currency-amount</code>, the user must also provide <code>--currency</code> and <code>--exchange-rate</code>:</p> <ul> <li><code>--currency</code>: The foreign currency code</li> <li><code>--currency-amount</code>: The amount in that foreign currency</li> <li><code>--exchange-rate</code>: The exchange rate from foreign to base currency</li> <li>Backend calculates: <code>base_amount = currency_amount \u00d7 exchange_rate</code></li> </ul> <p>Backend internally supports specifying any currency with currency_amount and exchange_rate, allowing flexible forex conversions even for accounts not in that currency.</p> <p>Input validation rules:</p> <ul> <li>Provide amount only: Currency defaults to account currency, currency amount set to amount</li> <li>Provide currency, currency amount, and exchange rate: Amount calculated as currency amount times exchange rate</li> <li>Do not provide both amount and currency amount</li> </ul>"},{"location":"design/#transfers","title":"Transfers","text":"<p>Transfers use a currency normalization layer that accepts user currency specifications for either the from_account or to_account, and converts to the backend standard format.</p> <p>Backend Storage Format (Constraint)</p> <p>The Transfer table enforces a strict constraint:</p> <ul> <li><code>currency</code>: Always equals from_account currency (constraint enforced at backend)</li> <li><code>currency_amount</code>: Amount in from_account currency (from_amount)</li> <li><code>amount</code>: Amount in to_account currency (to_amount)</li> </ul> <p>User Input Modes</p> <p>Users can specify transfers in three ways:</p> <ol> <li>Amount Only (Inference): Provide only <code>--amount</code>. System infers currency based on account types:</li> <li>If base currency in either account \u2192 amount is in base currency</li> <li> <p>If base in neither account \u2192 amount is in from_account currency</p> </li> <li> <p>From-Currency Explicit: Provide <code>--currency</code> + <code>--currency-amount</code> matching from_account</p> </li> <li> <p>Already in backend format \u2192 passes through unchanged</p> </li> <li> <p>To-Currency Explicit: Provide <code>--currency</code> + <code>--currency-amount</code> matching to_account</p> </li> <li>Normalized to backend format using inverse forex calculation</li> <li><code>from_amount = to_amount / forex_rate</code> or cross-rate as appropriate</li> </ol> <p>Normalization Layer Architecture</p> <p>The normalization happens in <code>client.py \u2192 _infer_currency_for_transfer()</code>:</p> <ol> <li>Accepts flexible user input (currency can match either account)</li> <li>Validates: currency must match one of the two accounts (not a third currency)</li> <li>If currency matches to_account, calculates inverse to get from_amount</li> <li>Returns TransferDTO in backend format (currency = from_account)</li> <li>Backend validation (<code>_validate_transfer_currency_constraint</code>) enforces the constraint</li> </ol> <p>For detailed normalization rules and examples, see docs/transfer-currency-normalization.md.</p> <p>Transfer Input Semantics Examples</p> <p>When specifying <code>--amount</code>:</p> <ul> <li>If base currency is in either account: <code>--amount</code> = amount in base currency</li> <li>If base currency is in neither account: <code>--amount</code> = amount in from_account currency</li> </ul> <p>This provides intuitive behavior: users think in base currency when it's involved, and in local currency otherwise.</p> <p>Case 1: Transfer from base (SGD) to foreign (USD)</p> <ul> <li>User provides <code>--amount</code> in base currency (SGD)</li> <li>Backend infers:</li> <li><code>currency=SGD</code> (from_account currency)</li> <li><code>currency_amount=amount</code> (amount in SGD)</li> <li> <p><code>amount=amount/rate</code> (amount in USD)</p> </li> <li> <p>AccountTrans:</p> </li> <li>from_account (SGD): <code>transAmount=currency_amount</code> (100 SGD)</li> <li>to_account (USD): <code>transAmount=amount</code> (74.07 USD)</li> </ul> <p>Case 2: Transfer from foreign (USD) to base (SGD)</p> <ul> <li>User provides <code>--amount</code> in base currency (SGD to receive)</li> <li>Backend infers:</li> <li><code>currency=USD</code> (from_account currency)</li> <li><code>currency_amount=amount/rate</code> (amount in USD)</li> <li> <p><code>amount=amount</code> (amount in SGD)</p> </li> <li> <p>AccountTrans:</p> </li> <li>from_account (USD): <code>transAmount=currency_amount</code> (74.07 USD)</li> <li>to_account (SGD): <code>transAmount=amount</code> (100 SGD)</li> </ul> <p>Case 3: Transfer between two foreign accounts (USD to EUR)</p> <ul> <li>User provides <code>--amount</code> in from_account currency (USD to send)</li> <li>Backend infers:</li> <li><code>currency=USD</code> (from_account currency)</li> <li><code>currency_amount=amount</code> (amount in USD)</li> <li> <p><code>amount=amount \u00d7 (usd_rate \u00f7 eur_rate)</code> (amount in EUR)</p> </li> <li> <p>AccountTrans:</p> </li> <li>from_account (USD): <code>transAmount=currency_amount</code> (100 USD)</li> <li>to_account (EUR): <code>transAmount=amount</code> (90 EUR)</li> </ul> <p>When specifying <code>--currency-amount</code> for transfers:</p> <ul> <li><code>--currency</code> and <code>--currency-amount</code> together with <code>--exchange-rate</code> required</li> <li><code>--currency</code> must match one of the transfer accounts</li> <li>Backend derives the missing amounts using cross-rate calculation: <code>from_amount = to_amount \u00d7 (from_rate \u00f7 to_rate)</code></li> </ul> <p>CLI and client methods enforce these rules to prevent ambiguous inputs.</p>"},{"location":"design/#batch-operations-design","title":"Batch operations design","text":"<p>The wrapper supports two types of batch operations:</p>"},{"location":"design/#single-resource-batch-import","title":"Single-Resource Batch Import","text":"<p>Import multiple transactions of the same type from CSV or JSON files:</p> <ul> <li><code>add_expenses_batch()</code>, <code>add_incomes_batch()</code>, <code>add_transfers_batch()</code> methods</li> <li><code>hb expense batch-import</code>, <code>hb income batch-import</code>, <code>hb transfer batch-import</code> CLI commands</li> <li>Support CSV and JSON file formats</li> <li>Each transaction validated independently before insertion</li> <li>Sync optimization: Single SyncUpdate created after batch completes (not per transaction)</li> </ul>"},{"location":"design/#mixed-resource-batch-operations","title":"Mixed-Resource Batch Operations","text":"<p>Execute multiple operations across different resources in a single atomic batch:</p> <ul> <li><code>batch()</code> method accepting list of <code>BatchOperation</code> objects</li> <li><code>hb batch run</code> CLI command with JSON file input</li> <li>Supports add, update, delete operations for expense, income, transfer resources</li> <li>Continue-on-error mode (default) or stop-on-error mode</li> <li>Returns <code>BatchOperationResult</code> with successful and failed operations</li> <li>Single SyncUpdate created after batch completes</li> </ul> <p>Batch Behavior:</p> <ul> <li>Each individual transaction insert is atomic</li> <li>Sync optimization: Batch operations create one sync entry after completion, not per transaction</li> <li>Error handling: By default continues on error and reports failures at end</li> <li>Validation: Each record validated same as single-record operations</li> <li>Transaction atomicity: Each insert is atomic, but batch as whole may partially succeed</li> </ul> <p>Example Mixed Batch JSON: <pre><code>[\n  {\n    \"resource\": \"expense\",\n    \"operation\": \"add\",\n    \"parameters\": {\n      \"date\": \"2026-02-20\",\n      \"category\": \"Food (Basic)\",\n      \"subcategory\": \"Restaurant\",\n      \"amount\": 25.50,\n      \"account\": \"TWH - Personal\"\n    }\n  },\n  {\n    \"resource\": \"transfer\",\n    \"operation\": \"add\",\n    \"parameters\": {\n      \"date\": \"2026-02-20\",\n      \"from_account\": \"TWH - Personal\",\n      \"to_account\": \"TWH IB USD\",\n      \"amount\": 100.00\n    }\n  }\n]\n</code></pre></p>"},{"location":"design/#packaging-and-repository-layout","title":"Packaging and repository layout","text":"<p>Packaging</p> <ul> <li>Source layout under src/python/homebudget</li> <li>Entry points for homebudget and hb commands</li> </ul> <p>Repository layout highlights</p> <ul> <li>docs contains design and reference documentation</li> <li>tests contains unit and integration tests with fixtures</li> <li>reference contains the original wrapper and sample databases</li> </ul>"},{"location":"design/#testing-and-validation-strategy","title":"Testing and validation strategy","text":"<p>Automated tests</p> <ul> <li>Unit tests for models, schema, exceptions, and helpers</li> <li>Integration tests for CRUD and sync flows</li> <li>CLI tests for command behaviors</li> </ul> <p>Manual validation</p> <ul> <li>Sync validation in HomeBudget desktop and mobile apps</li> </ul> <p>Coverage target</p> <ul> <li>85 percent line coverage minimum</li> </ul> <p>Pre-release checklist</p> <ul> <li>Full test suite passes with coverage target</li> <li>Manual sync validation recorded as pass</li> <li>Workflow validation matches docs/workflow.md</li> <li>Package build and install verified</li> <li>CLI version command works</li> </ul>"},{"location":"design/#rollout-plan-and-success-metrics","title":"Rollout plan and success metrics","text":"<p>Implementation phases</p> <ul> <li>Foundation, transaction CRUD, sync integration, CLI, and batch operations</li> </ul> <p>Success metrics</p> <ul> <li>Full CRUD operations for expenses, income, and transfers</li> <li>Sync updates propagate to mobile devices</li> <li>Test coverage meets or exceeds target</li> <li>CLI commands align with workflows</li> </ul>"},{"location":"design/#deprecated-design-files","title":"Deprecated design files","text":"<p>The following design step files are deprecated after Step 1 is complete. Use this document for ongoing work.</p> <ul> <li>docs/develop/plan-wrapper-design-step2.md</li> <li>docs/develop/plan-wrapper-design-step3.md</li> <li>docs/develop/plan-wrapper-design-step4.md</li> <li>docs/develop/plan-wrapper-design-step5.md</li> <li>docs/develop/plan-wrapper-design-step6.md</li> <li>docs/develop/plan-wrapper-design-step7.md</li> <li>docs/develop/plan-wrapper-design-step8.md</li> <li>docs/develop/plan-wrapper-design-step9.md</li> <li>docs/develop/plan-wrapper-design-summary.md</li> </ul>"},{"location":"developer-guide/","title":"HomeBudget wrapper developer guide","text":""},{"location":"developer-guide/#table-of-contents","title":"Table of contents","text":"<ul> <li>Overview</li> <li>Environments</li> <li>Setup</li> <li>Development workflow</li> <li>Configuration</li> <li>Testing</li> <li>Manual validation</li> <li>Fixtures and test data</li> <li>Troubleshooting</li> <li>Reference documents</li> </ul>"},{"location":"developer-guide/#overview","title":"Overview","text":"<p>This guide supports implementation work for the wrapper. It focuses on local setup, test workflow, and support considerations for development.</p>"},{"location":"developer-guide/#environments","title":"Environments","text":"<p>Use env for all wrapper work. Use .dev env only for helper scripts and diagnostics.</p>"},{"location":"developer-guide/#setup","title":"Setup","text":"<p>Run the setup script to create or update env and install requirements.</p> <p>Windows</p> <pre><code>\\.scripts\\cmd\\setup-env.cmd\n.\\env\\Scripts\\activate\n</code></pre> <p>Bash</p> <pre><code>./.scripts/bash/setup-env.sh\nsource env/bin/activate\n</code></pre> <p>use a separate python interpreter environment for development work to avoid conflicts with the HomeBudget app.  use scripts in <code>.dev/.scripts/*</code> and interpreter at <code>.dev/env</code> and requirements in <code>.dev/requirements.txt</code> for development utilities and diagnostics to keep them separate from the main wrapper code and dependencies. This prevents conflicts with the HomeBudget app's Python environment and allows for safe experimentation with helper tools without risking stability of the wrapper or the app.</p>"},{"location":"developer-guide/#development-workflow","title":"Development workflow","text":"<p>Follow the TDD cycle for each feature.</p> <ul> <li>Document the feature in user guide and example docs</li> <li>Write tests and confirm they fail</li> <li>Implement the feature and pass tests</li> <li>Validate with manual steps when sync is involved</li> <li>Refactor and update documentation</li> <li>Keep validation logic in shared utilities for single add and batch operations</li> </ul>"},{"location":"developer-guide/#configuration","title":"Configuration","text":"<p>The wrapper uses a configuration file for database path and settings. See the Configuration Guide for complete setup instructions and all configuration options.</p>"},{"location":"developer-guide/#testing","title":"Testing","text":"<p>Run unit and integration tests using pytest.</p> <pre><code>pytest tests/unit -v\npytest tests/integration -v\n</code></pre> <p>Run tests for a single feature when needed.</p> <pre><code>pytest tests/integration/test_expense_crud.py -v\n</code></pre>"},{"location":"developer-guide/#manual-validation","title":"Manual validation","text":"<p>Manual validation is required for sync confirmation in the HomeBudget apps. Use the manual test procedures in tests/manual and record results.</p> <p>Key manual test artifacts:</p> <ul> <li><code>tests/manual/manual_tests.json</code>: Comprehensive UAT test suite definitions</li> <li><code>tests/manual/manual_test_runner.py</code>: Test runner for executing UAT tests</li> <li><code>tests/manual/run_uat_tests.py</code>: Batch UAT test execution</li> <li><code>tests/manual/TRANSFER_TEST_CASES.md</code>: 6 transfer test cases covering valid and invalid scenarios</li> <li><code>tests/manual/BATCH_TRANSFER_TEST_CASES.md</code>: Batch transfer tests with currency normalization</li> <li><code>tests/manual/sync_validation_procedure.md</code>: Sync validation workflow</li> </ul> <p>Running UAT tests:</p> <pre><code># Run a specific UAT test\npython tests/manual/manual_test_runner.py --test-id uat_expense_crud\n</code></pre> <p>Focus areas for UAT:</p> <ul> <li>Sync behavior: Verify SyncUpdate creation and propagation to mobile devices</li> <li>Mixed currency transfers: Test currency normalization layer with all input modes</li> <li>Batch operations: Test CSV/JSON import and mixed-operation batches with sync optimization</li> <li>Forex handling: Verify automatic rate fetching and caching</li> </ul>"},{"location":"developer-guide/#fixtures-and-test-data","title":"Fixtures and test data","text":"<p>System integration tests use headless test databases stored in tests/fixtures (test_database.db, sync_test.db, empty_database.db). SIT tests must copy fixtures into a temporary working directory before writing data.</p> <p>User acceptance tests use the live operational HomeBudget database configured in the user's environment and connected to the HomeBudget Windows and mobile apps.</p>"},{"location":"developer-guide/#troubleshooting","title":"Troubleshooting","text":"<ul> <li>Setup script fails. Confirm Python 3.10 or later is in PATH and rerun the script.</li> <li>Tests fail with database locked. Close the HomeBudget app and rerun the tests.</li> <li>Sync validation fails. Confirm DeviceInfo is present and sync is enabled for the command.</li> </ul>"},{"location":"developer-guide/#reference-documents","title":"Reference documents","text":"<ul> <li>design</li> <li>user guide</li> <li>methods</li> <li>sync update</li> <li>workflow</li> </ul>"},{"location":"forex-rates/","title":"Forex Rates Feature Design","text":""},{"location":"forex-rates/#table-of-contents","title":"Table of contents","text":"<ul> <li>Overview</li> <li>Terminology</li> <li>Requirements</li> <li>API service selection</li> <li>Data structure and storage</li> <li>Caching and TTL strategy</li> <li>Fallback mechanism</li> <li>Integration points</li> <li>Architecture</li> <li>Error handling</li> <li>Configuration</li> <li>Appendix: Alternative API providers</li> </ul>"},{"location":"forex-rates/#overview","title":"Overview","text":"<p>The forex rates feature enables the HomeBudget wrapper to fetch current foreign exchange rates for non-base currency transactions. This feature supports the existing foreign currency input rules by providing automatic rate lookups and caching to handle offline scenarios and reduce API calls.</p>"},{"location":"forex-rates/#use-case","title":"Use case","text":"<p>When users record expenses or income in foreign currencies, for example: USD amounts in a SGD-base-currency account, they need to convert between currencies using current exchange rates. Instead of manually entering rates, this feature:</p> <ol> <li>Fetches current rates from a public API</li> <li>Caches rates locally with timestamps</li> <li>Serves cached rates within an hour without additional API calls</li> <li>Falls back to 1.0 when offline or data is unavailable</li> </ol>"},{"location":"forex-rates/#concept","title":"Concept","text":"<p>The primary conversion path leverages USD as an intermediary:</p> <ul> <li>Fetch rates for all currencies against USD</li> <li>Calculate conversion between any two currencies using the formula: <code>CURRENCY_A.USD / CURRENCY_B.USD</code></li> <li>Example: To convert SGD to USD, use the quoted rate directly. To convert SGD to EUR, calculate the EUR and SGD rates against USD</li> </ul>"},{"location":"forex-rates/#terminology","title":"Terminology","text":"<ul> <li>Base currency: The primary currency of the user's budget (e.g., SGD)</li> <li>Reference currency: USD, used as a common denominator for all exchange rates fetched from the API. Referred to as \"base\" in API responses but distinct from the user's base currency.</li> <li>Foreign currency: Any currency other than the base currency (e.g., USD, EUR)</li> <li>Forex rate: also \"exchange rate\". The exchange rate between a foreign currency and the base currency, expressed as a decimal (e.g., 1 USD = 1.35 SGD \u2192 rate = 1.35)</li> <li>Cache TTL: Time-to-live for cached rates, after which they are considered stale and a fresh API fetch is triggered</li> <li>Fallback rate: The default rate of 1.0 used when no valid rate is available, meaning no conversion is applied</li> </ul>"},{"location":"forex-rates/#requirements","title":"Requirements","text":""},{"location":"forex-rates/#functional-requirements","title":"Functional requirements","text":"<ol> <li>Fetch rates on demand: Users can request current forex rates for a given currency pair</li> <li>Cache locally: Store fetched rates in JSON with last-fetched timestamp</li> <li>TTL enforcement: Use cached rates if fetched within the last hour</li> <li>Fallback behavior: Return 1.0 if:</li> <li>Application is offline (cannot reach API)</li> <li>No rate has been previously cached for a currency</li> <li> <p>Rate fetch fails with an error</p> </li> <li> <p>Calculate derived rates: Support arbitrary currency pairs by using USD as a hub</p> </li> <li>Configuration: Allow users to configure API preferences and cache location</li> </ol>"},{"location":"forex-rates/#non-functional-requirements","title":"Non-functional requirements","text":"<ol> <li>Reliability: Never block user operations due to rate fetch failures</li> <li>Performance: Minimize API calls through effective caching</li> <li>Transparency: Log fetch attempts, cache hits/misses, and fallbacks</li> <li>Testability: Separate API logic, caching logic, and data persistence</li> </ol>"},{"location":"forex-rates/#api-service-selection","title":"API service selection","text":""},{"location":"forex-rates/#candidate-services","title":"Candidate services","text":"Service Free Tier Auth Required Data Freshness Currencies Uptime Best For ExchangeRate-API 1.5K req/mo \u274c No Daily 161 99.99% \u2705 Recommended exchangerate.host 100 req/mo \u2705 Yes Hourly 168 99.9% Limited free Open Exchange Rates 1.0K req/mo \u2705 Yes Variable 200+ Claimed Backup only"},{"location":"forex-rates/#recommended-choice-exchangerate-api","title":"Recommended choice: ExchangeRate-API","text":"<p>Rationale:</p> <ul> <li>No API key required \u2014 free tier works without authentication or credit card</li> <li>Simple REST API: <code>https://api.exchangerate-api.com/v4/latest/{currency}</code></li> <li>1,500 requests/month free (50/day, adequate with 1-hour cache TTL)</li> <li>Daily updates on free tier (sufficient for budget tracking)</li> <li>Covers all major currencies including SGD</li> <li>Returns rates as decimal values, no parsing required</li> <li>JSON responses with predictable structure</li> <li>15+ years of service (since 2010), 99.99% uptime measured by Pingdom</li> <li>Used by hundreds of thousands of developers</li> </ul> <p>Response structure: <pre><code>{\n  \"base\": \"USD\",\n  \"date\": \"2026-02-20\",\n  \"rates\": {\n    \"SGD\": 1.35,\n    \"EUR\": 0.92,\n    \"GBP\": 0.79,\n    \"JPY\": 150.0,\n    ...\n  }\n}\n</code></pre></p>"},{"location":"forex-rates/#sample-api-requests","title":"Sample API requests","text":"<p>Get rates for USD (reference currency): <pre><code>curl https://api.exchangerate-api.com/v4/latest/USD\n</code></pre></p> <p>Response: <pre><code>{\n  \"base\": \"USD\",\n  \"date\": \"2026-02-20\",\n  \"rates\": {\n    \"SGD\": 1.3502,\n    \"EUR\": 0.9187,\n    \"GBP\": 0.7925,\n    \"JPY\": 150.45,\n    ...\n  }\n}\n</code></pre></p> <p>Python example: <pre><code>import requests\n\nurl = \"https://api.exchangerate-api.com/v4/latest/USD\"\nresponse = requests.get(url, timeout=5)\ndata = response.json()\n\nsgd_rate = data[\"rates\"][\"SGD\"]  # 1.3502\nprint(f\"1 USD = {sgd_rate} SGD\")\n</code></pre></p>"},{"location":"forex-rates/#configuration-for-api-selection","title":"Configuration for API selection","text":"<p>Users need only specify cache TTL in <code>hb-config.json</code>:</p> <pre><code>{\n  \"forex\": {\n    \"cache_ttl_hours\": 1\n  }\n}\n</code></pre> <p>This is optional; if omitted, defaults to 1-hour TTL. ExchangeRate-API is used automatically without API key or signup.</p>"},{"location":"forex-rates/#data-structure-and-storage","title":"Data structure and storage","text":""},{"location":"forex-rates/#cache-file-format","title":"Cache file format","text":"<p>Store rates in JSON in a dedicated Forex directory:</p> <p>File: <code>{HomeBudgetData}/Forex/forex-rates.json</code></p> <pre><code>{\n  \"metadata\": {\n    \"version\": 1,\n    \"last_update\": \"2026-02-20T15:30:45Z\"\n  },\n  \"timestamp\": \"2026-02-20T15:30:45Z\",\n  \"base\": \"USD\",\n  \"rates\": {\n    \"SGD\": 1.3502,\n    \"EUR\": 0.9187,\n    \"GBP\": 0.7925,\n    \"JPY\": 150.45,\n    \"AUD\": 1.2708,\n    \"CAD\": 1.3550,\n    ...\n  }\n}\n</code></pre>"},{"location":"forex-rates/#purpose-of-structure","title":"Purpose of structure","text":"<ul> <li>metadata: Tracks cache version and last full update for diagnostics</li> <li>timestamp: Last fetch time; compared against current time for TTL validation</li> <li>base: Always <code>\"USD\"</code> \u2014 all rates are denominated in USD</li> <li>rates: Currency code \u2192 rate mapping for all currencies vs USD</li> <li>Single source of truth; any currency pair can be calculated via <code>RATES[A] / RATES[B]</code></li> <li>Example: SGD to EUR = <code>RATES[\"SGD\"] / RATES[\"EUR\"]</code> = <code>1.3502 / 0.9187</code> \u2248 1.47</li> </ul>"},{"location":"forex-rates/#caching-and-ttl-strategy","title":"Caching and TTL strategy","text":""},{"location":"forex-rates/#ttl-logic","title":"TTL logic","text":"<p>When a user requests a rate for currency <code>X</code>:</p> <ol> <li>Check cache exists: Look for <code>rates[X]</code> in the cache file</li> <li>Check TTL validity: </li> <li>Parse <code>timestamp</code> field</li> <li>If <code>current_time - timestamp &lt; 1 hour</code>: Use cached rates</li> <li> <p>Otherwise: Fetch fresh rates from API</p> </li> <li> <p>Update on fetch: Store new timestamp and refreshed rates</p> </li> <li>Persist to disk: Write updated cache file</li> </ol> <p>Note: TTL is per-cache (all currencies share the same timestamp), not per-currency. Once any rate is stale, all rates are refreshed together.</p>"},{"location":"forex-rates/#ttl-configuration","title":"TTL configuration","text":"<p>Default: 1 hour (<code>cache_ttl_hours: 1</code>)</p> <p>Rationale:</p> <ul> <li>Balances minimizing API calls with reasonable rate freshness</li> <li>Typical daily forex volatility is 0.5-2%, acceptable for budget tracking</li> <li>Aligns with common transaction batch workflows (process daily receipts)</li> </ul> <p>Users can override in config:</p> <ul> <li>Aggressive caching: <code>cache_ttl_hours: 24</code></li> <li>Conservative: <code>cache_ttl_hours: 0</code> (always fetch, subject to API limits)</li> </ul>"},{"location":"forex-rates/#cache-initialization","title":"Cache initialization","text":"<p>On first use:</p> <ul> <li>If cache file doesn't exist, create it with empty structure</li> <li>First rate request triggers a fetch from the API</li> </ul>"},{"location":"forex-rates/#fallback-mechanism","title":"Fallback mechanism","text":""},{"location":"forex-rates/#fallback-scenarios","title":"Fallback scenarios","text":"Scenario Behavior Log Level No cached rate exists Attempt to fetch from API; fall back to 1.0 if fetch fails INFO API unreachable (connection error) Return 1.0 WARN API returns HTTP error (5xx) Return 1.0 WARN Rate is stale but no API available Use stale rate INFO JSON parse error in cache Clear entry, attempt fresh fetch; fall back to 1.0 if fetch fails ERROR Malformed API response Return 1.0 WARN"},{"location":"forex-rates/#rate-formula-for-fallback","title":"Rate formula for fallback","text":"<p>The fallback rate <code>1.0</code> represents \"no conversion\" (unit rate), meaning the provided amount is used as-is without adjustment. This is appropriate because:</p> <ol> <li>In offline mode: User can manually correct the amount or rate later</li> <li>On first use: User can verify the amount and rate in the transaction review</li> <li>Preserves determinism: Same fallback value across all currency pairs, preventing confusion</li> </ol>"},{"location":"forex-rates/#stale-rate-fallback","title":"Stale rate fallback","text":"<p>If cache exists but is older than TTL and API fails:</p> <ul> <li>Use the stale rate instead of 1.0</li> <li>Log at INFO level: \"Cache expired but using stale rate due to API failure\"</li> <li>Rationale: A day-old rate is better than no conversion</li> </ul>"},{"location":"forex-rates/#integration-points","title":"Integration points","text":""},{"location":"forex-rates/#client-api","title":"Client API","text":"<p>The <code>HomeBudgetClient</code> exposes a helper method for other code to fetch rates if needed:</p> <pre><code>def get_forex_rate(\n    self,\n    from_currency: str,\n    to_currency: str | None = None\n) -&gt; float:\n    \"\"\"Fetch current forex rate for a given currency pair.\n\n    If to_currency is not specified, uses the account's base currency.\n    Returns 1.0 if rate is unavailable (offline or not cached).\n\n    Args:\n        from_currency: ISO 4217 currency code (e.g., 'SGD')\n        to_currency: Target currency code (optional, defaults to base currency)\n\n    Returns:\n        float: Exchange rate (fallback 1.0 if unavailable)\n    \"\"\"\n</code></pre>"},{"location":"forex-rates/#shared-normalization-layer","title":"Shared normalization layer","text":"<p>The forex manager is integrated into shared normalization methods that apply to all transaction types:</p> <ul> <li>For single updates: <code>_normalize_forex_inputs()</code> </li> <li>For batch operations: <code>_resolve_batch_forex_add()</code></li> <li>For currency inference: <code>_infer_currency_for_*()</code> methods</li> </ul> <p>These methods are called by all transaction operations (add/update/delete) regardless of type (expense/income/transfer).</p>"},{"location":"forex-rates/#handling-amount-only-input-on-non-base-accounts","title":"Handling amount-only input on non-base accounts","text":"<p>When a user provides only <code>amount</code> on a non-base currency account:</p> <p>Without forex rate, rate=1.0:</p> <ul> <li>User enters: <code>amount=100</code> on USD account (base currency is SGD)</li> <li>Result: <code>amount=100, currency=USD, currency_amount=100, exchange_rate=1.0</code></li> <li>Interpretation: 100 USD = 100 SGD (incorrect 1:1 conversion)</li> </ul> <p>With forex rate:</p> <ul> <li>User enters: <code>amount=100</code> on USD account (amount is in USD, the account's currency)</li> <li>Fetch rate: 1 USD = 1.35 SGD</li> <li>Calculate: <code>amount = 100 * 1.35 = 135 SGD</code> (base currency)</li> <li>Result: <code>amount=135, currency=USD, currency_amount=100, exchange_rate=1.35</code></li> <li>Interpretation: 100 USD \u2248 135 SGD at rate 1.35</li> </ul>"},{"location":"forex-rates/#handling-amount-only-input-on-transfers-base-to-non-base","title":"Handling amount-only input on transfers (base to non-base)","text":"<p>When a user provides only <code>amount</code> on a transfer between base and non-base accounts:</p> <p>Scenario:</p> <ul> <li>User on base account (SGD) transfers to non-base account (USD)</li> <li>User specifies: <code>amount=135</code> (base currency, SGD)</li> <li>Transfer involves both SGD (base, from_account) and USD (foreign, to_account)</li> </ul> <p>Enhanced behavior:</p> <ul> <li>Infer non-base currency from target account: <code>currency=USD</code></li> <li>Fetch rate: 1 USD = 1.35 SGD</li> <li>Calculate: <code>currency_amount = 135 / 1.35 = 100</code> (WITHOUT rounding)</li> <li>Send as foreign currency transaction: <code>amount=135, currency=USD, currency_amount=100, exchange_rate=1.35</code></li> <li>Interpretation: 100 USD \u2248 135 SGD at rate 1.35</li> </ul> <p>This applies to the transfer's foreign currency leg (the non-base account side).</p>"},{"location":"forex-rates/#architecture","title":"Architecture","text":"<p>Module structure</p> <pre><code>src/python/homebudget/\n  forex.py               \u2190 New module\n  client.py              \u2190 Integrate forex manager initialization\n  config.py              \u2190 Handle forex config section (optional)\n</code></pre>"},{"location":"forex-rates/#error-handling","title":"Error handling","text":"<p>Normal flow with graceful fallback:</p> <pre><code>def get_rate(self, currency: str) -&gt; float:\n    \"\"\"Get rate, falling back to 1.0 on any failure.\"\"\"\n\n    # Check cache validity\n    if self._is_cache_valid():\n        rate = self._cache.get(\"rates\", {}).get(currency)\n        if rate:\n            return float(rate)\n\n    # Cache miss or stale: try to fetch fresh\n    try:\n        all_rates = self._fetch_from_api(currency)\n        self._cache = {\n            \"metadata\": {\"version\": 1, \"last_update\": datetime.isoformat(datetime.utcnow())},\n            \"timestamp\": datetime.isoformat(datetime.utcnow()),\n            \"base\": \"USD\",\n            \"rates\": all_rates,\n        }\n        self._save_cache(self._cache)\n        rate = all_rates.get(currency)\n        if rate:\n            return float(rate)\n    except Exception as e:\n        # Try to use stale rate from cache\n        if self._cache and \"rates\" in self._cache:\n            rate = self._cache[\"rates\"].get(currency)\n            if rate:\n                return float(rate)\n\n    # All else failed: fallback\n    return 1.0\n</code></pre> <p>Cache corruption: Clear and retry</p> <pre><code>def _load_cache(self) -&gt; dict:\n    \"\"\"Load cache, clearing on corruption.\"\"\"\n    try:\n        with open(self._cache_path, 'r') as f:\n            return json.load(f)\n    except (json.JSONDecodeError, IOError) as e:\n        self._cache = {}\n        if self._cache_path.exists():\n            self._cache_path.unlink()\n        return {}\n</code></pre>"},{"location":"forex-rates/#exception-hierarchy","title":"Exception hierarchy","text":"<pre><code>class ForexError(Exception):\n    \"\"\"Base exception for forex operations.\"\"\"\n    pass\n\nclass ForexAPIError(ForexError):\n    \"\"\"Raised when API request fails.\"\"\"\n\n    def __init__(self, message: str, status_code: int | None = None):\n        super().__init__(message)\n        self.status_code = status_code\n\nclass ForexCacheError(ForexError):\n    \"\"\"Raised when cache I/O fails.\"\"\"\n    pass\n\nclass InvalidCurrencyError(ForexError):\n    \"\"\"Raised for invalid currency codes.\"\"\"\n    pass\n</code></pre>"},{"location":"forex-rates/#configuration","title":"Configuration","text":""},{"location":"forex-rates/#config-schema","title":"Config schema","text":"<p>Add to <code>hb-config.json</code> under <code>forex</code> key (all fields optional):</p> <pre><code>{\n  \"forex\": {\n    \"cache_ttl_hours\": 1\n  }\n}\n</code></pre>"},{"location":"forex-rates/#option-reference","title":"Option reference","text":"Option Type Default Purpose <code>cache_ttl_hours</code> int <code>1</code> Cache validity in hours"},{"location":"forex-rates/#defaults","title":"Defaults","text":"<p>All other settings are automatically derived or hardcoded:</p> <ul> <li>API provider: ExchangeRate-API (free, no authentication required)</li> <li>Cache path: Auto-derived as <code>{HomeBudgetData}/Forex/forex-rates.json</code></li> <li>Fallback rate: Always <code>1.0</code> (unit rate for no conversion)</li> <li>Timeout: <code>5</code> seconds for API requests</li> <li>Offline mode: Disabled by default</li> </ul> <p>If the <code>forex</code> key is omitted entirely from config, the feature uses all defaults with 1-hour TTL. Users only need to configure <code>cache_ttl_hours</code> if they want a different caching interval.</p>"},{"location":"forex-rates/#appendix-alternative-api-providers","title":"Appendix: Alternative API providers","text":""},{"location":"forex-rates/#exchangeratehost-apilayer","title":"exchangerate.host (APILayer)","text":"<ul> <li>Free tier: 100 requests/month (very limited)</li> <li>Authentication: Requires API key signup</li> <li>Data freshness: Hourly updates (more frequent than ExchangeRate-API)</li> <li>Currencies: 168 supported</li> <li>Historical data: 19 years available</li> <li>Uptime: 99.9%</li> <li>Status: Not practical for this use case due to 100 req/mo limit with typical usage</li> </ul>"},{"location":"forex-rates/#open-exchange-rates","title":"Open Exchange Rates","text":"<ul> <li>Free tier: 1,000 requests/month</li> <li>Authentication: Requires API key signup</li> <li>Currencies: 200+ (most comprehensive)</li> <li>Data model: USD-centric</li> <li>Status: Use as emergency fallback only if ExchangeRate-API becomes unavailable</li> </ul>"},{"location":"issues/","title":"Issues","text":"id status type issue 001 closed BUG 001 sync detection 002 closed BUG 002 sync expense update amount 003 open ENHANCEMENT 003 categories list"},{"location":"methods/","title":"HomeBudget Wrapper Methods Guide","text":""},{"location":"methods/#table-of-contents","title":"Table of contents","text":"<ul> <li>Overview</li> <li>Quick start</li> <li>Client methods</li> <li>Expense methods</li> <li>Income methods</li> <li>Transfer methods</li> <li>Batch methods</li> <li>Reference data methods</li> <li>Data transfer objects</li> </ul>"},{"location":"methods/#overview","title":"Overview","text":"<p>The HomeBudget wrapper exposes methods for programmatic database access. All write operations automatically manage sync updates and can be used within a context manager or with explicit lifecycle management.</p>"},{"location":"methods/#quick-start","title":"Quick start","text":"<p>Create a client using the configured default database path:</p> <pre><code>from homebudget import HomeBudgetClient\n\nwith HomeBudgetClient() as client:\n    expense = client.add_expense(...)\n</code></pre> <p>Override the database path:</p> <pre><code>with HomeBudgetClient(db_path=\"C:/path/to/homebudget.db\") as client:\n    expenses = client.list_expenses()\n</code></pre>"},{"location":"methods/#client-methods","title":"Client methods","text":""},{"location":"methods/#lifecycle","title":"Lifecycle","text":"<p><code>__init__(db_path=None, enable_sync=True)</code></p> <p>Initialize the client. If <code>db_path</code> is omitted, the configured default is used. Sync is enabled by default and cannot be disabled.</p> <p><code>close()</code></p> <p>Close the database connection. Called automatically when using the context manager.</p> <p><code>__enter__()</code>, <code>__exit__()</code></p> <p>Context manager support. Ensures clean shutdown via <code>close()</code>.</p> <pre><code>with HomeBudgetClient() as client:\n    # use client\n    pass  # closes automatically\n</code></pre>"},{"location":"methods/#expense-methods","title":"Expense methods","text":"<p><code>add_expense(expense: ExpenseDTO) -&gt; ExpenseRecord</code></p> <p>Add a single expense. For base currency accounts, provide <code>amount</code> only. For foreign currency accounts, provide <code>currency</code>, <code>currency_amount</code>, and <code>exchange_rate</code>. Returns the saved record with generated key.</p> <pre><code>from decimal import Decimal\nimport datetime\nfrom homebudget import HomeBudgetClient, ExpenseDTO\n\nwith HomeBudgetClient() as client:\n    expense = ExpenseDTO(\n        date=datetime.date(2026, 2, 16),\n        category=\"Dining\",\n        subcategory=\"Restaurant\",\n        amount=Decimal(\"25.50\"),\n        account=\"Wallet\",\n        notes=\"Lunch\"\n    )\n    saved = client.add_expense(expense)\n    print(saved.key)\n</code></pre> <p><code>get_expense(key: int) -&gt; ExpenseRecord</code></p> <p>Retrieve a single expense by key.</p> <p><code>list_expenses(start_date=None, end_date=None, account=None, category=None, limit=None) -&gt; list[ExpenseRecord]</code></p> <p>List expenses with optional filters. Date range is inclusive. Returns all matching expenses up to the limit.</p> <pre><code>import datetime\nresults = client.list_expenses(\n    start_date=datetime.date(2026, 2, 1),\n    end_date=datetime.date(2026, 2, 28),\n    account=\"Wallet\",\n    limit=50\n)\n</code></pre> <p><code>update_expense(key: int, **fields) -&gt; ExpenseRecord</code></p> <p>Update specific fields of an existing expense. Accepts <code>amount</code>, <code>currency</code>, <code>currency_amount</code>, <code>exchange_rate</code>, <code>category</code>, <code>subcategory</code>, <code>account</code>, <code>date</code>, <code>notes</code>. Returns the updated record.</p> <pre><code>from decimal import Decimal\n\nupdated = client.update_expense(\n    13074,\n    amount=Decimal(\"27.50\"),\n    notes=\"Updated\"\n)\n</code></pre> <p><code>delete_expense(key: int) -&gt; None</code></p> <p>Delete an expense by key.</p>"},{"location":"methods/#income-methods","title":"Income methods","text":"<p><code>add_income(income: IncomeDTO) -&gt; IncomeRecord</code></p> <p>Add a single income. Currency handling matches expense methods. Returns the saved record with generated key.</p> <p><code>get_income(key: int) -&gt; IncomeRecord</code></p> <p>Retrieve a single income by key.</p> <p><code>list_income(start_date=None, end_date=None, account=None, limit=None) -&gt; list[IncomeRecord]</code></p> <p>List income with optional filters. Date range is inclusive. Returns all matching income up to the limit.</p> <p><code>update_income(key: int, **fields) -&gt; IncomeRecord</code></p> <p>Update specific fields of an existing income. Accepts <code>amount</code>, <code>currency</code>, <code>currency_amount</code>, <code>exchange_rate</code>, <code>name</code>, <code>account</code>, <code>date</code>, <code>notes</code>. Returns the updated record.</p> <p><code>delete_income(key: int) -&gt; None</code></p> <p>Delete an income by key.</p>"},{"location":"methods/#transfer-methods","title":"Transfer methods","text":"<p><code>add_transfer(transfer: TransferDTO) -&gt; TransferRecord</code></p> <p>Add a transfer between accounts. The normalization layer accepts <code>currency</code> for either the from_account or to_account. Returns the saved record with generated key.</p> <p>To specify the sending amount (from_account currency):</p> <pre><code>from decimal import Decimal\nimport datetime\n\ntransfer = TransferDTO(\n    date=datetime.date(2026, 2, 22),\n    from_account=\"Wallet\",\n    to_account=\"Bank Account\",\n    currency=\"SGD\",\n    currency_amount=Decimal(\"100.00\"),\n    exchange_rate=Decimal(\"1.0\"),\n    notes=\"Wallet to bank\"\n)\nsaved = client.add_transfer(transfer)\n</code></pre> <p>To specify the receiving amount (to_account currency), the system automatically calculates the corresponding from_account amount using the forex rate:</p> <pre><code>transfer = TransferDTO(\n    date=datetime.date(2026, 2, 22),\n    from_account=\"TWH - Personal\",  # SGD base\n    to_account=\"TWH IB USD\",  # USD\n    currency=\"USD\",\n    currency_amount=Decimal(\"100.00\"),\n    exchange_rate=Decimal(\"0.74\"),\n    notes=\"SGD to USD\"\n)\n# Internally normalized to: currency=SGD, currency_amount=135.14, amount=100.00\nsaved = client.add_transfer(transfer)\n</code></pre> <p><code>get_transfer(key: int) -&gt; TransferRecord</code></p> <p>Retrieve a single transfer by key.</p> <p><code>list_transfers(start_date=None, end_date=None, from_account=None, to_account=None, limit=None) -&gt; list[TransferRecord]</code></p> <p>List transfers with optional filters. Date range is inclusive. Returns all matching transfers up to the limit.</p> <p><code>update_transfer(key: int, **fields) -&gt; TransferRecord</code></p> <p>Update specific fields of an existing transfer. Accepts <code>from_account</code>, <code>to_account</code>, <code>amount</code>, <code>currency</code>, <code>currency_amount</code>, <code>exchange_rate</code>, <code>date</code>, <code>notes</code>. Returns the updated record.</p> <p><code>delete_transfer(key: int) -&gt; None</code></p> <p>Delete a transfer by key.</p>"},{"location":"methods/#batch-methods","title":"Batch methods","text":"<p><code>batch(operations: list[BatchOperation], continue_on_error=False) -&gt; BatchResult</code></p> <p>Execute mixed operations (add, update, delete) across expense, income, and transfer resources atomically. If <code>continue_on_error=True</code>, failed operations do not prevent subsequent operations. Returns a result object with <code>successful</code> and <code>failed</code> lists.</p> <pre><code>from homebudget import HomeBudgetClient, BatchOperation\n\noperations = [\n    BatchOperation(\n        resource=\"expense\",\n        operation=\"add\",\n        parameters={\n            \"date\": \"2026-02-20\",\n            \"category\": \"Food (Basic)\",\n            \"subcategory\": \"Restaurant\",\n            \"amount\": \"25.50\",\n            \"account\": \"TWH - Personal\",\n            \"notes\": \"Lunch\"\n        }\n    ),\n    BatchOperation(\n        resource=\"income\",\n        operation=\"update\",\n        parameters={\n            \"key\": 14021,\n            \"notes\": \"Updated notes\"\n        }\n    ),\n    BatchOperation(\n        resource=\"transfer\",\n        operation=\"delete\",\n        parameters={\n            \"key\": 21007\n        }\n    )\n]\n\nwith HomeBudgetClient() as client:\n    result = client.batch(operations, continue_on_error=True)\n    print(f\"Successful: {len(result.successful)}\")\n    print(f\"Failed: {len(result.failed)}\")\n    for op, error in result.failed:\n        print(f\"  Failed: {op.resource} {op.operation} - {error}\")\n</code></pre> <p><code>add_expenses_batch(expenses: list[ExpenseDTO]) -&gt; BatchResult</code></p> <p>Batch import multiple expenses. Returns result with successful and failed lists.</p> <p><code>add_incomes_batch(incomes: list[IncomeDTO]) -&gt; BatchResult</code></p> <p>Batch import multiple income records. Returns result with successful and failed lists.</p> <p><code>add_transfers_batch(transfers: list[TransferDTO]) -&gt; BatchResult</code></p> <p>Batch import multiple transfers. Returns result with successful and failed lists.</p>"},{"location":"methods/#reference-data-methods","title":"Reference data methods","text":"<p><code>list_accounts() -&gt; list[AccountDTO]</code></p> <p>Retrieve all configured accounts with their names and currencies.</p> <pre><code>with HomeBudgetClient() as client:\n    accounts = client.list_accounts()\n    for account in accounts:\n        print(account.name, account.currency)\n</code></pre> <p><code>list_categories() -&gt; list[CategoryDTO]</code></p> <p>Retrieve all available expense and income categories with their subcategories.</p> <pre><code>with HomeBudgetClient() as client:\n    categories = client.list_categories()\n    for category in categories:\n        print(category.category, category.subcategory)\n</code></pre> <p><code>list_currencies() -&gt; list[CurrencyDTO]</code></p> <p>Retrieve all available currencies with their exchange rates against the base currency.</p> <pre><code>with HomeBudgetClient() as client:\n    currencies = client.list_currencies()\n    for currency in currencies:\n        print(currency.code, currency.exchange_rate)\n</code></pre>"},{"location":"methods/#data-transfer-objects","title":"Data transfer objects","text":""},{"location":"methods/#transaction-dtos","title":"Transaction DTOs","text":"<p><code>ExpenseDTO</code></p> <p>Fields: <code>date</code>, <code>category</code>, <code>subcategory</code>, <code>amount</code> (or <code>currency_amount</code>), <code>currency</code> (optional), <code>exchange_rate</code> (optional), <code>account</code>, <code>notes</code> (optional).</p> <p><code>IncomeDTO</code></p> <p>Fields: <code>date</code>, <code>name</code>, <code>amount</code> (or <code>currency_amount</code>), <code>currency</code> (optional), <code>exchange_rate</code> (optional), <code>account</code>, <code>notes</code> (optional).</p> <p><code>TransferDTO</code></p> <p>Fields: <code>date</code>, <code>from_account</code>, <code>to_account</code>, <code>amount</code> (optional), <code>currency</code> (optional), <code>currency_amount</code> (optional), <code>exchange_rate</code> (optional), <code>notes</code> (optional).</p> <p>For transfers, the normalization layer accepts currency specification for either account and calculates the corresponding other amount. See Transfer Currency Normalization for details.</p>"},{"location":"methods/#record-dtos","title":"Record DTOs","text":"<p><code>ExpenseRecord</code></p> <p>Fields: <code>key</code>, <code>date</code>, <code>category</code>, <code>subcategory</code>, <code>amount</code>, <code>currency</code>, <code>currency_amount</code>, <code>exchange_rate</code>, <code>account</code>, <code>notes</code>, <code>created_at</code>, <code>updated_at</code>.</p> <p><code>IncomeRecord</code></p> <p>Fields: <code>key</code>, <code>date</code>, <code>name</code>, <code>amount</code>, <code>currency</code>, <code>currency_amount</code>, <code>exchange_rate</code>, <code>account</code>, <code>notes</code>, <code>created_at</code>, <code>updated_at</code>.</p> <p><code>TransferRecord</code></p> <p>Fields: <code>key</code>, <code>date</code>, <code>from_account</code>, <code>to_account</code>, <code>amount</code>, <code>currency</code>, <code>currency_amount</code>, <code>exchange_rate</code>, <code>notes</code>, <code>created_at</code>, <code>updated_at</code>.</p>"},{"location":"methods/#reference-data-dtos","title":"Reference data DTOs","text":"<p><code>AccountDTO</code></p> <p>Fields: <code>name</code>, <code>currency</code>, <code>account_type</code>.</p> <p><code>CategoryDTO</code></p> <p>Fields: <code>category</code>, <code>subcategory</code>, <code>transaction_type</code>.</p> <p><code>CurrencyDTO</code></p> <p>Fields: <code>code</code>, <code>exchange_rate</code>.</p>"},{"location":"methods/#batch-operation-dtos","title":"Batch operation DTOs","text":"<p><code>BatchOperation</code></p> <p>Fields: <code>resource</code> (expense, income, or transfer), <code>operation</code> (add, update, or delete), <code>parameters</code> (dict of operation-specific fields).</p> <p><code>BatchResult</code></p> <p>Fields: <code>successful</code> (list of tuples: operation, result), <code>failed</code> (list of tuples: operation, error).</p>"},{"location":"repository-layout/","title":"Repository layout","text":""},{"location":"repository-layout/#overview","title":"Overview","text":"<p>This repository contains the HomeBudget Python wrapper for SQLite database access, with CLI and library interfaces.</p>"},{"location":"repository-layout/#directory-structure","title":"Directory structure","text":"<pre><code>homebudget/\n\u251c\u2500\u2500 .dev/                    # Development environment (git ignored)\n\u2502   \u251c\u2500\u2500 env/                 # Python virtual environment\n\u2502   \u251c\u2500\u2500 logs/                # Development logs and diagnostics\n\u2502   \u251c\u2500\u2500 .scripts/            # Helper scripts\n\u2502   \u2502   \u251c\u2500\u2500 python/          # Python helper scripts\n\u2502   \u2502   \u251c\u2500\u2500 bash/            # Bash scripts\n\u2502   \u2502   \u2514\u2500\u2500 cmd/             # Windows batch scripts\n\u2502   \u2514\u2500\u2500 requirements.txt     # Development dependencies\n\u251c\u2500\u2500 .github/                 # GitHub configuration\n\u2502   \u251c\u2500\u2500 prompts/             # AI agent prompts\n\u2502   \u2514\u2500\u2500 workflows/           # CI/CD workflows (future)\n\u251c\u2500\u2500 docs/                    # Design and reference documentation\n\u2502   \u251c\u2500\u2500 index.md\n\u2502   \u251c\u2500\u2500 cli-guide.md\n\u2502   \u251c\u2500\u2500 configuration.md\n\u2502   \u251c\u2500\u2500 dependencies.md\n\u2502   \u251c\u2500\u2500 design.md\n\u2502   \u251c\u2500\u2500 developer-guide.md\n\u2502   \u251c\u2500\u2500 forex-rates.md\n\u2502   \u251c\u2500\u2500 methods.md\n\u2502   \u251c\u2500\u2500 repository-layout.md\n\u2502   \u251c\u2500\u2500 sqlite-schema.md\n\u2502   \u251c\u2500\u2500 sync-update.md\n\u2502   \u251c\u2500\u2500 test-cases.md\n\u2502   \u251c\u2500\u2500 test-guide.md\n\u2502   \u251c\u2500\u2500 test-strategy.md\n\u2502   \u251c\u2500\u2500 transfer-currency-normalization.md\n\u2502   \u251c\u2500\u2500 user-guide.md\n\u2502   \u251c\u2500\u2500 workflow.md\n\u2502   \u2514\u2500\u2500 tests/               # Test documentation\n\u2502       \u251c\u2500\u2500 feature_5.1_expense_crud.md\n\u2502       \u251c\u2500\u2500 feature_5.3_transfer_crud.md\n\u2502       \u251c\u2500\u2500 sync_validation_procedure.md\n\u2502       \u251c\u2500\u2500 TRANSFER_TEST_CASES.md\n\u2502       \u2514\u2500\u2500 BATCH_TRANSFER_TEST_CASES.md\n\u251c\u2500\u2500 reference/               # Reference source code used during development\n\u251c\u2500\u2500 src/                     # Source code\n\u2502   \u2514\u2500\u2500 python/              # Python package\n\u2502       \u2514\u2500\u2500 homebudget/      # Main package\n\u2502           \u251c\u2500\u2500 __init__.py\n\u2502           \u251c\u2500\u2500 __version__.py\n\u2502           \u251c\u2500\u2500 client.py\n\u2502           \u251c\u2500\u2500 models.py\n\u2502           \u251c\u2500\u2500 sync.py\n\u2502           \u251c\u2500\u2500 repository.py\n\u2502           \u251c\u2500\u2500 schema.py\n\u2502           \u251c\u2500\u2500 exceptions.py\n\u2502           \u251c\u2500\u2500 cli/         # Command line interface\n\u2502           \u2502   \u251c\u2500\u2500 __init__.py\n\u2502           \u2502   \u251c\u2500\u2500 main.py\n\u2502           \u2502   \u251c\u2500\u2500 commands/\n\u2502           \u2502   \u251c\u2500\u2500 formatters.py\n\u2502           \u2502   \u2514\u2500\u2500 validators.py\n\u2502           \u2514\u2500\u2500 utils/       # Helper utilities\n\u2502               \u251c\u2500\u2500 __init__.py\n\u2502               \u251c\u2500\u2500 currency.py\n\u2502               \u251c\u2500\u2500 dates.py\n\u2502               \u251c\u2500\u2500 validation.py\n\u2502               \u2514\u2500\u2500 logging.py\n\u251c\u2500\u2500 tests/                   # Test suite\n\u2502   \u251c\u2500\u2500 unit/                # Unit tests\n\u2502   \u251c\u2500\u2500 integration/         # Integration tests\n\u2502   \u251c\u2500\u2500 fixtures/            # Test fixtures and databases\n\u2502   \u2514\u2500\u2500 conftest.py          # Pytest configuration\n\u251c\u2500\u2500 .gitignore\n\u251c\u2500\u2500 AGENTS.md                # AI agent instructions\n\u251c\u2500\u2500 LICENSE\n\u251c\u2500\u2500 pyproject.toml           # Package configuration\n\u251c\u2500\u2500 README.md                # Project overview and quickstart\n\u251c\u2500\u2500 requirements.txt         # Production dependencies\n</code></pre>"},{"location":"repository-layout/#key-directories","title":"Key directories","text":"<ul> <li>src/python/homebudget/ - Main Python package with library and CLI</li> <li>tests/ - Pytest test suite with unit and integration tests</li> <li>docs/ - Complete design documentation and reference materials</li> <li>reference/ - Original implementation for reference only</li> <li>.dev/ - Local development environment (git ignored)</li> </ul>"},{"location":"sqlite-schema/","title":"SQLite schema reference","text":"<p>Database: HomeBudget sample SQLite database (local reference)</p>"},{"location":"sqlite-schema/#table-of-contents","title":"Table of contents","text":"<ul> <li>Account</li> <li>AccountLog</li> <li>AccountTrans</li> <li>Bill</li> <li>Budget</li> <li>BudgetFuture</li> <li>BudgetHistory</li> <li>BudgetSettings</li> <li>Category</li> <li>Currency</li> <li>DeviceInfo</li> <li>Expense</li> <li>FIHints</li> <li>FITrans</li> <li>Income</li> <li>Payee</li> <li>RecurringBill</li> <li>RecurringExpense</li> <li>RecurringIncome</li> <li>RecurringTransfer</li> <li>Settings</li> <li>SubCategory</li> <li>SyncInfo</li> <li>SyncUpdate</li> <li>Transfer</li> </ul>"},{"location":"sqlite-schema/#account","title":"Account","text":""},{"location":"sqlite-schema/#columns","title":"Columns","text":"Name Type Not null Default PK key INTEGER 0 1 name TEXT 0 0 icon TEXT 0 0 accountType TEXT 0 0 balance REAL 0 0.00 0 deleteOK CHAR(1) 0 'Y' 0 deviceIdKey INTEGER 0 0 deviceKey INTEGER 0 0 balanceDate DATE 0 0 includeAccount CHAR(1) 0 'Y' 0 seqNum INTEGER 0 0 0 currency TEXT 0 0"},{"location":"sqlite-schema/#foreign-keys","title":"Foreign keys","text":"<p>None</p>"},{"location":"sqlite-schema/#indexes","title":"Indexes","text":"Name Unique Columns Origin Partial AccountDeviceIdDeviceKeyIndex 0 deviceIdKey, deviceKey c 0"},{"location":"sqlite-schema/#accountlog","title":"AccountLog","text":""},{"location":"sqlite-schema/#columns_1","title":"Columns","text":"Name Type Not null Default PK key INTEGER 0 1 accountKey INTEGER 0 0 timeStamp DATETIME 0 0 transType INTEGER 0 0 transKey INTEGER 0 0 transAmount REAL 0 0 newBalance REAL 0 0 checked CHAR(1) 0 'N' 0 transDate DATE 0 0"},{"location":"sqlite-schema/#foreign-keys_1","title":"Foreign keys","text":"<p>None</p>"},{"location":"sqlite-schema/#indexes_1","title":"Indexes","text":"Name Unique Columns Origin Partial AccountLogTimeStampIndex 0 timeStamp c 0 AccountLogAccountKeyIndex 0 accountKey c 0"},{"location":"sqlite-schema/#accounttrans","title":"AccountTrans","text":""},{"location":"sqlite-schema/#columns_2","title":"Columns","text":"Name Type Not null Default PK key INTEGER 0 1 accountKey INTEGER 0 0 timeStamp DATETIME 0 0 transType INTEGER 0 0 transKey INTEGER 0 0 transDate DATE 0 0 transAmount REAL 0 0 checked CHAR(1) 0 'N' 0"},{"location":"sqlite-schema/#foreign-keys_2","title":"Foreign keys","text":"<p>None</p>"},{"location":"sqlite-schema/#indexes_2","title":"Indexes","text":"Name Unique Columns Origin Partial AccountTransTransKeyIndex 0 transType, transKey c 0 AccountTransTransDateIndex 0 transDate c 0"},{"location":"sqlite-schema/#bill","title":"Bill","text":""},{"location":"sqlite-schema/#columns_3","title":"Columns","text":"Name Type Not null Default PK key INTEGER 0 1 payeeKey INTEGER 0 0 amount REAL 0 0 dueDate DATE 0 0 paid CHAR(1) 0 'Y' 0 expenseKey INTEGER 0 0 deviceIdKey INTEGER 0 0 deviceKey INTEGER 0 0 timeStamp DATETIME 0 0 billType INTEGER 0 0 0 currency TEXT 0 0 currencyAmount TEXT 0 0 recurringKey INTEGER 0 0 0 catKey INTEGER 0 0 0 subCatKey INTEGER 0 0 0 fromAccountKey INTEGER 0 0 0 notes TEXT 0 0"},{"location":"sqlite-schema/#foreign-keys_3","title":"Foreign keys","text":"<p>None</p>"},{"location":"sqlite-schema/#indexes_3","title":"Indexes","text":"Name Unique Columns Origin Partial BillDeviceIdDeviceKeyIndex 0 deviceIdKey, deviceKey c 0 BillsDueDateIndex 0 dueDate c 0"},{"location":"sqlite-schema/#budget","title":"Budget","text":""},{"location":"sqlite-schema/#columns_4","title":"Columns","text":"Name Type Not null Default PK key INTEGER 0 1 catKey INTEGER 0 0 subCatKey INTEGER 0 0 month INTEGER 0 0 year INTEGER 0 0 amount TEXT 0 0"},{"location":"sqlite-schema/#foreign-keys_4","title":"Foreign keys","text":"<p>None</p>"},{"location":"sqlite-schema/#indexes_4","title":"Indexes","text":"Name Unique Columns Origin Partial BudgetCatKeySubCatKeyMonthYearIndex 0 catKey, subCatKey, month, year c 0"},{"location":"sqlite-schema/#budgetfuture","title":"BudgetFuture","text":""},{"location":"sqlite-schema/#columns_5","title":"Columns","text":"Name Type Not null Default PK key INTEGER 0 1 catKey INTEGER 0 0 subCatKey INTEGER 0 0 cycle INTEGER 0 0 startDate DATE 0 0 endDate DATE 0 0 amount TEXT 0 0"},{"location":"sqlite-schema/#foreign-keys_5","title":"Foreign keys","text":"<p>None</p>"},{"location":"sqlite-schema/#indexes_5","title":"Indexes","text":"Name Unique Columns Origin Partial BudgetFutureSubCatStartDateEndDateIndex 0 subCatKey, startDate, endDate c 0"},{"location":"sqlite-schema/#budgethistory","title":"BudgetHistory","text":""},{"location":"sqlite-schema/#columns_6","title":"Columns","text":"Name Type Not null Default PK key INTEGER 0 1 budgetType CHAR(1) 0 'E' 0 catKey INTEGER 0 0 subCatKey INTEGER 0 0 startDate DATE 0 0 endDate DATE 0 0 amount TEXT 0 0 rolloverBalance TEXT 0 0 rolloverOnOff CHAR(1) 0 0"},{"location":"sqlite-schema/#foreign-keys_6","title":"Foreign keys","text":"<p>None</p>"},{"location":"sqlite-schema/#indexes_6","title":"Indexes","text":"<p>None</p>"},{"location":"sqlite-schema/#budgetsettings","title":"BudgetSettings","text":""},{"location":"sqlite-schema/#columns_7","title":"Columns","text":"Name Type Not null Default PK key INTEGER 0 1 budgetType CHAR(1) 0 'E' 0 catKey INTEGER 0 0 subCatKey INTEGER 0 0 cycle INTEGER 0 0 startDate DATE 0 0 endDate DATE 0 0 amount TEXT 0 0 rolloverOnOff CHAR(1) 0 'N' 0 rolloverBalance TEXT 0 0 modulus INTEGER 0 0 deviceIdKey INTEGER 0 0 deviceKey INTEGER 0 0"},{"location":"sqlite-schema/#foreign-keys_7","title":"Foreign keys","text":"<p>None</p>"},{"location":"sqlite-schema/#indexes_7","title":"Indexes","text":"<p>None</p>"},{"location":"sqlite-schema/#category","title":"Category","text":""},{"location":"sqlite-schema/#columns_8","title":"Columns","text":"Name Type Not null Default PK key INTEGER 0 1 name TEXT 0 0 icon TEXT 0 0 deleteOK CHAR(1) 0 'N' 0 seqNum INTEGER 0 0 0 deviceIdKey INTEGER 0 0 deviceKey INTEGER 0 0"},{"location":"sqlite-schema/#foreign-keys_8","title":"Foreign keys","text":"<p>None</p>"},{"location":"sqlite-schema/#indexes_8","title":"Indexes","text":"<p>None</p>"},{"location":"sqlite-schema/#currency","title":"Currency","text":""},{"location":"sqlite-schema/#columns_9","title":"Columns","text":"Name Type Not null Default PK key INTEGER 0 1 name TEXT 0 0 code TEXT 0 0 locale TEXT 0 0 exchangeRate TEXT 0 0"},{"location":"sqlite-schema/#foreign-keys_9","title":"Foreign keys","text":"<p>None</p>"},{"location":"sqlite-schema/#indexes_9","title":"Indexes","text":"<p>None</p>"},{"location":"sqlite-schema/#deviceinfo","title":"DeviceInfo","text":""},{"location":"sqlite-schema/#columns_10","title":"Columns","text":"Name Type Not null Default PK key INTEGER 0 1 deviceId TEXT 0 0 deviceName TEXT 0 0 isActive CHAR(1) 0 0 isPrimary CHAR(1) 0 0"},{"location":"sqlite-schema/#foreign-keys_10","title":"Foreign keys","text":"<p>None</p>"},{"location":"sqlite-schema/#indexes_10","title":"Indexes","text":"Name Unique Columns Origin Partial DeviceInfoDeviceIdIndex 0 deviceId c 0"},{"location":"sqlite-schema/#expense","title":"Expense","text":""},{"location":"sqlite-schema/#columns_11","title":"Columns","text":"Name Type Not null Default PK key INTEGER 0 1 date DATE 0 0 catKey INTEGER 0 0 subCatKey INTEGER 0 0 amount REAL 0 0 periods INTEGER 0 0 notes TEXT 0 0 isDetailEntry CHAR(1) 0 0 masterKey INTEGER 0 0 includesReceipt CHAR(1) 0 'N' 0 payFrom INTEGER 0 0 0 payeeKey INTEGER 0 0 0 billKey INTEGER 0 0 0 deviceIdKey INTEGER 0 0 deviceKey INTEGER 0 0 timeStamp DATETIME 0 0 currency TEXT 0 0 currencyAmount TEXT 0 0 recurringKey INTEGER 0 0 0 isCategorySplit CHAR(1) 0 'N' 0"},{"location":"sqlite-schema/#foreign-keys_11","title":"Foreign keys","text":"<p>None</p>"},{"location":"sqlite-schema/#indexes_11","title":"Indexes","text":"Name Unique Columns Origin Partial ExpenseDeviceIdDeviceKeyIndex 0 deviceIdKey, deviceKey c 0 ExpenseDateIndex 0 date c 0"},{"location":"sqlite-schema/#fihints","title":"FIHints","text":""},{"location":"sqlite-schema/#columns_12","title":"Columns","text":"Name Type Not null Default PK key INTEGER 0 1 accountKey INTEGER 0 0 name TEXT 0 0 trnType INTEGER 0 0 processAs INTEGER 0 0 catKey INTEGER 0 0 subCatKey INTEGER 0 0 payeeKey INTEGER 0 0 account2Key INTEGER 0 0"},{"location":"sqlite-schema/#foreign-keys_12","title":"Foreign keys","text":"<p>None</p>"},{"location":"sqlite-schema/#indexes_12","title":"Indexes","text":"Name Unique Columns Origin Partial FIHintsNameIndex 0 accountKey, name, trnType c 0"},{"location":"sqlite-schema/#fitrans","title":"FITrans","text":""},{"location":"sqlite-schema/#columns_13","title":"Columns","text":"Name Type Not null Default PK key INTEGER 0 1 accountKey INTEGER 0 0 fiTID TEXT 0 0 trnType TEXT 0 0 datePosted TEXT 0 0 trnAmount TEXT 0 0 sic TEXT 0 0 name TEXT 0 0 processState CHAR(1) 0 'U' 0 processAs INTEGER 0 0 catKey INTEGER 0 0 subCatKey INTEGER 0 0 payeeKey INTEGER 0 0 account2Key INTEGER 0 0"},{"location":"sqlite-schema/#foreign-keys_13","title":"Foreign keys","text":"<p>None</p>"},{"location":"sqlite-schema/#indexes_13","title":"Indexes","text":"Name Unique Columns Origin Partial FITransFiTIDIndex 0 accountKey, fiTID c 0"},{"location":"sqlite-schema/#income","title":"Income","text":""},{"location":"sqlite-schema/#columns_14","title":"Columns","text":"Name Type Not null Default PK key INTEGER 0 1 date DATE 0 0 name TEXT 0 0 amount REAL 0 0.00 0 notes TEXT 0 0 masterKey INTEGER 0 0 addIncomeTo INTEGER 0 0 0 deviceIdKey INTEGER 0 0 deviceKey INTEGER 0 0 timeStamp DATETIME 0 0 currency TEXT 0 0 currencyAmount TEXT 0 0 recurringKey INTEGER 0 0 0"},{"location":"sqlite-schema/#foreign-keys_14","title":"Foreign keys","text":"<p>None</p>"},{"location":"sqlite-schema/#indexes_14","title":"Indexes","text":"Name Unique Columns Origin Partial IncomeDeviceIdDeviceKeyIndex 0 deviceIdKey, deviceKey c 0 IncomeDate 0 date c 0"},{"location":"sqlite-schema/#payee","title":"Payee","text":""},{"location":"sqlite-schema/#columns_15","title":"Columns","text":"Name Type Not null Default PK key INTEGER 0 1 name TEXT 0 0 accountNum TEXT 0 0 phoneNum TEXT 0 0 webURL TEXT 0 0 deviceIdKey INTEGER 0 0 deviceKey INTEGER 0 0 notes TEXT 0 0"},{"location":"sqlite-schema/#foreign-keys_15","title":"Foreign keys","text":"<p>None</p>"},{"location":"sqlite-schema/#indexes_15","title":"Indexes","text":"Name Unique Columns Origin Partial PayeeDeviceIdDeviceKeyIndex 0 deviceIdKey, deviceKey c 0"},{"location":"sqlite-schema/#recurringbill","title":"RecurringBill","text":""},{"location":"sqlite-schema/#columns_16","title":"Columns","text":"Name Type Not null Default PK key INTEGER 0 1 billType INTEGER 0 0 0 payeeOrAccountKey INTEGER 0 0 amount TEXT 0 0 nextGenDate DATE 0 0 recurringIndex INTEGER 0 0 modulus INTEGER 0 0 deviceIdKey INTEGER 0 0 deviceKey INTEGER 0 0 currency TEXT 0 0 currencyAmount TEXT 0 0 endDate DATE 0 0 generateNow CHAR(1) 0 'N' 0 catKey INTEGER 0 0 0 subCatKey INTEGER 0 0 0 fromAccountKey INTEGER 0 0 0 notes TEXT 0 0"},{"location":"sqlite-schema/#foreign-keys_16","title":"Foreign keys","text":"<p>None</p>"},{"location":"sqlite-schema/#indexes_16","title":"Indexes","text":"<p>None</p>"},{"location":"sqlite-schema/#recurringexpense","title":"RecurringExpense","text":""},{"location":"sqlite-schema/#columns_17","title":"Columns","text":"Name Type Not null Default PK key INTEGER 0 1 subCatKey INTEGER 0 0 catKey INTEGER 0 0 amount TEXT 0 0 timesAYear INTEGER 0 0 nextGenDate DATE 0 0 modulus INTEGER 0 0 payFrom INTEGER 0 0 payee INTEGER 0 0 notes TEXT 0 0 deviceIdKey INTEGER 0 0 deviceKey INTEGER 0 0 currency TEXT 0 0 currencyAmount TEXT 0 0 endDate DATE 0 0 generateNow CHAR(1) 0 'N' 0"},{"location":"sqlite-schema/#foreign-keys_17","title":"Foreign keys","text":"<p>None</p>"},{"location":"sqlite-schema/#indexes_17","title":"Indexes","text":"<p>None</p>"},{"location":"sqlite-schema/#recurringincome","title":"RecurringIncome","text":""},{"location":"sqlite-schema/#columns_18","title":"Columns","text":"Name Type Not null Default PK key INTEGER 0 1 name TEXT 0 0 amount REAL 0 0.00 0 startDate DATE 0 0 timesAYear INTEGER 0 0 notes TEXT 0 0 nextGenDate DATE 0 0 modulus INTEGER 0 0 addIncomeTo INTEGER 0 0 0 deviceIdKey INTEGER 0 0 deviceKey INTEGER 0 0 currency TEXT 0 0 currencyAmount TEXT 0 0 endDate DATE 0 0 generateNow CHAR(1) 0 'N' 0"},{"location":"sqlite-schema/#foreign-keys_18","title":"Foreign keys","text":"<p>None</p>"},{"location":"sqlite-schema/#indexes_18","title":"Indexes","text":"<p>None</p>"},{"location":"sqlite-schema/#recurringtransfer","title":"RecurringTransfer","text":""},{"location":"sqlite-schema/#columns_19","title":"Columns","text":"Name Type Not null Default PK key INTEGER 0 1 name TEXT 0 0 fromAccount INTEGER 0 0 toAccount INTEGER 0 0 amount REAL 0 0.00 0 timesAYear INTEGER 0 0 nextGenDate DATE 0 0 modulus INTEGER 0 0 notes TEXT 0 0 deviceIdKey INTEGER 0 0 deviceKey INTEGER 0 0 currency TEXT 0 0 currencyAmount TEXT 0 0 endDate DATE 0 0 generateNow CHAR(1) 0 'N' 0"},{"location":"sqlite-schema/#foreign-keys_19","title":"Foreign keys","text":"<p>None</p>"},{"location":"sqlite-schema/#indexes_19","title":"Indexes","text":"<p>None</p>"},{"location":"sqlite-schema/#settings","title":"Settings","text":""},{"location":"sqlite-schema/#columns_20","title":"Columns","text":"Name Type Not null Default PK cyclestart INTEGER 0 0 lastRun DATETIME 0 0 currency TEXT 0 0 initialBudget REAL 0 0 email TEXT 0 0 locale TEXT 0 0 dateFormat TEXT 0 0 imageResolution INTEGER 0 0 deleteExpenseAfter INTEGER 0 0 deleteReceiptAfter INTEGER 0 0 debugFlag INTEGER 0 0 screenMajor INTEGER 0 0 screenMinor 0 0 screenMini INTEGER 0 0 screenMicro INTEGER 0 0 passwordOnOff INTEGER 0 0 password TEXT 0 0 passwordEmail TEXT 0 0 future1 TEXT 0 0 future2 TEXT 0 0 future3 TEXT 0 0 future4 TEXT 0 0 future5 TEXT 0 0 future6 TEXT 0 0 future7 TEXT 0 0 future8 TEXT 0 0 future9 TEXT 0 0 future10 TEXT 0 0 lastUsedAccount INTEGER 0 0 0 colorScheme INTEGER 0 2 0 lastUsedPayee INTEGER 0 0 0 monthlyCycleStart INTEGER 0 1 0 rolloverStart TEXT 0 '' 0 showBillReminders CHAR(1) 0 'N' 0 showBillBadge CHAR(1) 0 'N' 0 startPage INTEGER 0 0 0 includeFutureTrans CHAR(1) 0 'Y' 0 showMonthlyBudgetView CHAR(1) 0 'N' 0 keyBoardClicks CHAR(1) 0 'Y' 0 billLookForward INTEGER 0 6 0 billNotifyHour INTEGER 0 2 0 showAmountInNumbers CHAR(1) 0 'N' 0 importMatchLength INTEGER 0 16 0 homeScreenStyle INTEGER 0 1 0"},{"location":"sqlite-schema/#foreign-keys_20","title":"Foreign keys","text":"<p>None</p>"},{"location":"sqlite-schema/#indexes_20","title":"Indexes","text":"<p>None</p>"},{"location":"sqlite-schema/#subcategory","title":"SubCategory","text":""},{"location":"sqlite-schema/#columns_21","title":"Columns","text":"Name Type Not null Default PK key INTEGER 0 1 catKey INTEGER 0 0 name TEXT 0 0 icon TEXT 0 0 deleteOK CHAR(1) 0 'Y' 0 amount REAL 0 0.00 0 forPeriod INTEGER 0 1 0 autoGenExpEntry CHAR(1) 0 'N' 0 autoGenDay INTEGER 0 1 0 recurExpAmount TEXT 0 0 nextGenDate DATE 0 0 timesAYear INTEGER 0 0 modulus INTEGER 0 0 payFrom INTEGER 0 0 0 expenseType INTEGER 0 1 0 seqNum INTEGER 0 0 0 payee INTEGER 0 0 0 deviceIdKey INTEGER 0 0 deviceKey INTEGER 0 0"},{"location":"sqlite-schema/#foreign-keys_21","title":"Foreign keys","text":"<p>None</p>"},{"location":"sqlite-schema/#indexes_21","title":"Indexes","text":"<p>None</p>"},{"location":"sqlite-schema/#syncinfo","title":"SyncInfo","text":""},{"location":"sqlite-schema/#columns_22","title":"Columns","text":"Name Type Not null Default PK inAGroup CHAR(1) 0 0 groupName TEXT 0 0 password TEXT 0 0 passwordEmail TEXT 0 0 lastUpdateSeq INTEGER 0 0 enforceRestrictions CHAR(1) 0 0 lastSync DATETIME 0 0"},{"location":"sqlite-schema/#foreign-keys_22","title":"Foreign keys","text":"<p>None</p>"},{"location":"sqlite-schema/#indexes_22","title":"Indexes","text":"<p>None</p>"},{"location":"sqlite-schema/#syncupdate","title":"SyncUpdate","text":""},{"location":"sqlite-schema/#columns_23","title":"Columns","text":"Name Type Not null Default PK key INTEGER 0 1 updateType TEXT 0 0 uuid TEXT 0 0 payload TEXT 0 0"},{"location":"sqlite-schema/#foreign-keys_23","title":"Foreign keys","text":"<p>None</p>"},{"location":"sqlite-schema/#indexes_23","title":"Indexes","text":"<p>None</p>"},{"location":"sqlite-schema/#transfer","title":"Transfer","text":""},{"location":"sqlite-schema/#columns_24","title":"Columns","text":"Name Type Not null Default PK key INTEGER 0 1 transferDate DATE 0 0 fromAccount INTEGER 0 0 toAccount INTEGER 0 0 amount REAL 0 0.00 0 notes TEXT 0 0 billKey INTEGER 0 0 0 deviceIdKey INTEGER 0 0 deviceKey INTEGER 0 0 currency TEXT 0 0 currencyAmount TEXT 0 0 recurringKey INTEGER 0 0 0"},{"location":"sqlite-schema/#foreign-keys_24","title":"Foreign keys","text":"<p>None</p>"},{"location":"sqlite-schema/#indexes_24","title":"Indexes","text":"<p>None</p>"},{"location":"sync-update/","title":"Sync Update Mechanism","text":""},{"location":"sync-update/#table-of-contents","title":"Table of contents","text":"<ul> <li>Overview</li> <li>Configuration driven payloads</li> <li>SyncUpdate table structure</li> <li>Encoding and decoding</li> <li>Payload structure by operation</li> <li>Update operations and attribute fan out</li> <li>Device identifiers</li> <li>Wrapper integration flow</li> <li>References</li> </ul>"},{"location":"sync-update/#overview","title":"Overview","text":"<p>HomeBudget uses the SyncUpdate table as a queue for pending sync operations. When a transaction is created, updated, or deleted through the application UI, a corresponding entry is written to SyncUpdate with an encoded JSON payload that describes the operation. The sync service reads these entries, uploads them to the sync server, and removes them from the queue after successful sync.</p> <p>The wrapper mirrors this behavior by inserting SyncUpdate entries for each transaction it creates or updates so changes propagate to other devices in the sync group.</p>"},{"location":"sync-update/#configuration-driven-payloads","title":"Configuration driven payloads","text":"<p>Sync payloads are configuration driven. The wrapper reads src/python/homebudget/sync-config.json to define payload fields, key formats, and compression rules per operation.</p> <p>Key configuration concepts:</p> <ul> <li>Each resource has per operation field lists and compression rules.</li> <li>Key fields can be singular or array, depending on the operation.</li> <li>Padding rules are operation specific and may apply only to smaller payloads.</li> </ul> <p>The implementation that loads and applies the configuration is in src/python/homebudget/sync.py.</p>"},{"location":"sync-update/#syncupdate-table-structure","title":"SyncUpdate table structure","text":"Column Type Description key INTEGER Primary key, auto incremented updateType TEXT Operation category, currently set to Any uuid TEXT Unique identifier for the operation payload TEXT Base64 encoded and zlib compressed JSON payload <p>Source: Sqlite Schema</p>"},{"location":"sync-update/#encoding-and-decoding","title":"Encoding and decoding","text":"<p>The payload field follows a multi step encoding process. Rules are defined per operation in the configuration.</p> <ul> <li>Full zlib format is required, raw deflate fails for native payloads.</li> <li>URL safe base64 is required and trailing = must be stripped.</li> <li>Padding is operation specific, not a fixed payload length.</li> </ul>"},{"location":"sync-update/#encoding-flow","title":"Encoding flow","text":"<ol> <li>Serialize the operation to compact JSON with no spaces</li> <li>Compress with full zlib format using wbits 15 and compression level 9</li> <li>If configured, pad with null bytes to a minimum size</li> <li>Encode with URL safe base64 using - and _</li> <li>Strip trailing = padding</li> </ol>"},{"location":"sync-update/#decoding-flow","title":"Decoding flow","text":"<ol> <li>Convert URL safe base64 to standard base64</li> <li>Add = padding if needed for a multiple of four length</li> <li>Decode base64 to binary</li> <li>Strip trailing null bytes that were used for minimum size padding</li> <li>Decompress with full zlib format using wbits 15</li> <li>Parse the UTF 8 JSON string</li> </ol> <p>Reference implementations:</p> <ul> <li>Encoder: src/python/homebudget/sync.py</li> <li>Decoder: tests/manual/verify_syncupdate.py</li> </ul>"},{"location":"sync-update/#payload-structure-by-operation","title":"Payload structure by operation","text":"<p>The payload is operation specific. These examples mirror the current config and implementation. Fields shown are required for each operation.</p>"},{"location":"sync-update/#expense-operations","title":"Expense operations","text":"<p>AddExpense uses an array key and full transaction detail fields.</p> <pre><code>{\n    \"periods\": 1,\n    \"Operation\": \"AddExpense\",\n    \"accountDeviceKey\": 3,\n    \"timeStamp\": \"2026-02-16 10:36:25\",\n    \"expenseDeviceKeys\": [13073],\n    \"currencyAmount\": \"25\",\n    \"billDeviceKey\": 0,\n    \"billDeviceId\": \"\",\n    \"expenseDateString\": \"2026-02-16\",\n    \"receiptImageNeedsSaving\": \"False\",\n    \"currency\": \"SGD\",\n    \"categoryDeviceKey\": 12,\n    \"amount\": 25.0,\n    \"accountDeviceId\": \"A6F3C991-022C-407C-99B1-6E9402E8D674\",\n    \"notesString\": \"test\",\n    \"payeeDeviceKey\": 0,\n    \"payeeDeviceId\": \"\",\n    \"recurringKey\": 0,\n    \"subcategoryDeviceId\": \"A6F3C991-022C-407C-99B1-6E9402E8D674\",\n    \"subcategoryDeviceKey\": 49,\n    \"deviceId\": \"448cc747-79b2-46bf-93e2-4f62a91d4fe6\",\n    \"categoryDeviceId\": \"A6F3C991-022C-407C-99B1-6E9402E8D674\"\n}\n</code></pre> <p>UpdateExpense uses a singular key and the full set of update fields.</p> <pre><code>{\n    \"Operation\": \"UpdateExpense\",\n    \"accountDeviceKey\": 3,\n    \"timeStamp\": \"2026-02-16 10:36:25\",\n    \"expenseDeviceKey\": 13073,\n    \"currencyAmount\": \"25\",\n    \"expenseDateString\": \"2026-02-16\",\n    \"receiptImageNeedsSaving\": \"False\",\n    \"currency\": \"SGD\",\n    \"categoryDeviceKey\": 12,\n    \"amount\": 25.0,\n    \"accountDeviceId\": \"A6F3C991-022C-407C-99B1-6E9402E8D674\",\n    \"notesString\": \"test\",\n    \"payeeDeviceKey\": 0,\n    \"payeeDeviceId\": \"\",\n    \"subcategoryDeviceId\": \"A6F3C991-022C-407C-99B1-6E9402E8D674\",\n    \"subcategoryDeviceKey\": 49,\n    \"deviceId\": \"448cc747-79b2-46bf-93e2-4f62a91d4fe6\",\n    \"categoryDeviceId\": \"A6F3C991-022C-407C-99B1-6E9402E8D674\"\n}\n</code></pre> <p>DeleteExpense uses a minimal payload with a singular key.</p> <pre><code>{\n    \"Operation\": \"DeleteExpense\",\n    \"expenseDeviceKey\": 13073,\n    \"deviceId\": \"448cc747-79b2-46bf-93e2-4f62a91d4fe6\"\n}\n</code></pre>"},{"location":"sync-update/#income-operations","title":"Income operations","text":"<p>AddIncome uses a singular key and a smaller payload with name and incomeText fields.</p> <pre><code>{\n    \"Operation\": \"AddIncome\",\n    \"accountDeviceId\": \"A6F3C991-022C-407C-99B1-6E9402E8D674\",\n    \"accountDeviceKey\": 3,\n    \"amount\": \"125.00\",\n    \"currency\": \"USD\",\n    \"currencyAmount\": \"125.00\",\n    \"deviceId\": \"448cc747-79b2-46bf-93e2-4f62a91d4fe6\",\n    \"deviceKey\": 1401,\n    \"incomeText\": \"2026-02-17\",\n    \"name\": \"Salary\",\n    \"notes\": \"\",\n    \"recurringKey\": 0,\n    \"timeStamp\": \"2026-02-17 18:54:23\"\n}\n</code></pre> <p>UpdateIncome uses the same key format and updates the same field set.</p> <pre><code>{\n    \"Operation\": \"UpdateIncome\",\n    \"accountDeviceId\": \"A6F3C991-022C-407C-99B1-6E9402E8D674\",\n    \"accountDeviceKey\": 3,\n    \"amount\": \"130.00\",\n    \"currency\": \"USD\",\n    \"currencyAmount\": \"130.00\",\n    \"deviceId\": \"448cc747-79b2-46bf-93e2-4f62a91d4fe6\",\n    \"deviceKey\": 1401,\n    \"incomeText\": \"2026-02-17\",\n    \"name\": \"Salary\",\n    \"notes\": \"\",\n    \"timeStamp\": \"2026-02-17 19:02:05\"\n}\n</code></pre> <p>DeleteIncome uses a minimal payload with a singular key.</p> <pre><code>{\n    \"Operation\": \"DeleteIncome\",\n    \"deviceKey\": 1401,\n    \"deviceId\": \"448cc747-79b2-46bf-93e2-4f62a91d4fe6\"\n}\n</code></pre>"},{"location":"sync-update/#transfer-operations","title":"Transfer operations","text":"<p>AddTransfer uses a singular key and includes from/to account details and forex amounts.</p> <pre><code>{\n    \"Operation\": \"AddTransfer\",\n    \"accountFromDeviceId\": \"A6F3C991-022C-407C-99B1-6E9402E8D674\",\n    \"accountFromDeviceKey\": 3,\n    \"accountToDeviceId\": \"A6F3C991-022C-407C-99B1-6E9402E8D674\",\n    \"accountToDeviceKey\": 5,\n    \"amount\": \"148.15\",\n    \"currency\": \"SGD\",\n    \"currencyAmount\": \"200.00\",\n    \"deviceId\": \"448cc747-79b2-46bf-93e2-4f62a91d4fe6\",\n    \"deviceKey\": 2001,\n    \"notes\": \"Transfer between accounts\",\n    \"recurringKey\": 0,\n    \"timeStamp\": \"2026-02-22 14:00:00\",\n    \"transferDateString\": \"2026-02-22\"\n}\n</code></pre> <p>UpdateTransfer uses the same key format and updates the same field set.</p> <pre><code>{\n    \"Operation\": \"UpdateTransfer\",\n    \"accountFromDeviceId\": \"A6F3C991-022C-407C-99B1-6E9402E8D674\",\n    \"accountFromDeviceKey\": 3,\n    \"accountToDeviceId\": \"A6F3C991-022C-407C-99B1-6E9402E8D674\",\n    \"accountToDeviceKey\": 5,\n    \"amount\": \"148.15\",\n    \"currency\": \"SGD\",\n    \"currencyAmount\": \"200.00\",\n    \"deviceId\": \"448cc747-79b2-46bf-93e2-4f62a91d4fe6\",\n    \"deviceKey\": 2001,\n    \"notes\": \"Updated transfer notes\",\n    \"timeStamp\": \"2026-02-22 14:15:00\",\n    \"transferDateString\": \"2026-02-22\"\n}\n</code></pre> <p>DeleteTransfer uses a minimal payload with a singular key.</p> <pre><code>{\n    \"Operation\": \"DeleteTransfer\",\n    \"deviceKey\": 2001,\n    \"deviceId\": \"448cc747-79b2-46bf-93e2-4f62a91d4fe6\"\n}\n</code></pre>"},{"location":"sync-update/#update-operations","title":"Update operations","text":"<p>Update operations generate a SyncUpdate entry per changed attribute. The wrapper creates one SyncUpdate entry for each field change, using the full final record payload in each entry. This mirrors native behavior where a multi field update results in multiple sync events.</p> <p>This behavior is implemented in <code>create_updates_for_changes</code> in src/python/homebudget/sync.py.</p>"},{"location":"sync-update/#device-identifiers","title":"Device identifiers","text":"<p>Device identifiers link operations to devices in the sync group. The wrapper resolves the primary device from DeviceInfo, then resolves entity device ids for related records such as Account, Category, and SubCategory.</p> <p>Resolution details:</p> <ul> <li>Primary device is the first record with isPrimary and isActive set to Y.</li> <li>Entity device ids come from deviceIdKey values and are resolved in DeviceInfo.</li> </ul>"},{"location":"sync-update/#wrapper-integration-flow","title":"Wrapper integration flow","text":"<ol> <li>Begin a database transaction</li> <li>Insert or update the resource record</li> <li>Insert related AccountTrans rows when needed</li> <li>Build the payload from <code>sync-config.json</code></li> <li>Encode the payload with the configured compression rules</li> <li>Insert SyncUpdate row with <code>updateType</code>='Any' and a new UUID</li> <li>Commit the transaction</li> </ol> <p>If any step fails, the transaction is rolled back to keep the database consistent.</p>"},{"location":"sync-update/#references","title":"References","text":"<ul> <li>SQLite Schema Reference</li> </ul>"},{"location":"test-cases/","title":"Test Cases","text":""},{"location":"test-cases/#table-of-contents","title":"Table of contents","text":"<ul> <li>Overview</li> <li>Automated tests</li> <li>Manual tests</li> </ul>"},{"location":"test-cases/#overview","title":"Overview","text":"<p>This document lists system integration tests, manual tests, and forex rate and inference tests. It describes the test coverage and the new forex test cases in a single place.</p>"},{"location":"test-cases/#automated-tests","title":"Automated tests","text":""},{"location":"test-cases/#unit-tests","title":"Unit tests","text":"<ul> <li>Exception types and messages, including DuplicateError, NotFoundError, and validation errors.</li> <li>DTO validation for required fields, positive amounts, and allowed value ranges.</li> <li>DTO serialization and deserialization for date, decimal, and currency fields.</li> <li>Schema constants and table references for core entities such as Expense, Income, Transfer, AccountTrans, and SyncUpdate.</li> </ul>"},{"location":"test-cases/#system-integration-tests","title":"System integration tests","text":"<ul> <li>Repository connection and account listing, including open and close behavior.</li> <li>Expense create, read, update, delete, and list behavior with date filters.</li> <li>Expense SyncUpdate payload validation for AddExpense operations and payload keys.</li> <li>Income create, read, update, delete, and list behavior with date filters.</li> <li>Income forex payload validation for currency and currencyAmount fields.</li> <li>Transfer create, read, update, delete, and list behavior with date filters.</li> <li>Transfer dual AccountTrans creation for transfer out and transfer in rows.</li> <li>Currency matching rules for base and non base account scenarios.</li> <li>Positive amount constraints for expense, income, and transfer DTOs.</li> <li>SyncUpdate payload structure and required keys for core operations.</li> <li>Batch add for expense, income, and transfer DTO collections with success and failure reporting.</li> <li>Batch operations with continue on error behavior and stop on error behavior.</li> <li>Forex rate fetch writes cache file with timestamp, base, and rates.</li> <li>Forex rate fetch uses cache within TTL and returns cached value.</li> <li>Forex rate fetch uses stale cache on API failure when cache is expired.</li> <li>Forex rate fetch returns fallback rate when no cache exists and API fails.</li> <li>Invalid currency code returns a validation error.</li> <li>Non base account amount only inference sets currency, currency amount, and exchange rate with amount unset.</li> <li>Base account foreign transaction requires currency and currency amount.</li> <li>Transfer base to non base amount only calculates currency amount without rounding.</li> </ul>"},{"location":"test-cases/#manual-tests","title":"Manual tests","text":""},{"location":"test-cases/#manual-test-runner-inventory","title":"Manual test runner inventory","text":"<ul> <li>uat_expense_crud, full expense create, read, update, delete with sync verification.</li> <li>uat_income_crud, full income create, read, update, delete with sync verification.</li> <li>uat_transfer_crud, full transfer create, read, update, delete with sync verification.</li> <li>uat_expense_currency_usd, expense create and delete with foreign currency fields.</li> <li>uat_income_currency_usd, income create and delete with foreign currency fields.</li> <li>uat_transfer_currency_usd, transfer create and delete with foreign currency fields.</li> <li>uat_batch_mixed_operations, mixed batch add, update, delete with sync verification.</li> <li>uat_batch_import_csv, CSV batch import with sync verification.</li> <li>uat_forex_expense_amount_only, expense on non base account with amount only and inferred rate.</li> <li>uat_forex_income_amount_only, income on non base account with amount only and inferred rate.</li> <li>uat_forex_transfer_amount_only, transfer from base to non base with amount only and inferred rate.</li> <li>uat_forex_base_account_validation, base account foreign transaction missing currency amount.</li> </ul>"},{"location":"test-cases/#manual-procedures","title":"Manual procedures","text":"<ul> <li>Expense create, read, update, delete with sync verification in desktop and mobile apps.</li> <li>Transfer create, read, update, delete with sync verification in desktop and mobile apps.</li> <li>SyncUpdate validation procedure for newly created operations and payload presence.</li> <li>Forex expense on non base account with amount only, verify currency fields and base amount in both apps.</li> <li>Forex income on non base account with amount only, verify currency fields in both apps.</li> <li>Forex transfer from base to non base with amount only, verify currency amount and rate in both apps.</li> <li>Base account foreign transaction validation, confirm error and no data written.</li> </ul>"},{"location":"test-guide/","title":"Test Guide","text":""},{"location":"test-guide/#table-of-contents","title":"Table of contents","text":"<ul> <li>Related documents</li> <li>Overview</li> <li>Test Types</li> <li>Prerequisites</li> <li>Running Tests</li> <li>UAT Test Workflow</li> <li>Feature Coverage</li> <li>Troubleshooting</li> <li>Test Development</li> <li>Continuous Integration</li> </ul>"},{"location":"test-guide/#related-documents","title":"Related documents","text":"<ul> <li>Developer Guide - Development setup</li> <li>Implementation Plan - Feature implementation phases</li> <li>Sync Mechanism - SyncUpdate details</li> <li>SQLite Schema - Database structure</li> </ul>"},{"location":"test-guide/#overview","title":"Overview","text":"<p>This guide covers how to run tests for the HomeBudget Wrapper, including unit tests, manual tests \u2014 SIT \u2014 and User Acceptance Tests \u2014 UAT.</p>"},{"location":"test-guide/#test-types","title":"Test Types","text":""},{"location":"test-guide/#unit-tests","title":"Unit Tests","text":"<p>Automated tests for Python code modules and functions.</p>"},{"location":"test-guide/#system-integration-tests-sit","title":"System Integration Tests (SIT)","text":"<p>Manual tests that verify wrapper functionality without involving mobile devices.</p>"},{"location":"test-guide/#user-acceptance-tests-uat","title":"User Acceptance Tests (UAT)","text":"<p>Manual tests that verify complete CRUD workflows with sync validation across desktop and mobile devices.</p>"},{"location":"test-guide/#prerequisites","title":"Prerequisites","text":""},{"location":"test-guide/#for-all-tests","title":"For All Tests","text":"<ul> <li>Python 3.12+</li> <li>Wrapper installed in editable mode: <code>pip install -e .</code></li> <li>Development environment configured per Developer Guide</li> </ul>"},{"location":"test-guide/#for-manual-tests-sit-and-uat","title":"For Manual Tests \u2014 SIT and UAT","text":"<ul> <li>Configuration file with correct database path</li> <li>Location: <code>%USERPROFILE%\\OneDrive\\Documents\\HomeBudgetData\\hb-config.json</code></li> <li> <p>See Configuration Guide for setup</p> </li> <li> <p>Database: HomeBudget.db with test data</p> </li> <li>Test resources must exist: </li> <li>Account: \"TWH - Personal\"</li> <li>Account: \"30 CC Hashemis\" for transfers</li> <li>Category: \"Food (Basic)\"</li> <li>Category: \"Salary and Wages\" for income</li> <li>Subcategory under Food: \"Cheap restaurant\"</li> </ul>"},{"location":"test-guide/#uat-tests-mobile-verification","title":"UAT Tests \u2014 Mobile Verification","text":"<ul> <li>Mobile device with HomeBudget app installed</li> <li>Mobile device on WiFi network</li> <li>Mobile app signed in with same account as desktop</li> <li>Easy access to mobile device to verify sync results</li> </ul>"},{"location":"test-guide/#running-tests","title":"Running Tests","text":""},{"location":"test-guide/#unit-tests_1","title":"Unit Tests","text":"<p>Run all unit tests: <pre><code>pytest\n</code></pre></p> <p>Run with coverage: <pre><code>pytest --cov=src/python/homebudget\n</code></pre></p> <p>Run specific test file: <pre><code>pytest tests/unit/test_models.py\n</code></pre></p>"},{"location":"test-guide/#manual-tests-system-integration-testing","title":"Manual Tests (System Integration Testing)","text":"<p>Manual tests verify wrapper functionality interactively. The test runner automates CLI operations and prompts you to verify UI changes.</p>"},{"location":"test-guide/#ui-control-during-manual-tests","title":"UI Control During Manual Tests","text":"<p>When manual tests execute CLI commands with sync enabled (default):</p> <ul> <li>HomeBudget UI automatically closes before each database operation</li> <li>Database changes are applied atomically while UI is closed</li> <li>HomeBudget UI automatically reopens after the operation completes</li> <li>This ensures data consistency and prevents incomplete state reads</li> </ul> <p>You may notice the HomeBudget application window briefly disappear and reappear during automated test steps. This is expected behavior and indicates UI control is working correctly.</p> <p>Observing UI Control:</p> <ol> <li>Watch the HomeBudget window during automated steps</li> <li>You'll see it close, database operation execute, then reopen</li> <li>This typically takes 6-11 seconds depending on application startup speed</li> <li>No manual intervention is needed; it's automatic</li> </ol>"},{"location":"test-guide/#list-available-sit-tests","title":"List Available SIT Tests","text":"<pre><code>python tests/manual/manual_test_runner.py --list\n</code></pre> <p>Output shows available test IDs and descriptions.</p>"},{"location":"test-guide/#run-a-specific-sit-test","title":"Run a Specific SIT Test","text":"<pre><code>python tests/manual/manual_test_runner.py --test-id &lt;test_id&gt;\n</code></pre> <p>Example: <pre><code>python tests/manual/manual_test_runner.py --test-id sync_validation\n</code></pre></p>"},{"location":"test-guide/#run-tests-interactively","title":"Run Tests Interactively","text":"<p>If no <code>--test-id</code> specified, the runner shows a menu: <pre><code>python tests/manual/manual_test_runner.py\n</code></pre></p>"},{"location":"test-guide/#results","title":"Results","text":"<p>Results are saved to <code>tests/manual/results/&lt;test-id&gt;-&lt;timestamp&gt;.md</code> with:</p> <ul> <li>Test summary (overall pass/fail/incomplete)</li> <li>Step-by-step results with commands, outputs, and notes</li> <li>Timestamps for each test run</li> </ul> <p>View latest result: <pre><code>ls -t tests/manual/results/*.md | head -1\n</code></pre></p>"},{"location":"test-guide/#uat-tests-full-crud-with-mobile-sync","title":"UAT Tests \u2014 Full CRUD with Mobile Sync","text":"<p>UAT tests verify complete Create-Read-Update-Delete workflows with mobile synchronization. These tests require manual verification that changes sync to mobile devices.</p>"},{"location":"test-guide/#available-uat-tests","title":"Available UAT Tests","text":"<pre><code>python tests/manual/manual_test_runner.py --list\n</code></pre> <p>Three main UAT tests:</p> <ul> <li><code>uat_expense_crud</code> - Expense full CRUD with sync validation</li> <li><code>uat_income_crud</code> - Income full CRUD with sync validation</li> <li><code>uat_transfer_crud</code> - Transfer full CRUD with sync validation</li> </ul>"},{"location":"test-guide/#run-single-uat-test","title":"Run Single UAT Test","text":"<pre><code>python tests/manual/manual_test_runner.py --test-id uat_expense_crud\n</code></pre> <p>This will:</p> <ol> <li>Verify configuration is ready \u2014 you confirm</li> <li>Create a test expense via CLI \u2014 automated</li> <li>Verify SyncUpdate entry created \u2014 automated</li> <li>Ask you to verify expense appears in Windows AND mobile apps \u2014 manual</li> <li>List expenses and ask you to record the key \u2014 interactive</li> <li>Read the expense \u2014 automated</li> <li>Update the expense \u2014 automated</li> <li>Verify sync \u2014 manual</li> <li>Delete the expense \u2014 automated</li> <li>Verify sync \u2014 manual</li> </ol>"},{"location":"test-guide/#run-all-uat-tests-sequentially","title":"Run All UAT Tests Sequentially","text":"<p>To run all UAT tests in order \u2014 expense, income, then transfer:</p> <pre><code>python tests/manual/manual_test_runner.py --test-id uat_expense_crud\npython tests/manual/manual_test_runner.py --test-id uat_income_crud\npython tests/manual/manual_test_runner.py --test-id uat_transfer_crud\n</code></pre> <p>Or use a loop: <pre><code>for test in uat_expense_crud uat_income_crud uat_transfer_crud; do\n  python tests/manual/manual_test_runner.py --test-id $test\ndone\n</code></pre></p>"},{"location":"test-guide/#specifying-output-directory","title":"Specifying Output Directory","text":"<pre><code>python tests/manual/manual_test_runner.py --test-id uat_expense_crud \\\n  --output-dir .dev/uat-results\n</code></pre>"},{"location":"test-guide/#reference-data-testing","title":"Reference Data Testing","text":"<p>Reference data tests verify read-only queries for accounts, categories, currencies, and other lookup tables. These are automated unit tests without mobile sync verification.</p> <p>Run reference data tests: <pre><code>pytest tests/unit/test_reference_data.py -v\n</code></pre></p> <p>Tests verify:</p> <ul> <li>Query all accounts and return correct structure</li> <li>Filter accounts by type or status</li> <li>List all categories with hierarchy</li> <li>Filter categories by parent</li> <li>Query currencies by code or name</li> </ul>"},{"location":"test-guide/#batch-operations-testing","title":"Batch Operations Testing","text":"<p>Batch operations tests verify importing multiple transactions from CSV or JSON files, with sync optimizations and error handling.</p> <p>Run batch operation tests:</p> <p>Automated tests: <pre><code>pytest tests/integration/test_batch_operations.py -v\n</code></pre></p> <p>Manual test with real data: <pre><code>python tests/manual/manual_test_runner.py --test-id sit_batch_import_csv\n</code></pre></p> <p>Batch operation capabilities:</p> <ul> <li>File formats: CSV with headers or JSON array of transaction objects</li> <li>Large files: Tested with 100 plus rows</li> <li>Individual input validation per record</li> <li>Sync disabled during individual processing, single sync after batch</li> <li>Result summary with success/failure counts</li> <li>Mixed-resource operations: Execute multiple operations (add, update, delete) across different resources (expense, income, transfer) in single batch</li> </ul> <p>Example batch commands: <pre><code># Import expenses from CSV\nhomebudget expense batch-import --file expenses.csv --format csv\n\n# Import income from JSON\nhomebudget income batch-import --file income.json --format json\n\n# Import transfers with currency normalization\nhomebudget transfer batch-import --file transfers.json --format json\n\n# Run mixed-resource batch operations\nhomebudget batch run --file operations.json\n</code></pre></p>"},{"location":"test-guide/#transfer-currency-normalization-testing","title":"Transfer Currency Normalization Testing","text":"<p>Transfer operations include comprehensive UAT test cases covering mixed-currency scenarios. See <code>tests/manual/TRANSFER_TEST_CASES.md</code> for detailed test case documentation.</p> <p>23 Transfer UAT Test Cases:</p> <ul> <li>3 Amount-only inference tests (base\u2192foreign, foreign\u2192base, foreign\u2192foreign)</li> <li>1 Same-currency test (no forex needed)</li> <li>3 Fully-specified tests (amount + currency_amount + rate)</li> <li>14 Invalid/error cases (over-specification, missing fields, constraint violations)</li> </ul> <p>Batch Transfer Tests: See <code>tests/manual/BATCH_TRANSFER_TEST_CASES.md</code> for batch transfer test scenarios including:</p> <ul> <li>Amount-only (inference) mode</li> <li>Explicit from-currency mode (pass through)</li> <li>Explicit to-currency mode (normalized to backend format)</li> <li>Parsing error handling</li> </ul> <p>Run transfer UAT tests: <pre><code># Run specific transfer test\npython tests/manual/manual_test_runner.py --test-id uat_transfer_amount_only_base_to_foreign\n\n# Run batch transfer test\npython tests/manual/manual_test_runner.py --test-id uat_batch_transfer_valid\n</code></pre></p> <p>Example batch commands: homebudget expense batch-import --file expenses.csv --format csv</p>"},{"location":"test-guide/#import-income-from-json","title":"Import income from JSON","text":"<p>homebudget income batch-import --file income.json --format json</p>"},{"location":"test-guide/#import-transfers-with-error-reporting","title":"Import transfers with error reporting","text":"<p>homebudget transfer batch-import --file transfers.csv --format csv --error-report errors.txt <pre><code>#### UAT Batch Import with Mobile Sync\n\nUAT batch testing validates that imported transactions sync correctly to mobile devices. This follows the same sync validation pattern as individual CRUD operations but for bulk imports.\n\n**Run UAT batch test:**\n```bash\npython tests/manual/manual_test_runner.py --test-id uat_batch_import_csv\n</code></pre></p> <p>Test workflow: 1. Setup \u2014 Note expense count in Windows and mobile apps 2. Import \u2014 Batch import 20 expenses from CSV via CLI (automated) 3. Verify Import \u2014 Check CLI summary shows 20 successful (automated) 4. Verify Desktop \u2014 Confirm all 20 expenses appear in Windows app (manual) 5. Verify Mobile \u2014 Wait 30 seconds for sync and verify on mobile (manual) 6. Check Totals \u2014 Verify transaction count increased by exactly 20 (manual)</p> <p>Expected result: All 20 batch-imported transactions appear in both Windows and mobile apps with correct amounts, categories, and dates.</p>"},{"location":"test-guide/#uat-test-workflow","title":"UAT Test Workflow","text":"<p>Each UAT test follows this pattern:</p>"},{"location":"test-guide/#1-setup-manual","title":"1. Setup \u2014 Manual","text":"<ul> <li>Confirm hb-config.json is configured</li> <li>Ensure mobile device is connected to WiFi</li> <li>Note current transaction counts in both apps</li> </ul>"},{"location":"test-guide/#2-create-automated-then-manual-verification","title":"2. Create \u2014 Automated then Manual Verification","text":"<p><pre><code>CLI Creates transaction \u2192 SyncUpdate inserted \u2192 Verify both apps updated\n</code></pre> - Wrapper CLI creates resource, which can be an expense, income, or transfer - Test runner verifies SyncUpdate entry exists - You verify: New transaction appears in Windows app AND mobile app</p>"},{"location":"test-guide/#3-read-automated","title":"3. Read \u2014 Automated","text":"<ul> <li>List transactions and record the resource key</li> <li>CLI retrieves transaction details</li> <li>You verify: Details match what was entered</li> </ul>"},{"location":"test-guide/#4-update-automated-then-manual-verification","title":"4. Update \u2014 Automated then Manual Verification","text":"<p><pre><code>CLI Updates amount/notes \u2192 SyncUpdate inserted \u2192 Verify both apps updated\n</code></pre> - CLI updates transaction - Test runner verifies SyncUpdate entry exists - You verify: Updated transaction appears in Windows app AND mobile app</p>"},{"location":"test-guide/#5-delete-automated-then-manual-verification","title":"5. Delete \u2014 Automated then Manual Verification","text":"<p><pre><code>CLI Deletes transaction \u2192 SyncUpdate inserted \u2192 Verify removed from both apps\n</code></pre> - CLI deletes transaction - Test runner verifies SyncUpdate entry exists - You verify: Transaction removed from Windows app AND mobile app</p>"},{"location":"test-guide/#feature-coverage","title":"Feature Coverage","text":"<p>The test suite covers all planned features from the implementation plan:</p> Feature Testing Type Status Entry Point 5.1 Expense CRUD UAT plus automated Enabled <code>uat_expense_crud</code> test 5.2 Income CRUD UAT plus automated Enabled <code>uat_income_crud</code> test 5.3 Transfer CRUD UAT plus automated Enabled <code>uat_transfer_crud</code> test 5.4 Reference Data Automated only Enabled <code>pytest tests/unit/test_reference_data.py</code> 5.5 CLI Commands Automated plus manual Enabled UAT tests use CLI, SIT can target specific commands 5.6 Batch Operations UAT plus automated Enabled <code>uat_batch_import_csv</code> test, <code>pytest tests/integration/test_batch_operations.py</code> <p>Test automation levels: - Automated only: Unit tests run without user interaction or mobile devices - Automated plus manual: Automated tests verify code paths, manual tests verify UI in HomeBudget on Windows and mobile - UAT: Full workflow including sync validation on mobile devices</p>"},{"location":"test-guide/#troubleshooting","title":"Troubleshooting","text":""},{"location":"test-guide/#test-runner-issues","title":"Test Runner Issues","text":""},{"location":"test-guide/#no-syncupdate-entries-found","title":"\"No SyncUpdate entries found\"","text":"<ul> <li>Ensure database path in hb-config.json is correct</li> <li>Verify sync is enabled in config</li> <li>Check that CLI commands executed successfully</li> </ul>"},{"location":"test-guide/#account-not-found-or-category-not-found","title":"\"Account not found\" or \"Category not found\"","text":"<ul> <li>Verify required test resources exist in database</li> <li>Check exact account/category names match \u2014 names are case-sensitive</li> <li>See prerequisites section above</li> </ul>"},{"location":"test-guide/#command-timeout","title":"\"Command timeout\"","text":"<ul> <li>Increase timeout in <code>manual_test_runner.py</code> \u2014 default is 30 seconds</li> <li>Check that CLI commands work manually</li> <li>Verify database is accessible</li> </ul>"},{"location":"test-guide/#sync-verification-issues","title":"Sync Verification Issues","text":""},{"location":"test-guide/#expense-doesnt-appear-on-mobile","title":"Expense doesn't appear on mobile","text":"<ol> <li>Check WiFi connectivity on both devices</li> <li>Verify both devices signed in with same account</li> <li>Check SyncUpdate entry in database: <code>python tests/manual/verify_syncupdate.py</code></li> <li>Check mobile app logs or wait longer for sync</li> <li>Verify device registration in DeviceInfo table</li> </ol>"},{"location":"test-guide/#mobile-shows-transaction-but-desktop-shows-error","title":"Mobile shows transaction but desktop shows error","text":"<ul> <li>Desktop transaction may have failed silently</li> <li>Check wrapper logs for errors</li> <li>Verify all required fields were populated</li> <li>Check database for partial transaction</li> </ul>"},{"location":"test-guide/#test-development","title":"Test Development","text":""},{"location":"test-guide/#adding-new-uat-tests","title":"Adding New UAT Tests","text":"<p>Edit <code>tests/manual/manual_tests.json</code> and add a new test object:</p> <pre><code>{\n  \"id\": \"uat_myresource_crud\",\n  \"title\": \"UAT: MyResource CRUD with sync validation\",\n  \"resource\": \"myresource\",\n  \"steps\": [\n    {\n      \"kind\": \"user\",\n      \"label\": \"Record count and verify mobile is on WiFi\"\n    },\n    {\n      \"kind\": \"auto\",\n      \"label\": \"Create test resource\",\n      \"command\": \"homebudget &lt;resource&gt; add --param value ...\"\n    },\n    ...\n  ]\n}\n</code></pre>"},{"location":"test-guide/#step-types","title":"Step Types","text":"<ul> <li><code>\"kind\": \"auto\"</code>: CLI command executed automatically</li> <li><code>\"command\"</code>: Shell command to run</li> <li><code>\"command_template\"</code>: Command with placeholders like <code>{expense_key}</code></li> <li><code>\"kind\": \"user\"</code>: Manual verification step</li> <li>Prompts user for pass/fail/skip and optional notes</li> <li>Can capture variables such as transaction key for use in later steps</li> </ul>"},{"location":"test-guide/#adding-batch-operation-tests","title":"Adding Batch Operation Tests","text":"<p>For UAT batch operations with mobile sync validation, add test with CSV and JSON file handling:</p> <pre><code>{\n  \"id\": \"uat_batch_import_expenses\",\n  \"title\": \"UAT: Batch import expenses from CSV with mobile sync validation\",\n  \"resource\": \"batch\",\n  \"steps\": [\n    {\n      \"kind\": \"user\",\n      \"label\": \"Record current expense count in Windows and mobile apps, ensure mobile is on WiFi\"\n    },\n    {\n      \"kind\": \"auto\",\n      \"label\": \"Import 20 expenses from CSV\",\n      \"command\": \"homebudget expense batch-import --file tests/fixtures/test_expenses.csv --format csv\"\n    },\n    {\n      \"kind\": \"auto\",\n      \"label\": \"Verify import summary shows 20 successful\",\n      \"command\": \"python tests/manual/verify_batch_import.py --count 20\"\n    },\n    {\n      \"kind\": \"user\",\n      \"label\": \"Verify: All 20 expenses appear in Windows app with correct amounts and categories\"\n    },\n    {\n      \"kind\": \"user\",\n      \"label\": \"Wait 30 seconds for sync, verify all 20 expenses appear on mobile device\"\n    },\n    {\n      \"kind\": \"user\",\n      \"label\": \"Verify: Transaction count increased by exactly 20 on both Windows and mobile\"\n    }\n  ]\n}\n</code></pre>"},{"location":"test-guide/#continuous-integration","title":"Continuous Integration","text":"<p>For CI/CD pipelines, unit tests can run automatically:</p> <pre><code>pytest --cov=src/python/homebudget --tb=short\n</code></pre> <p>Manual tests \u2014 both SIT and UAT \u2014 require human interaction and should be run locally before commits.</p>"},{"location":"test-strategy/","title":"Test strategy","text":""},{"location":"test-strategy/#table-of-contents","title":"Table of contents","text":"<ul> <li>Overview</li> <li>System integration tests</li> <li>User acceptance tests</li> <li>User feedback integration points</li> <li>Test fixture management</li> <li>Coverage targets</li> <li>Tooling and execution</li> <li>References</li> </ul>"},{"location":"test-strategy/#overview","title":"Overview","text":"<p>This strategy separates system integration tests from user acceptance tests. System integration tests cover data integrity, database operations, and payload encoding. User acceptance tests validate sync behavior and UI verification in the HomeBudget apps.</p>"},{"location":"test-strategy/#system-integration-tests","title":"System integration tests","text":"<p>System integration tests cover automated database behavior without HomeBudget UI or sync services.</p> <ul> <li>Unit tests for models, schema constants, exceptions, and utility helpers</li> <li>Integration tests for CRUD operations and SyncUpdate payload creation</li> <li>CLI tests for command parsing, output formats, and error handling</li> </ul>"},{"location":"test-strategy/#user-acceptance-tests","title":"User acceptance tests","text":"<p>User acceptance tests require HomeBudget Windows and mobile apps and verify sync and UI behavior.</p> <ul> <li>Sync confirmation in HomeBudget desktop and mobile apps</li> <li>Visual validation of transaction details after wrapper operations</li> <li>User confirmation for duplicate prevention behavior</li> </ul>"},{"location":"test-strategy/#user-feedback-integration-points","title":"User feedback integration points","text":"<ul> <li>User acceptance test procedures prompt the user to confirm UI results</li> <li>Results are recorded in manual test files with pass or fail notes</li> <li>Follow up tasks record issues discovered during manual validation</li> </ul>"},{"location":"test-strategy/#test-fixture-management","title":"Test fixture management","text":"<ul> <li>System integration tests use headless test databases in tests/fixtures (test_database.db, sync_test.db, empty_database.db)</li> <li>Each SIT test copies a fixture to a temporary path before modifications</li> <li>No test writes directly to a fixture file</li> <li>User acceptance tests use the live operational HomeBudget database connected to Windows and mobile apps</li> </ul>"},{"location":"test-strategy/#coverage-targets","title":"Coverage targets","text":"<ul> <li>System integration tests target at least 85 percent line coverage</li> <li>User acceptance tests target all user facing sync workflows</li> </ul>"},{"location":"test-strategy/#tooling-and-execution","title":"Tooling and execution","text":"<ul> <li>Use pytest for unit and integration tests</li> <li>Use temporary directories for isolated database tests</li> <li>Use helper utilities in tests utils for shared assertions and payload decoding</li> </ul>"},{"location":"test-strategy/#references","title":"References","text":"<ul> <li>docs/design.md</li> <li>docs/sync-update.md</li> <li>docs/test-cases.md</li> </ul>"},{"location":"transfer-currency-normalization/","title":"Transfer Currency Normalization Layer","text":""},{"location":"transfer-currency-normalization/#table-of-contents","title":"Table of contents","text":"<ul> <li>Overview</li> <li>Backend storage format</li> <li>User input modes</li> <li>Design rationale</li> <li>Implementation architecture</li> <li>Normalization calculations</li> <li>Example transformation</li> <li>Error handling</li> <li>Testing</li> <li>Related documentation</li> </ul>"},{"location":"transfer-currency-normalization/#overview","title":"Overview","text":"<p>The transfer currency normalization layer lets users specify currency for either the from_account or the to_account when creating transfers. It normalizes inputs to the backend standard format before validation and persistence.</p>"},{"location":"transfer-currency-normalization/#backend-storage-format","title":"Backend Storage Format","text":"<p>The Transfer table stores currency information in this format:</p> Field Description <code>currency</code> Always equals from_account currency <code>currency_amount</code> Amount in from_account currency <code>amount</code> Amount in to_account currency <p>The backend enforces <code>currency = from_account</code> to keep conversion semantics unambiguous.</p>"},{"location":"transfer-currency-normalization/#user-input-modes","title":"User Input Modes","text":"<p>Users can specify transfer amounts in three ways:</p>"},{"location":"transfer-currency-normalization/#1-amount-only-inference","title":"1. Amount Only, Inference","text":"<p>Specify only the <code>amount</code> field. The system infers currency based on account types:</p> <pre><code>{\n  \"from_account\": \"TWH - Personal\",  // SGD, base currency\n  \"to_account\": \"TWH IB USD\",  // USD\n  \"amount\": \"200.00\"  // Inferred as SGD, base currency present\n}\n</code></pre> <p>Inference rules:</p> <ul> <li>If base currency in either account -&gt; user amount is in base currency</li> <li>If base in neither account -&gt; user amount is in from_account currency</li> </ul>"},{"location":"transfer-currency-normalization/#2-from-currency-explicit-pass-through","title":"2. From-Currency Explicit, Pass Through","text":"<p>Specify <code>currency</code> + <code>currency_amount</code> matching the from_account:</p> <pre><code>{\n  \"from_account\": \"TWH IB USD\",  // USD\n  \"to_account\": \"TWH - Personal\",  // SGD\n  \"currency\": \"USD\",  // Matches from_account\n  \"currency_amount\": \"150.00\"  // from_amount\n}\n</code></pre> <p>Behavior: Already in backend format -&gt; passes through unchanged.</p>"},{"location":"transfer-currency-normalization/#3-to-currency-explicit-normalized","title":"3. To-Currency Explicit, Normalized","text":"<p>Specify <code>currency</code> + <code>currency_amount</code> matching the to_account:</p> <pre><code>{\n  \"from_account\": \"TWH - Personal\",  // SGD, base currency\n  \"to_account\": \"TWH IB USD\",  // USD\n  \"currency\": \"USD\",  // Matches to_account\n  \"currency_amount\": \"100.00\"  // to_amount\n}\n</code></pre> <p>Behavior: Normalized to backend format:</p> <ol> <li>Interpret <code>currency_amount</code> as <code>to_amount</code>, 100.00 USD</li> <li>Calculate <code>from_amount</code> using the inverse rate, <code>from_amount = to_amount / forex_rate</code></li> <li>Convert to standard form:<ul> <li><code>currency</code> = \"SGD\", from_account</li> <li><code>currency_amount</code> = calculated from_amount</li> <li><code>amount</code> = 100.00, to_amount</li> </ul> </li> </ol>"},{"location":"transfer-currency-normalization/#design-rationale","title":"Design Rationale","text":""},{"location":"transfer-currency-normalization/#why-normalize-to-from_account","title":"Why Normalize to from_account?","text":"<p>The backend constraint <code>currency = from_account</code> provides:</p> <ol> <li>Unambiguous semantics: Always clear which account's currency is the reference</li> <li>Consistent querying: Filtering by currency always uses from_account perspective</li> <li>Simplified validation: Single constraint rule instead of multiple cases</li> </ol>"},{"location":"transfer-currency-normalization/#why-accept-both-specifications","title":"Why Accept Both Specifications?","text":"<p>User convenience:</p> <ul> <li>From-account specification: Natural when user thinks \"I'm sending X USD\"</li> <li>To-account specification: Natural when user thinks \"Recipient gets Y EUR\"</li> <li>Either works: System handles both transparently</li> </ul> <p>The normalization layer provides user flexibility while maintaining backend consistency.</p>"},{"location":"transfer-currency-normalization/#implementation-architecture","title":"Implementation Architecture","text":""},{"location":"transfer-currency-normalization/#layer-1-user-input-flexible","title":"Layer 1: User Input, Flexible","text":"<p>Location: JSON parsing in CLI, <code>cli/transfer.py</code></p> <p>Accepts:</p> <ul> <li><code>amount</code> only, optional</li> <li><code>currency</code> + <code>currency_amount</code>, optional and can match either account</li> </ul>"},{"location":"transfer-currency-normalization/#layer-2-normalization-conversion","title":"Layer 2: Normalization, Conversion","text":"<p>Location: <code>client.py</code>, <code>_infer_currency_for_transfer()</code></p> <p>Logic:</p> <ol> <li> <p>If <code>currency</code> + <code>currency_amount</code> specified:</p> <ul> <li>Validate: <code>currency</code> must match either from_account or to_account</li> <li>If matches from_account, pass through</li> <li>If matches to_account, calculate inverse and swap to backend format</li> </ul> </li> <li> <p>If only <code>amount</code> specified:</p> <ul> <li>Apply inference rules, base currency priority</li> </ul> </li> <li> <p>Return normalized TransferDTO</p> </li> </ol>"},{"location":"transfer-currency-normalization/#layer-3-validation-constraint-enforcement","title":"Layer 3: Validation, Constraint Enforcement","text":"<p>Location: <code>client.py</code>, <code>_validate_transfer_currency_constraint()</code></p> <p>Enforces: <code>currency</code> must equal from_account currency, backend constraint</p> <p>This validation runs after normalization, so it always sees backend-formatted data.</p> <p>Persistence stores backend-formatted data via repository <code>insert_transfer</code>.</p>"},{"location":"transfer-currency-normalization/#normalization-calculations","title":"Normalization Calculations","text":""},{"location":"transfer-currency-normalization/#same-currency-accounts","title":"Same Currency Accounts","text":"<pre><code>from_amount = to_amount\n</code></pre>"},{"location":"transfer-currency-normalization/#foreign-to-base-currency","title":"Foreign to Base Currency","text":"<pre><code>to_amount_base = from_amount_foreign * forex_rate\n</code></pre> <p>Inverse, when normalizing to_amount to from_amount: <pre><code>from_amount_foreign = to_amount_base / forex_rate\n</code></pre></p>"},{"location":"transfer-currency-normalization/#base-to-foreign-currency","title":"Base to Foreign Currency","text":"<pre><code>to_amount_foreign = from_amount_base / forex_rate\n</code></pre> <p>Inverse, when normalizing to_amount to from_amount: <pre><code>from_amount_base = to_amount_foreign * forex_rate\n</code></pre></p>"},{"location":"transfer-currency-normalization/#foreign-to-foreign-currency","title":"Foreign to Foreign Currency","text":"<pre><code>to_amount = from_amount * from_rate / to_rate\n</code></pre> <p>Inverse, when normalizing to_amount to from_amount: <pre><code>from_amount = to_amount * to_rate / from_rate\n</code></pre></p>"},{"location":"transfer-currency-normalization/#example-transformation","title":"Example Transformation","text":"<p>User Input, to_account currency: <pre><code>{\n  \"date\": \"2026-02-22\",\n  \"from_account\": \"TWH - Personal\",  // SGD, base currency, rate = 1.0\n  \"to_account\": \"TWH IB USD\",  // USD, rate = 0.74\n  \"currency\": \"USD\",\n  \"currency_amount\": \"100.00\",\n  \"notes\": \"Normalized transfer\"\n}\n</code></pre></p> <p>Normalization Steps:</p> <ol> <li>Identify: <code>currency</code> = USD matches <code>to_account</code>, not from_account</li> <li>Interpret: <code>currency_amount</code> 100.00 is the to_amount in USD</li> <li>Calculate from_amount:</li> <li>Conversion: foreign USD to base SGD</li> <li>Formula: <code>from_amount = to_amount / forex_rate</code></li> <li> <p>Calculation: <code>100.00 / 0.74 = 135.14</code> SGD</p> </li> <li> <p>Normalize to backend format: <pre><code>{\n  \"currency\": \"SGD\",          // from_account, backend constraint\n  \"currency_amount\": \"135.14\", // from_amount, calculated\n  \"amount\": \"100.00\"           // to_amount, preserved\n}\n</code></pre></p> </li> </ol>"},{"location":"transfer-currency-normalization/#error-handling","title":"Error Handling","text":""},{"location":"transfer-currency-normalization/#over-specification-error","title":"Over-Specification Error","text":"<p>Cannot specify both <code>amount</code> and <code>currency_amount</code>:</p> <pre><code>{\n  \"amount\": \"100.00\",\n  \"currency\": \"USD\",\n  \"currency_amount\": \"74.00\"  // ERROR: over-specified\n}\n</code></pre> <p>Error message: <pre><code>Cannot specify both 'amount' and 'currency_amount'. \nProvide either 'amount' alone for inference or 'currency' with 'currency_amount'.\n</code></pre></p>"},{"location":"transfer-currency-normalization/#invalid-currency-error","title":"Invalid Currency Error","text":"<p>Currency must match one of the transfer accounts:</p> <pre><code>{\n  \"from_account\": \"TWH - Personal\",  // SGD\n  \"to_account\": \"TWH IB USD\",  // USD\n  \"currency\": \"EUR\",  // ERROR: matches neither\n  \"currency_amount\": \"50.00\"\n}\n</code></pre> <p>Error message: <pre><code>Transfer currency must match either from_account or to_account currency. \nfrom_account uses SGD, to_account uses USD, but transfer specifies EUR.\n</code></pre></p>"},{"location":"transfer-currency-normalization/#testing","title":"Testing","text":""},{"location":"transfer-currency-normalization/#integration-test-coverage","title":"Integration Test Coverage","text":"<p>The normalization layer is tested in:</p> <ul> <li><code>tests/integration/test_currency_constraints.py::test_transfer_currency_must_match_from_account</code></li> </ul> <p>This test verifies:</p> <ol> <li>\u2705 To-currency specification is normalized correctly</li> <li>\u2705 From-currency specification passes through unchanged</li> <li>\u2705 Invalid currencies, matching neither account, are rejected</li> </ol>"},{"location":"transfer-currency-normalization/#uat-test-cases","title":"UAT Test Cases","text":"<p>Comprehensive batch transfer tests in:</p> <ul> <li>transfers_valid_batch.json</li> </ul> <p>Test coverage:</p> <ul> <li>Items 1-4: Amount-only inference, 4 cases</li> <li>Items 5-7: Explicit from-currency, 3 cases</li> <li>Items 8-10: Explicit to-currency with normalization, 3 cases</li> <li>Item 11: Invalid date format, parsing error test</li> </ul> <p>See Test cases for detailed test case documentation.</p>"},{"location":"transfer-currency-normalization/#related-documentation","title":"Related Documentation","text":"<ul> <li>Design, transfer currency semantics</li> <li>Schema, transfer table structure</li> <li>Test Strategy, inference testing approach</li> <li>Test Cases, UAT coverage</li> </ul>"},{"location":"user-guide/","title":"HomeBudget comprehensive guide","text":""},{"location":"user-guide/#table-of-contents","title":"Table of contents","text":"<ul> <li>Getting started</li> <li>Installation</li> <li>Configuration</li> <li>Basic usage</li> <li>Entry points</li> <li>Forex input rules</li> <li> <p>Currency matching constraints</p> </li> <li> <p>Feature mapping</p> </li> <li>Working with expenses</li> <li>Working with income</li> <li>Working with transfers</li> <li>Batch operations</li> <li>Troubleshooting</li> </ul>"},{"location":"user-guide/#getting-started","title":"Getting started","text":"<p>The HomeBudget wrapper is a Python library and CLI that lets you manage HomeBudget data through a SQLite database. The wrapper supports expense, income, and transfer operations with full CRUD (create, read, update, delete) functionality. It also supports sync updates so changes appear in the HomeBudget apps across all devices.</p> <p>What you need</p> <ul> <li>Python 3.10 or later</li> <li>SQLite 3.35 or later</li> <li>A HomeBudget database file</li> </ul>"},{"location":"user-guide/#installation","title":"Installation","text":"<p>Using Git Bash on Windows for all examples. Clone the repository to access the project files.</p> <pre><code>git clone https://github.com/yayfalafels/homebudget.git\ncd homebudget\n</code></pre> <p>Activate the main environment at <code>env/</code> (do not use <code>.dev/env</code> for normal workflows).</p> <pre><code>source env/Scripts/activate\n</code></pre> <p>Download the latest wheel distribution from the releases page and install it.</p> <pre><code>RELEASE_VERSION=2.0.0\nWHEEL_FILE=homebudget-$RELEASE_VERSION-py3-none-any.whl\nDOWNLOAD_URL=https://github.com/yayfalafels/homebudget/releases/download/v$RELEASE_VERSION/$WHEEL_FILE\ncurl -L -o $WHEEL_FILE $DOWNLOAD_URL\n</code></pre> <p>Install the package from the wheel distribution.</p> <pre><code>pip install homebudget-*.whl\n</code></pre>"},{"location":"user-guide/#configuration","title":"Configuration","text":"<p>The wrapper requires a configuration file for database path and settings. See the Configuration Guide for complete setup instructions.</p> <p>Quick setup:</p> <pre><code># Create config directory and copy sample\nconfig_dir=\"$USERPROFILE/OneDrive/Documents/HomeBudgetData\"\nmkdir -p \"$config_dir\"\ncp config/hb-config.json.sample \"$config_dir/hb-config.json\"\n# Edit the config file to set db_path\n</code></pre> <p>Configuration file location: <pre><code>%USERPROFILE%\\OneDrive\\Documents\\HomeBudgetData\\hb-config.json\n</code></pre></p> <p>For full configuration options and troubleshooting, see Configuration Guide.</p>"},{"location":"user-guide/#basic-usage","title":"Basic usage","text":"<p>For a complete set of examples, see the methods and CLI guides.</p> <ul> <li>Methods</li> <li>CLI guide</li> </ul>"},{"location":"user-guide/#entry-points","title":"Entry points","text":"<p>Library entry point</p> <ul> <li>Use the <code>HomeBudgetClient</code> class to perform CRUD operations</li> <li>Use DTO classes to validate data before writing to the database</li> </ul> <p>CLI entry point</p> <ul> <li>Use <code>homebudget</code> or <code>hb</code> for the command line interface</li> <li>Provide <code>--db</code> for the database path when <code>hb-config.json</code> is not configured</li> </ul>"},{"location":"user-guide/#sync-behavior","title":"Sync behavior","text":"<p>Sync updates are enabled by default and mandatory for all write commands. This ensures consistency between local and remote devices:</p> <ul> <li>Creates SyncUpdate records in the database</li> <li>Enables mobile and other HomeBudget clients to synchronize changes</li> <li>Automatically manages the HomeBudget UI to maintain data consistency (Feature 001)</li> </ul> <p>Sync cannot be disabled via the CLI to prevent irreparable breaks between local and remote data.</p>"},{"location":"user-guide/#forex-input-rules","title":"Forex input rules","text":"<p>Forex inputs use one of two paths for expenses and income.</p> <p>Base currency path</p> <ul> <li>Provide amount only</li> <li>Currency defaults to the account currency</li> <li>Currency amount is set to amount for base currency updates</li> <li>Exchange rate is treated as 1.0</li> </ul> <p>Foreign currency path</p> <ul> <li>Provide currency and currency amount</li> <li>Exchange rate is optional (if omitted, the wrapper infers a rate from the forex cache)</li> <li>Amount is calculated as currency amount times exchange rate</li> </ul> <p>You can pass an explicit rate with <code>--exchange-rate</code> (CLI) or <code>exchange_rate</code> (client updates).</p> <p>Do not provide amount and currency amount together.</p>"},{"location":"user-guide/#currency-matching-constraints","title":"Currency matching constraints","text":"<p>When adding or updating transactions (expense, income, transfer), the currency you specify must match the account's base currency rules:</p> <p>For expenses and income:</p> <ul> <li>Cannot add base currency transactions to non-base currency accounts: If an account's currency is non-base (e.g., USD account \"TWH IB USD\"), you cannot add a transaction in the system's base currency (SGD). The account will reject base currency inputs.</li> <li>Can add foreign currency transactions to base currency accounts: If an account's currency is the system base (SGD), you can add transactions in foreign currencies (USD, EUR, GEL, etc.) by specifying <code>--currency</code>, <code>--currency-amount</code>, and optionally <code>--exchange-rate</code>.</li> </ul> <p>Examples:</p> <ul> <li>\u2713 VALID: Add USD expense to \"TWH - Personal\" (SGD base) with <code>--currency USD --currency-amount 27.50 --exchange-rate 0.9273</code></li> <li>\u2717 INVALID: Add SGD income to \"TWH IB USD\" (USD base) - account does not accept base currency</li> <li>\u2713 VALID: Add USD income to \"DBS Multi\" (SGD base) with <code>--currency USD --currency-amount 2700 --exchange-rate 0.7407</code></li> </ul> <p>For transfers between mixed-currency accounts:</p> <ul> <li>You can specify the currency amount and exchange rate for either the source or destination account's currency, but not both</li> <li>Examples:</li> <li>\u2713 VALID: Transfer from \"TWH - Personal\" (SGD) to \"TWH IB USD\" (USD) specifying USD: <code>--currency USD --currency-amount 110 --exchange-rate 0.9091</code></li> <li>\u2713 VALID: Same transfer specifying SGD: <code>--currency SGD --currency-amount 121 --exchange-rate 0.826</code></li> <li>\u2717 INVALID: Mix both currencies in a single transfer - choose one accounts currency</li> <li>\u2717 INVALID: Specify a third currency (e.g., EUR) that does not match either account's currency</li> </ul>"},{"location":"user-guide/#ui-control-automatic","title":"UI Control (Automatic)","text":"<p>When you run a write command with sync enabled (the default), the HomeBudget UI is automatically closed during the database operation and automatically reopened when complete.</p> <p>Why this happens:</p> <ul> <li>Ensures the UI doesn't read incomplete data during database changes</li> <li>Prevents database locks that occur while the UI reads during sync operations</li> <li>Atomic database transactions are guaranteed without UI interference</li> </ul> <p>What you'll observe:</p> <ul> <li>The HomeBudget application window will briefly close and reopen</li> <li>The entire operation (close \u2192 change \u2192 reopen) typically takes 6-11 seconds</li> <li>No manual intervention is needed; it's completely automated</li> </ul>"},{"location":"user-guide/#feature-mapping","title":"Feature mapping","text":"HomeBudget UI operation Wrapper method CLI command Add expense HomeBudgetClient.add_expense homebudget expense add List expenses HomeBudgetClient.list_expenses homebudget expense list Get expense HomeBudgetClient.get_expense homebudget expense get Update expense HomeBudgetClient.update_expense homebudget expense update Delete expense HomeBudgetClient.delete_expense homebudget expense delete Add income HomeBudgetClient.add_income homebudget income add List income HomeBudgetClient.list_incomes homebudget income list Get income HomeBudgetClient.get_income homebudget income get Update income HomeBudgetClient.update_income homebudget income update Delete income HomeBudgetClient.delete_income homebudget income delete Add transfer HomeBudgetClient.add_transfer homebudget transfer add List transfers HomeBudgetClient.list_transfers homebudget transfer list Get transfer HomeBudgetClient.get_transfer homebudget transfer get Update transfer HomeBudgetClient.update_transfer homebudget transfer update Delete transfer HomeBudgetClient.delete_transfer homebudget transfer delete Batch add expenses HomeBudgetClient.add_expenses_batch homebudget expense batch-import Batch add income HomeBudgetClient.add_incomes_batch homebudget income batch-import Batch add transfers HomeBudgetClient.add_transfers_batch homebudget transfer batch-import Start UI N/A homebudget ui start Close UI N/A homebudget ui close Refresh UI N/A homebudget ui refresh Check UI status N/A homebudget ui status"},{"location":"user-guide/#working-with-expenses","title":"Working with expenses","text":"<p>Use the expense methods to add, list, update, and delete transactions. Sync updates are created for write operations when sync is enabled.</p> <p>Add an expense.</p> <pre><code>from decimal import Decimal\nimport datetime\n\nfrom homebudget import HomeBudgetClient, ExpenseDTO\n\nwith HomeBudgetClient() as client:\n  expense = ExpenseDTO(\n    date=datetime.date(2026, 2, 16),\n    category=\"Dining\",\n    subcategory=\"Restaurant\",\n    amount=Decimal(\"25.50\"),\n    account=\"Wallet\",\n    notes=\"Lunch\"\n  )\n  saved = client.add_expense(expense)\n  print(saved.key)\n</code></pre> <p>List expenses for a date range.</p> <pre><code>import datetime\nfrom homebudget import HomeBudgetClient\n\nwith HomeBudgetClient() as client:\n  results = client.list_expenses(\n    start_date=datetime.date(2026, 2, 1),\n    end_date=datetime.date(2026, 2, 28)\n  )\n  for expense in results:\n    print(expense.key, expense.amount)\n</code></pre> <p>Add an expense with the CLI.</p> <pre><code>homebudget expense add \\\n  --date 2026-02-16 \\\n  --category Dining \\\n  --subcategory Restaurant \\\n  --amount 25.50 \\\n  --account Wallet \\\n  --notes \"Lunch\"\n</code></pre> <p>Add an expense with a foreign currency and exchange rate.</p> <pre><code>homebudget expense add \\\n  --date 2026-02-16 \\\n  --category Dining \\\n  --subcategory Restaurant \\\n  --currency EUR \\\n  --currency-amount 12.00 \\\n  --exchange-rate 1.10 \\\n  --account Wallet \\\n  --notes \"Lunch\"\n</code></pre>"},{"location":"user-guide/#working-with-income","title":"Working with income","text":"<p>Use the income methods to add, list, update, and delete income transactions. Sync updates are created for write operations when sync is enabled.</p> <p>Add income.</p> <pre><code>from decimal import Decimal\nimport datetime\n\nfrom homebudget import HomeBudgetClient, IncomeDTO\n\nwith HomeBudgetClient() as client:\n  income = IncomeDTO(\n    date=datetime.date(2026, 2, 28),\n    name=\"Salary\",\n    amount=Decimal(\"5000.00\"),\n    account=\"Bank\",\n    notes=\"February salary\"\n  )\n  saved = client.add_income(income)\n  print(saved.key)\n</code></pre> <p>List income for a date range.</p> <pre><code>import datetime\nfrom homebudget import HomeBudgetClient\n\nwith HomeBudgetClient() as client:\n  results = client.list_incomes(\n    start_date=datetime.date(2026, 2, 1),\n    end_date=datetime.date(2026, 2, 28)\n  )\n  for income in results:\n    print(income.key, income.amount)\n</code></pre> <p>Add income with the CLI.</p> <pre><code>homebudget income add \\\n  --date 2026-02-28 \\\n  --name \"Salary\" \\\n  --amount 5000.00 \\\n  --account Bank \\\n  --notes \"February salary\"\n</code></pre>"},{"location":"user-guide/#working-with-transfers","title":"Working with transfers","text":"<p>Use the transfer methods to add, list, update, and delete transfers between accounts. Transfers support a currency normalization layer that allows flexible input for mixed-currency transfers.</p>"},{"location":"user-guide/#currency-normalization-layer","title":"Currency Normalization Layer","text":"<p>When transferring between accounts with different currencies, you can specify the amount in three ways:</p> <ul> <li>Amount Only (Inference): Provide only <code>--amount</code>. The system infers the currency:</li> </ul> <p>If base currency in either account \u2192 amount is in base currency</p> <p>If base in neither account \u2192 amount is in from_account currency</p> <ul> <li>From-Currency Explicit: Provide <code>--currency</code> + <code>--currency-amount</code> matching the from_account</li> </ul> <p>Already in backend format \u2192 passes through unchanged</p> <ul> <li>To-Currency Explicit: Provide <code>--currency</code> + <code>--currency-amount</code> matching the to_account</li> </ul> <p>System normalizes to backend format using inverse forex calculation</p> <p>For detailed normalization rules, see docs/transfer-currency-normalization.md.</p>"},{"location":"user-guide/#basic-transfer-examples","title":"Basic Transfer Examples","text":"<p>Add a same-currency transfer.</p> <pre><code>from decimal import Decimal\nimport datetime\n\nfrom homebudget import HomeBudgetClient, TransferDTO\n\nwith HomeBudgetClient() as client:\n  transfer = TransferDTO(\n    date=datetime.date(2026, 2, 20),\n    from_account=\"Bank\",\n    to_account=\"Wallet\",\n    amount=Decimal(\"200.00\"),\n    notes=\"Cash withdrawal\"\n  )\n  saved = client.add_transfer(transfer)\n  print(saved.key)\n</code></pre> <p>Add a mixed-currency transfer (amount only).</p> <pre><code># Transfer from SGD account to USD account\n# System infers: amount is in base currency (SGD)\nwith HomeBudgetClient() as client:\n  transfer = TransferDTO(\n    date=datetime.date(2026, 2, 20),\n    from_account=\"TWH - Personal\",  # SGD base\n    to_account=\"TWH IB USD\",  # USD\n    amount=Decimal(\"200.00\"),  # Interpreted as SGD\n    notes=\"Transfer to USD account\"\n  )\n  saved = client.add_transfer(transfer)\n  print(saved.key)\n</code></pre> <p>Add a mixed-currency transfer (explicit from-currency).</p> <pre><code># Specify amount in from_account currency (USD)\nwith HomeBudgetClient() as client:\n  transfer = TransferDTO(\n    date=datetime.date(2026, 2, 20),\n    from_account=\"TWH IB USD\",  # USD\n    to_account=\"TWH - Personal\",  # SGD base\n    amount=None,  # Will be calculated\n    currency=\"USD\",  # Matches from_account\n    currency_amount=Decimal(\"150.00\"),  # Amount in USD\n    notes=\"Transfer to SGD account\"\n  )\n  saved = client.add_transfer(transfer)\n  print(saved.key)\n</code></pre> <p>Add a mixed-currency transfer (explicit to-currency, normalized).</p> <pre><code># Specify amount in to_account currency (EUR)\n# System normalizes to backend format (from_account currency)\nwith HomeBudgetClient() as client:\n  transfer = TransferDTO(\n    date=datetime.date(2026, 2, 20),\n    from_account=\"TWH IB USD\",  # USD\n    to_account=\"Cash TWH EUR\",  # EUR\n    amount=None,  # Will be calculated\n    currency=\"EUR\",  # Matches to_account (will be normalized)\n    currency_amount=Decimal(\"90.00\"),  # Amount in EUR\n    notes=\"Transfer to EUR account\"\n  )\n  saved = client.add_transfer(transfer)\n  print(saved.key)\n</code></pre> <p>List transfers for a date range.</p> <pre><code>import datetime\nfrom homebudget import HomeBudgetClient\n\nwith HomeBudgetClient() as client:\n  results = client.list_transfers(\n    start_date=datetime.date(2026, 2, 1),\n    end_date=datetime.date(2026, 2, 28)\n  )\n  for transfer in results:\n    print(transfer.key, transfer.amount)\n</code></pre>"},{"location":"user-guide/#cli-transfer-examples","title":"CLI Transfer Examples","text":"<p>Add a same-currency transfer.</p> <pre><code>homebudget transfer add \\\n  --date 2026-02-20 \\\n  --from-account \"Bank\" \\\n  --to-account \"Wallet\" \\\n  --amount 200.00 \\\n  --notes \"Cash withdrawal\"\n</code></pre> <p>Add a mixed-currency transfer (amount only).</p> <pre><code># Transfer from SGD to USD - amount inferred as base currency (SGD)\nhomebudget transfer add \\\n  --date 2026-02-20 \\\n  --from-account \"TWH - Personal\" \\\n  --to-account \"TWH IB USD\" \\\n  --amount 200.00 \\\n  --notes \"Transfer to USD account\"\n</code></pre> <p>Add a mixed-currency transfer (explicit from-currency).</p> <pre><code># Specify amount in from_account currency (USD)\nhomebudget transfer add \\\n  --date 2026-02-20 \\\n  --from-account \"TWH IB USD\" \\\n  --to-account \"TWH - Personal\" \\\n  --currency USD \\\n  --currency-amount 150.00 \\\n  --exchange-rate 1.35 \\\n  --notes \"Transfer to SGD account\"\n</code></pre> <p>Add a mixed-currency transfer (explicit to-currency, normalized).</p> <pre><code># Specify amount in to_account currency (EUR) - system normalizes\nhomebudget transfer add \\\n  --date 2026-02-20 \\\n  --from-account \"TWH IB USD\" \\\n  --to-account \"Cash TWH EUR\" \\\n  --currency EUR \\\n  --currency-amount 90.00 \\\n  --exchange-rate 0.92 \\\n  --notes \"Transfer to EUR account\"\n</code></pre>"},{"location":"user-guide/#batch-operations","title":"Batch operations","text":"<p>Batch operations support two paths. Use batch import for single resource files, or use the mixed operation JSON format to combine resources and operations in one run.</p>"},{"location":"user-guide/#batch-behavior","title":"Batch behavior","text":"<ul> <li>Sync optimization: Individual transactions are added without sync, then a single sync operation occurs after the batch completes</li> <li>Error handling: By default, batch continues on error and reports failures at the end. Use <code>--stop-on-error</code> to halt on first failure</li> <li>Transaction atomicity: Each individual transaction insert is atomic, but the batch as a whole may partially succeed</li> <li>Validation: Each record is validated before insertion same as single-record operations</li> </ul>"},{"location":"user-guide/#csv-format","title":"CSV format","text":"<p>CSV files must include a header row with these columns:</p> <p>Expense CSV columns:</p> <ul> <li><code>date</code> required: YYYY-MM-DD format</li> <li><code>category</code> required: Category name</li> <li><code>subcategory</code> optional: Subcategory name</li> <li><code>amount</code> required: Decimal amount</li> <li><code>account</code> required: Account name</li> <li><code>notes</code> optional: Transaction notes</li> <li><code>currency</code> optional: Currency code</li> <li><code>currency_amount</code> optional: Foreign currency amount</li> <li><code>exchange_rate</code> optional: Exchange rate to base currency</li> </ul> <p>Income CSV columns:</p> <ul> <li><code>date</code> required: YYYY-MM-DD format</li> <li><code>name</code> required: Income name</li> <li><code>amount</code> required: Decimal amount</li> <li><code>account</code> required: Account name</li> <li><code>notes</code> optional: Transaction notes</li> <li><code>currency</code> optional: Currency code</li> <li><code>currency_amount</code> optional: Foreign currency amount</li> <li><code>exchange_rate</code> optional: Exchange rate to base currency</li> </ul> <p>Transfer CSV columns:</p> <ul> <li><code>date</code> required: YYYY-MM-DD format</li> <li><code>from_account</code> required: Source account name</li> <li><code>to_account</code> required: Destination account name</li> <li><code>amount</code> optional: Destination amount Decimal</li> <li><code>notes</code> optional: Transaction notes</li> <li><code>currency</code> optional: Source Currency code</li> <li><code>currency_amount</code> optional: Source currency amount</li> <li><code>exchange_rate</code> optional: Exchange rate from currency -&gt; to currency</li> </ul> <p>CSV example for expenses.csv: <pre><code>date,category,subcategory,amount,account,notes\n2026-02-01,Food (Basic),Groceries,45.50,Wallet,Weekly groceries\n2026-02-03,Transport,Fuel,60.00,Credit Card,Gas station\n2026-02-05,Food (Basic),Cheap restaurant,15.75,Wallet,Lunch\n</code></pre></p>"},{"location":"user-guide/#json-format","title":"JSON format","text":"<p>JSON files must contain an array of transaction objects with the same fields as CSV columns.</p> <p>JSON example for income.json: <pre><code>[\n  {\n    \"date\": \"2026-02-01\",\n    \"name\": \"Salary\",\n    \"amount\": \"5000.00\",\n    \"account\": \"Checking\",\n    \"notes\": \"Monthly salary\"\n  },\n  {\n    \"date\": \"2026-02-15\",\n    \"name\": \"Freelance\",\n    \"amount\": \"1200.00\",\n    \"account\": \"Checking\",\n    \"notes\": \"Project payment\"\n  }\n]\n</code></pre></p> <p>Transfer batch with currency normalization - transfers_batch.json: <pre><code>[\n  {\n    \"date\": \"2026-02-22\",\n    \"from_account\": \"TWH - Personal\",\n    \"to_account\": \"TWH IB USD\",\n    \"amount\": \"200.00\",\n    \"notes\": \"SGD-&gt;USD Amount Only (inferred)\"\n  },\n  {\n    \"date\": \"2026-02-22\",\n    \"from_account\": \"TWH - Personal\",\n    \"to_account\": \"TWH IB USD\",\n    \"currency\": \"SGD\",\n    \"currency_amount\": \"250.00\",\n    \"notes\": \"Explicit From Currency (SGD)\"\n  },\n  {\n    \"date\": \"2026-02-22\",\n    \"from_account\": \"TWH - Personal\",\n    \"to_account\": \"TWH IB USD\",\n    \"currency\": \"USD\",\n    \"currency_amount\": \"100.00\",\n    \"notes\": \"Explicit To Currency (USD) - normalized to backend format\"\n  }\n]\n</code></pre></p> <p>Note: Transfer batch imports support the currency normalization layer. You can specify <code>currency</code> + <code>currency_amount</code> for either the from_account or to_account. The system automatically normalizes to backend format (currency = from_account) during import.</p>"},{"location":"user-guide/#mixed-operation-json-format","title":"Mixed operation JSON format","text":"<p>Use this format to batch a mix of resources and CRUD operations in one file.</p> <p>Each entry is a JSON object with these keys.</p> <ul> <li><code>resource</code> with values expense, income, or transfer</li> <li><code>operation</code> with values add, update, or delete</li> <li><code>parameters</code> with the same fields used by the single record CLI commands</li> </ul> <p>Example JSON for operations.json:</p> <pre><code>[\n  {\n    \"resource\": \"expense\",\n    \"operation\": \"add\",\n    \"parameters\": {\n      \"date\": \"2026-02-16\",\n      \"category\": \"Dining\",\n      \"subcategory\": \"Restaurant\",\n      \"amount\": \"25.50\",\n      \"account\": \"Wallet\",\n      \"notes\": \"Lunch\"\n    }\n  },\n  {\n    \"resource\": \"income\",\n    \"operation\": \"update\",\n    \"parameters\": {\n      \"key\": 14021,\n      \"notes\": \"Updated notes\"\n    }\n  },\n  {\n    \"resource\": \"transfer\",\n    \"operation\": \"delete\",\n    \"parameters\": {\n      \"key\": 21007\n    }\n  }\n]\n</code></pre>"},{"location":"user-guide/#methods-usage","title":"Methods usage","text":"<pre><code>from homebudget import HomeBudgetClient\nfrom homebudget.models import ExpenseDTO\nfrom decimal import Decimal\nimport datetime as dt\n\nwith HomeBudgetClient() as client:\n    expenses = [\n        ExpenseDTO(\n            date=dt.date(2026, 2, 1),\n            category=\"Food (Basic)\",\n            subcategory=\"Groceries\",\n            amount=Decimal(\"45.50\"),\n            account=\"Wallet\",\n            notes=\"Weekly groceries\"\n        ),\n        ExpenseDTO(\n            date=dt.date(2026, 2, 3),\n            category=\"Transport\",\n            subcategory=\"Fuel\",\n            amount=Decimal(\"60.00\"),\n            account=\"Credit Card\",\n            notes=\"Gas station\"\n        )\n    ]\n\n    result = client.add_expenses_batch(expenses)\n    print(f\"Successful: {len(result.successful)}\")\n    print(f\"Failed: {len(result.failed)}\")\n    for dto, error in result.failed:\n        print(f\"  Failed: {dto.date} {dto.amount} - {error}\")\n</code></pre>"},{"location":"user-guide/#cli-usage","title":"CLI usage","text":"<p>Import expenses from CSV: <pre><code>homebudget expense batch-import --file expenses.csv --format csv\n</code></pre></p> <p>Import income from JSON: <pre><code>homebudget income batch-import --file income.json --format json\n</code></pre></p> <p>Import with error report: <pre><code>homebudget expense batch-import --file expenses.csv --format csv --error-report errors.txt\n</code></pre></p> <p>Stop on first error: <pre><code>homebudget transfer batch-import --file transfers.csv --format csv --stop-on-error\n</code></pre></p> <p>Run mixed batch operations: <pre><code>homebudget batch run --file operations.json\n</code></pre></p> <p>Run mixed batch with stop-on-error: <pre><code>homebudget batch run --file operations.json --stop-on-error\n</code></pre></p> <p>Run mixed batch with error report: <pre><code>homebudget batch run --file operations.json --error-report batch_errors.json\n</code></pre></p>"},{"location":"user-guide/#batch-result-output","title":"Batch result output","text":"<p>The CLI displays a summary of batch results:</p> <pre><code>Batch import completed\n=====================\nTotal records: 25\nSuccessful: 23\nFailed: 2\n\nFailed records:\n  Row 15: 2026-02-10 45.50 - DuplicateError: Matching expense already exists\n  Row 22: 2026-02-18 invalid - ValueError: Invalid amount format\n\nSync completed for 23 transactions\n</code></pre> <p>If <code>--error-report</code> is specified, failed records are written to the file with details.</p>"},{"location":"user-guide/#troubleshooting","title":"Troubleshooting","text":"<ul> <li>The setup script fails to install a dependency. Check requirements.txt and confirm the package source.</li> <li>The CLI reports a database error. Confirm the database file path is correct and that the file is not locked.</li> <li>Sync does not update the mobile app. Confirm sync is enabled and that DeviceInfo is present in the database.</li> <li>A duplicate error appears. Review existing transactions for matching date, account, amount, category, and notes.</li> <li>A command fails with a foreign currency error. Confirm the transaction currency matches the account currency.</li> <li>The Python version is too old. Install Python 3.10 or later and recreate the env directory.</li> <li>The SQLite version is too old. Use a Python build that includes SQLite 3.35 or later.</li> </ul>"},{"location":"workflow/","title":"Implementation Example: Financial statements workflow","text":""},{"location":"workflow/#table-of-contents","title":"Table of contents","text":"<ul> <li>Overview</li> <li>Sequential steps and time estimates</li> <li>Workflows<ul> <li>Pre-flight checks</li> <li>Forex</li> <li>Account update</li> <li>Report update</li> </ul> </li> </ul>"},{"location":"workflow/#overview","title":"Overview","text":"<p>This document describes an implementation example for the HomeBudget wrapper with the Financial Statements update. It covers the financial statements workflow, beginning with the sequential steps with time estimates, then the account update flowchart, and finally the report generation flowchart.</p>"},{"location":"workflow/#sequential-steps-and-time-estimates","title":"Sequential steps and time estimates","text":"id workflow account duration min description 01 forex 3 min fetch USD.SGD forex rates 02 account update wallets 20 to 40 min direct read from HB app 03 account update IBKR 50 to 110 min brokerage with helper workbook 04 account update CPF 20 to 80 min Singapore retirement CPF 07 report update reconcile 30 to 140 min review and close reconcile gaps 08 report update statements 45 to 90 min review and update statements 09 report update print-out 20 min print-out statements to PDF report 10 refresh 5 min refresh the workspace logging sheet"},{"location":"workflow/#workflows","title":"Workflows","text":"<ul> <li>Pre-flight checks</li> <li>Forex</li> <li>Account update</li> <li>Report update</li> </ul>"},{"location":"workflow/#pre-flight-checks","title":"Pre-flight checks","text":""},{"location":"workflow/#forex","title":"Forex","text":"<p>download USD.SGD forex rates from yahoo finance load monthly month-end rates since last update into sheet <code>forex_rates</code></p> <p>USD.SGD forex rates url: USD.SGD</p>"},{"location":"workflow/#account-update","title":"Account update","text":"<p>The account update flow starts from statement download and moves through worksheets and balances, with reviews at several points.</p> <ul> <li>authenticate to website either password or MFA</li> <li>statement download from website</li> <li>statement backup to S3</li> <li>use worksheet as intermediate calculator to determine balances and transactions</li> <li>human review of balances and transactions for errors</li> <li>update HomeBudget with transactions - income, expenses, transfers</li> <li>update balances sheet in financial statements workbook</li> </ul>"},{"location":"workflow/#report-update","title":"Report update","text":"<p>The final report generation flow starts after reconcile and splits into income statement and balance sheet, then merges into the financial statements file and produces a PDF print-out stored in Drive.</p> <ul> <li>Reconcile review</li> <li>Update and review income statement and balance sheet</li> <li>safe reports as PDF</li> <li>upload to S3</li> </ul>"},{"location":"workflow/#workspace-close-out-and-refresh","title":"Workspace close-out and refresh","text":""},{"location":"tests/BATCH_TRANSFER_TEST_CASES/","title":"Batch Transfer UAT Test Cases","text":"<p>This document describes the batch transfer UAT test cases using the <code>hb transfer batch-import</code> command.</p>"},{"location":"tests/BATCH_TRANSFER_TEST_CASES/#overview","title":"Overview","text":"<p>Two comprehensive batch transfer test cases have been added to test the batch import functionality with JSON input:</p> <ol> <li><code>uat_batch_transfer_valid</code> - Batch import with 11 items: 10 valid transfers covering all scenarios (inferred, explicit from-currency, explicit to-currency) + 1 with parsing error to verify error reporting</li> <li><code>uat_batch_transfer_invalid</code> - Batch import with mixed valid/invalid transfers to test error handling (including over-specified case)</li> </ol>"},{"location":"tests/BATCH_TRANSFER_TEST_CASES/#currency-normalization-layer","title":"Currency Normalization Layer","text":"<p>The implementation includes a normalization layer that accepts user currency specifications for either the from_account OR to_account, and converts them to the backend standard format (currency = from_account, currency_amount = from_amount).</p> <p>User Input Modes:</p> <ol> <li>Amount only: System infers currency based on account types (base currency if present)</li> <li>From-currency explicit: <code>currency</code> + <code>currency_amount</code> matching from_account (pass through)</li> <li>To-currency explicit: <code>currency</code> + <code>currency_amount</code> matching to_account (normalized to from-currency format)</li> </ol> <p>Backend Storage Format:</p> <ul> <li><code>currency</code>: Always equals from_account currency</li> <li><code>currency_amount</code>: Amount in from_account currency</li> <li><code>amount</code>: Amount in to_account currency</li> </ul>"},{"location":"tests/BATCH_TRANSFER_TEST_CASES/#test-case-1-uat_batch_transfer_valid","title":"Test Case 1: uat_batch_transfer_valid","text":""},{"location":"tests/BATCH_TRANSFER_TEST_CASES/#purpose","title":"Purpose","text":"<p>Validate that batch import correctly creates multiple transfers with different currency scenarios and properly syncs to mobile app. Tests:</p> <ul> <li>Inferred currency (amount only)</li> <li>Explicit from-currency specification (currency matches from_account)</li> <li>Explicit to-currency specification (currency matches to_account) - tests normalization layer</li> <li>Parsing error reporting (not silently dropped)</li> </ul>"},{"location":"tests/BATCH_TRANSFER_TEST_CASES/#input-transfers_valid_batchjson","title":"Input: <code>transfers_valid_batch.json</code>","text":"<p>11 items in single batch (10 valid + 1 parsing error):</p> <p>Items 1-4: Amount Only (Currency Inferred) <pre><code>  {\n    \"date\": \"2026-02-22\",\n    \"from_account\": \"TWH - Personal\",\n    \"to_account\": \"TWH IB USD\",\n    \"amount\": \"200.00\",\n    \"notes\": \"UAT Batch: SGD-&gt;USD Amount Only\"\n  },\n  {\n    \"date\": \"2026-02-22\",\n    \"from_account\": \"TWH IB USD\",\n    \"to_account\": \"TWH - Personal\",\n    \"amount\": \"400.00\",\n    \"notes\": \"UAT Batch: USD-&gt;SGD Amount Only\"\n  },\n  {\n    \"date\": \"2026-02-22\",\n    \"from_account\": \"TWH IB USD\",\n    \"to_account\": \"Cash TWH EUR\",\n    \"amount\": \"180.00\",\n    \"notes\": \"UAT Batch: USD-&gt;EUR Amount Only\"\n  },\n  {\n    \"date\": \"2026-02-22\",\n    \"from_account\": \"TWH - Personal\",\n    \"to_account\": \"30 CC Hashemis\",\n    \"amount\": \"600.00\",\n    \"notes\": \"UAT Batch: SGD-&gt;SGD Same Currency\"\n  }\n</code></pre></p> <p>Items 5-7: Explicit From-Currency (Pass Through) <pre><code>  {\n    \"date\": \"2026-02-22\",\n    \"from_account\": \"TWH - Personal\",\n    \"to_account\": \"TWH IB USD\",\n    \"currency\": \"SGD\",\n    \"currency_amount\": \"250.00\",\n    \"notes\": \"UAT Batch: SGD-&gt;USD Explicit From Currency (Base)\"\n  },\n  {\n    \"date\": \"2026-02-22\",\n    \"from_account\": \"TWH IB USD\",\n    \"to_account\": \"TWH - Personal\",\n    \"currency\": \"USD\",\n    \"currency_amount\": \"150.00\",\n    \"notes\": \"UAT Batch: USD-&gt;SGD Explicit From Currency (Non-Base)\"\n  },\n  {\n    \"date\": \"2026-02-22\",\n    \"from_account\": \"TWH IB USD\",\n    \"to_account\": \"Cash TWH EUR\",\n    \"currency\": \"USD\",\n    \"currency_amount\": \"120.00\",\n    \"notes\": \"UAT Batch: USD-&gt;EUR Explicit From Currency (Non-Base)\"\n  }\n</code></pre></p> <p>Items 8-10: Explicit To-Currency (Normalized to From-Currency) <pre><code>  {\n    \"date\": \"2026-02-22\",\n    \"from_account\": \"TWH - Personal\",\n    \"to_account\": \"TWH IB USD\",\n    \"currency\": \"USD\",\n    \"currency_amount\": \"100.00\",\n    \"notes\": \"UAT Batch: SGD-&gt;USD Explicit To Currency (Non-Base) [NORMALIZED]\"\n  },\n  {\n    \"date\": \"2026-02-22\",\n    \"from_account\": \"TWH IB USD\",\n    \"to_account\": \"TWH - Personal\",\n    \"currency\": \"SGD\",\n    \"currency_amount\": \"300.00\",\n    \"notes\": \"UAT Batch: USD-&gt;SGD Explicit To Currency (Base) [NORMALIZED]\"\n  },\n  {\n    \"date\": \"2026-02-22\",\n    \"from_account\": \"Cash TWH EUR\",\n    \"to_account\": \"TWH IB USD\",\n    \"currency\": \"USD\",\n    \"currency_amount\": \"90.00\",\n    \"notes\": \"UAT Batch: EUR-&gt;USD Explicit To Currency (Non-Base) [NORMALIZED]\"\n  }\n</code></pre></p> <p>Item 11: Parsing Error (Invalid Date) <pre><code>  {\n    \"date\": \"2026-22-02\",\n    \"from_account\": \"TWH - Personal\",\n    \"to_account\": \"TWH IB USD\",\n    \"amount\": \"100.00\",\n    \"notes\": \"UAT Batch: INVALID DATE FORMAT (should cause parsing error)\"\n  }\n</code></pre></p>"},{"location":"tests/BATCH_TRANSFER_TEST_CASES/#expected-results","title":"Expected Results","text":"<p>Command Output: <pre><code>1 parsing error(s) occurred:\n  Item 11: time data '2026-22-02' does not match format '%Y-%m-%d'\n\nBatch import completed\n  Successful: 10\n  Failed: 0\n</code></pre></p> <p>Parsing Errors:</p> <ul> <li>\u274c Item 8: Invalid date format (2026-22-02) - demonstrates that parsing errors are now reported instead of being silently dropped</li> </ul> <p>Item 1: Base\u2192Foreign (SGD\u2192USD) - Amount Only</p> <ul> <li>\u2705 Created</li> <li><code>currency=SGD</code> (from_account)</li> <li><code>currency_amount=200</code> (in SGD)</li> <li><code>amount\u2248148</code> (in USD, 200/1.35)</li> </ul> <p>Item 2: Foreign\u2192Base (USD\u2192SGD) - Amount Only</p> <ul> <li>\u2705 Created</li> <li><code>currency=USD</code> (from_account)</li> <li><code>currency_amount\u2248296</code> (in USD, 400/1.35)</li> <li><code>amount=400</code> (in SGD)</li> </ul> <p>Item 3: Foreign\u2192Foreign (USD\u2192EUR) - Amount Only</p> <ul> <li>\u2705 Created</li> <li><code>currency=USD</code> (from_account)</li> <li><code>currency_amount=180</code> (in USD)</li> <li><code>amount</code> calculated using cross-rate</li> </ul> <p>Item 4: Same Currency (SGD\u2192SGD)</p> <ul> <li>\u2705 Created</li> <li><code>currency=SGD</code></li> <li><code>currency_amount=600</code> (1:1)</li> <li><code>amount=600</code> (1:1, no forex)</li> </ul> <p>Item 5: Base\u2192Foreign (SGD\u2192USD) - Explicit From Currency</p> <ul> <li>\u2705 Created</li> <li><code>currency=SGD</code> (explicitly specified, matches from_account)</li> <li><code>currency_amount=250</code> (in SGD, explicitly specified)</li> <li><code>amount\u2248185</code> (in USD, calculated: 250/1.35)</li> </ul> <p>Item 6: Foreign\u2192Base (USD\u2192SGD) - Explicit From Currency</p> <ul> <li>\u2705 Created</li> <li><code>currency=USD</code> (explicitly specified, matches from_account)</li> <li><code>currency_amount=150</code> (in USD, explicitly specified)</li> <li><code>amount\u2248202.50</code> (in SGD, calculated: 150*1.35)</li> </ul> <p>Item 7: Foreign\u2192Foreign (USD\u2192EUR) - Explicit From Currency</p> <ul> <li>\u2705 Created</li> <li><code>currency=USD</code> (explicitly specified, matches from_account)</li> <li><code>currency_amount=120</code> (in USD, explicitly specified)</li> <li><code>amount</code> calculated using cross-rate (USD\u2192SGD\u2192EUR)</li> </ul>"},{"location":"tests/BATCH_TRANSFER_TEST_CASES/#sync-validation","title":"Sync Validation","text":"<ul> <li>\u2705 10 SyncUpdate records created (1 item failed parsing, doesn't reach processing)</li> <li>\u2705 All 10 transfers visible in Windows app</li> <li>\u2705 All 10 transfers visible in mobile app (with correct currencies)</li> <li>\u2705 Amounts reflect correct currency conversions in UI</li> <li>\u2705 Inferred (Items 1-4), explicit from-currency (Items 5-7), and explicit to-currency (Items 8-10) specifications all work correctly</li> <li>\u2705 To-currency specifications (Items 8-10) are normalized to backend format (currency = from_account)</li> <li>\u2705 Parsing errors are displayed (Item 11 shows error, not silently dropped)</li> </ul>"},{"location":"tests/BATCH_TRANSFER_TEST_CASES/#test-workflow","title":"Test Workflow","text":"<p>The test follows a streamlined workflow that doesn't enumerate each transfer case individually:</p> <ol> <li>Import batch of 11 items (10 valid + 1 parsing error)</li> <li>Verify parsing error displayed for Item 11 (invalid date format)</li> <li>List all transfers (shows keys, amounts, accounts - should show 10 transfers)</li> <li>Record transfer keys from the list (comma-separated) - Important: Choose \"pass\" to trigger key recording prompt</li> <li>Verify all 10 transfers appear in apps with correct data</li> <li>Verify to-currency items (8-10) were normalized correctly - check database shows currency = from_account</li> <li>Verify SyncUpdates created for 10 transfers</li> <li>Automated rollback using recorded keys</li> </ol> <p>Note: The test is generic and adapts to whatever transfers are defined in <code>transfers_valid_batch.json</code>. Adding or removing test cases updates the batch automatically without changing the test workflow.</p>"},{"location":"tests/BATCH_TRANSFER_TEST_CASES/#rollback","title":"Rollback","text":"<ul> <li>Automated rollback using batch delete with recorded transfer keys</li> <li>The rollback step uses the <code>rollback_transfers.json</code> template which expands <code>{TRANSFER_KEYS}</code> to individual delete operations</li> </ul>"},{"location":"tests/BATCH_TRANSFER_TEST_CASES/#test-case-2-uat_batch_transfer_invalid","title":"Test Case 2: uat_batch_transfer_invalid","text":""},{"location":"tests/BATCH_TRANSFER_TEST_CASES/#purpose_1","title":"Purpose","text":"<p>Validate that batch import correctly handles mixed valid/invalid transfers with <code>continue_on_error</code> behavior, reporting specific errors for each invalid record while still processing valid ones.</p>"},{"location":"tests/BATCH_TRANSFER_TEST_CASES/#input-transfers_invalid_batchjson","title":"Input: <code>transfers_invalid_batch.json</code>","text":"<p>11 transfer items (2 valid, 9 invalid):</p> <pre><code>[\n  {\n    \"date\": \"2026-02-23\",\n    \"from_account\": \"TWH - Personal\",\n    \"to_account\": \"TWH IB USD\",\n    \"amount\": \"100.00\",\n    \"notes\": \"INVALID BATCH: Item 1 - Valid (for comparison)\"\n  },\n  {\n    \"date\": \"2026-02-23\",\n    \"from_account\": \"TWH - Personal\",\n    \"to_account\": \"TWH IB USD\",\n    \"amount\": \"-50.00\",\n    \"notes\": \"INVALID BATCH: Item 2 - Negative amount\"\n  },\n  {\n    \"date\": \"2026-02-23\",\n    \"from_account\": \"TWH - Personal\",\n    \"to_account\": \"TWH IB USD\",\n    \"amount\": \"0.00\",\n    \"notes\": \"INVALID BATCH: Item 3 - Zero amount\"\n  },\n  {\n    \"date\": \"2026-02-23\",\n    \"from_account\": \"TWH - Personal\",\n    \"to_account\": \"TWH IB USD\",\n    \"amount\": \"75.00\",\n    \"currency\": \"SGD\",\n    \"currency_amount\": \"75.00\",\n    \"notes\": \"INVALID BATCH: Item 4 - Over-specified (no exchange_rate)\"\n  },\n  {\n    \"date\": \"2026-02-23\",\n    \"from_account\": \"TWH - Personal\",\n    \"to_account\": \"TWH IB USD\",\n    \"currency\": \"USD\",\n    \"currency_amount\": \"60.00\",\n    \"notes\": \"INVALID BATCH: Item 5 - Currency mismatch (USD not from_account)\"\n  },\n  {\n    \"date\": \"2026-02-23\",\n    \"from_account\": \"Nonexistent Account\",\n    \"to_account\": \"TWH IB USD\",\n    \"amount\": \"100.00\",\n    \"notes\": \"INVALID BATCH: Item 6 - Nonexistent from_account\"\n  },\n  {\n    \"date\": \"2026-02-23\",\n    \"from_account\": \"TWH - Personal\",\n    \"to_account\": \"Nonexistent Account\",\n    \"amount\": \"100.00\",\n    \"notes\": \"INVALID BATCH: Item 7 - Nonexistent to_account\"\n  },\n  {\n    \"date\": \"2026-02-23\",\n    \"from_account\": \"TWH - Personal\",\n    \"to_account\": \"TWH - Personal\",\n    \"amount\": \"100.00\",\n    \"notes\": \"INVALID BATCH: Item 8 - Same from and to account\"\n  },\n  {\n    \"date\": \"2026-02-23\",\n    \"from_account\": \"TWH - Personal\",\n    \"to_account\": \"TWH IB USD\",\n    \"notes\": \"INVALID BATCH: Item 9 NoAmount\"\n  },\n  {\n    \"date\": \"2026-02-23\",\n    \"from_account\": \"TWH - Personal\",\n    \"to_account\": \"TWH IB USD\",\n    \"currency\": \"EUR\",\n    \"currency_amount\": \"70.00\",\n    \"notes\": \"INVALID BATCH: Item 10 ThirdCurrency\"\n  },\n  {\n    \"date\": \"2026-02-23\",\n    \"from_account\": \"TWH IB USD\",\n    \"to_account\": \"TWH - Personal\",\n    \"amount\": \"250.00\",\n    \"notes\": \"INVALID BATCH: Item 11 Valid\"\n  }\n]\n</code></pre>"},{"location":"tests/BATCH_TRANSFER_TEST_CASES/#expected-command-output","title":"Expected Command Output","text":"<pre><code>Batch import completed\n  Successful: 2\n  Failed: 9\n\nFailed records:\n  2026-02-23 TWH - Personal -&gt; TWH IB USD: Invalid amount (must be positive)\n  2026-02-23 TWH - Personal -&gt; TWH IB USD: Invalid amount (must be positive)\n  2026-02-23 TWH - Personal -&gt; TWH IB USD: Cannot specify both amount and currency_amount without exchange_rate\n  2026-02-23 TWH - Personal -&gt; TWH IB USD: Transfer currency must match from_account currency\n  2026-02-23 Nonexistent Account -&gt; TWH IB USD: Account not found: Nonexistent Account\n  2026-02-23 TWH - Personal -&gt; Nonexistent Account: Account not found: Nonexistent Account\n  2026-02-23 TWH - Personal -&gt; TWH - Personal: From and to accounts must be different\n  2026-02-23 TWH - Personal -&gt; TWH IB USD: Amount or currency_amount must be specified\n  2026-02-23 TWH - Personal -&gt; TWH IB USD: Currency must match from_account or to_account\n</code></pre>"},{"location":"tests/BATCH_TRANSFER_TEST_CASES/#expected-results_1","title":"Expected Results","text":"<p>Successful (2 created):</p> <ul> <li>\u2705 Item 1: SGD-&gt;USD, 100 (valid)</li> <li>\u2705 Item 11: USD-&gt;SGD, 250 (valid)</li> </ul> <p>Failed (9 rejected):</p> <ul> <li>\u274c Item 2: Negative amount (-50.00)</li> <li>\u274c Item 3: Zero amount (0.00)</li> <li>\u274c Item 4: Over-specified (amount + currency_amount, no rate)</li> <li>\u274c Item 5: Currency mismatch (USD doesn't match from_account SGD)</li> <li>\u274c Item 6: Nonexistent from_account</li> <li>\u274c Item 7: Nonexistent to_account</li> <li>\u274c Item 8: Same from and to account</li> <li>\u274c Item 9: Missing amount and currency_amount</li> <li>\u274c Item 10: 3rd currency (EUR doesn't match from_account SGD or to_account USD)</li> </ul>"},{"location":"tests/BATCH_TRANSFER_TEST_CASES/#validation","title":"Validation","text":"<ul> <li>\u2705 Only 2 transfers created in database</li> <li>\u2705 Only 2 SyncUpdate records created</li> <li>\u2705 Failed items produce clear, specific error messages</li> <li>\u2705 Only 2 transfers visible in mobile app (Items 1 and 11)</li> <li>\u2705 No mobile app data for any failed items</li> <li>\u2705 Processing continued for all items despite errors (no early termination)</li> </ul>"},{"location":"tests/BATCH_TRANSFER_TEST_CASES/#running-the-tests","title":"Running the Tests","text":""},{"location":"tests/BATCH_TRANSFER_TEST_CASES/#run-valid-batch-test","title":"Run Valid Batch Test","text":"<pre><code>python tests/manual/manual_test_runner.py --test-id uat_batch_transfer_valid\n</code></pre>"},{"location":"tests/BATCH_TRANSFER_TEST_CASES/#run-invalid-batch-test","title":"Run Invalid Batch Test","text":"<pre><code>python tests/manual/manual_test_runner.py --test-id uat_batch_transfer_invalid\n</code></pre>"},{"location":"tests/BATCH_TRANSFER_TEST_CASES/#view-available-batch-tests","title":"View Available Batch Tests","text":"<pre><code>python tests/manual/manual_test_runner.py --list | grep batch_transfer\n</code></pre>"},{"location":"tests/BATCH_TRANSFER_TEST_CASES/#batch-testing-benefits","title":"Batch Testing Benefits","text":"<ol> <li>Efficiency: Test 7+ scenarios in single batch instead of 7+ individual test runs</li> <li>Error Handling: Validate error reporting and continue-on-error behavior</li> <li>Parsing Error Visibility: Verify parsing errors are displayed (not silently dropped)</li> <li>Sync Validation: Verify SyncUpdates are created correctly for batch operations</li> <li>Real-world Usage: Users often import transfers from external systems (spreadsheets, other apps)</li> <li>Cross-scenario Coverage: Mix of base\u2192foreign, foreign\u2192base, foreign\u2192foreign, same-currency, inferred vs explicit in one test</li> <li>Specification Methods: Tests both inference (amount only) and explicit specification (currency + currency_amount)</li> </ol>"},{"location":"tests/BATCH_TRANSFER_TEST_CASES/#cleanup","title":"Cleanup","text":"<p>Both Tests Now Use Automated Rollback:</p> <ul> <li>Test runner records transfer keys from batch output</li> <li>Automated rollback step uses <code>hb batch run</code> with <code>rollback_transfers.json</code> template</li> <li>Template expands <code>{TRANSFER_KEYS}</code> to individual delete operations</li> </ul> <p>Manual Cleanup (if needed): <pre><code>python tests/manual/find_and_delete_transfers.py --date 2026-02-22 --from-account \"TWH - Personal\" --to-account \"TWH IB USD\" --amount 200.00\n</code></pre></p>"},{"location":"tests/BATCH_TRANSFER_TEST_CASES/#json-format-reference","title":"JSON Format Reference","text":"<p>Required Fields:</p> <ul> <li><code>date</code> - YYYY-MM-DD format</li> <li><code>from_account</code> - Account name (must exist)</li> <li><code>to_account</code> - Account name (must exist)</li> <li><code>amount</code> - Decimal value (for inference) OR explicitly specify<code>currency</code> + <code>currency_amount</code></li> </ul> <p>Optional Fields:</p> <ul> <li><code>notes</code> - Transfer notes/description</li> <li><code>currency</code> - Must match from_account currency (inferred if not specified)</li> <li><code>currency_amount</code> - Amount in from_account currency (inferred if not specified)</li> </ul> <p>Validation Rules:</p> <ul> <li>Cannot specify both <code>amount</code> and <code>currency_amount</code> without <code>exchange_rate</code> (ambiguous)</li> <li><code>currency</code> must match <code>from_account</code> currency (if specified)</li> <li><code>amount</code> and <code>currency_amount</code> must be positive (&gt; 0)</li> <li>From and to accounts must be different</li> <li>From and to accounts must exist in database</li> </ul>"},{"location":"tests/TRANSFER_TEST_CASES/","title":"Transfer UAT Test Cases - Comprehensive Guide","text":"<p>This document describes the comprehensive batch of transfer UAT test cases added to <code>tests/manual/manual_tests.json</code>.</p>"},{"location":"tests/TRANSFER_TEST_CASES/#test-coverage-overview","title":"Test Coverage Overview","text":"<p>Total Transfer Tests: 6 test cases covering:</p> <ul> <li>\u2705 3 Amount-only inference scenarios (base\u2192foreign, foreign\u2192base, foreign\u2192foreign)</li> <li>\u2705 3 Batch transfer scenarios (valid transfers and multiple items with error handling)</li> </ul>"},{"location":"tests/TRANSFER_TEST_CASES/#valid-test-scenarios","title":"Valid Test Scenarios","text":""},{"location":"tests/TRANSFER_TEST_CASES/#1-amount-only-inference-tests","title":"1. Amount-Only Inference Tests","text":"<p>These test the automatic currency inference based on account currencies:</p>"},{"location":"tests/TRANSFER_TEST_CASES/#uat_transfer_amount_only_base_to_foreign","title":"<code>uat_transfer_amount_only_base_to_foreign</code>","text":"<ul> <li>From: TWH - Personal (SGD base)</li> <li>To: TWH IB USD (USD foreign)</li> <li>Input: <code>--amount 250.00</code></li> <li>Expected:</li> <li><code>currency=SGD</code> (from_account currency)</li> <li><code>currency_amount=250</code> (from_account amount)</li> <li> <p><code>amount\u2248185</code> (to_account amount = 250/1.35)</p> </li> <li> <p>Validates: Base\u2192Foreign conversion with inferred currency_amount</p> </li> </ul>"},{"location":"tests/TRANSFER_TEST_CASES/#uat_transfer_amount_only_foreign_to_base","title":"<code>uat_transfer_amount_only_foreign_to_base</code>","text":"<ul> <li>From: TWH IB USD (USD foreign)</li> <li>To: TWH - Personal (SGD base)</li> <li>Input: <code>--amount 300.00</code> (amount to receive in base)</li> <li>Expected:</li> <li><code>currency=USD</code> (from_account currency)</li> <li><code>currency_amount\u2248222</code> (from_account amount = 300/1.35)</li> <li> <p><code>amount=300</code> (to_account amount)</p> </li> <li> <p>Validates: Foreign\u2192Base conversion with inferred currency_amount</p> </li> </ul>"},{"location":"tests/TRANSFER_TEST_CASES/#uat_transfer_amount_only_foreign_to_foreign","title":"<code>uat_transfer_amount_only_foreign_to_foreign</code>","text":"<ul> <li>From: TWH IB USD (USD foreign)</li> <li>To: TWH EUR (EUR foreign)</li> <li>Input: <code>--amount 150.00</code> (amount in from_currency)</li> <li>Expected:</li> <li><code>currency=USD</code> (from_account currency)</li> <li><code>currency_amount=150</code> (from_account amount)</li> <li> <p><code>amount</code> calculated using cross-rate (USD/EUR)</p> </li> <li> <p>Validates: Foreign\u2192Foreign conversion with cross-rate calculation</p> </li> </ul>"},{"location":"tests/TRANSFER_TEST_CASES/#running-the-tests","title":"Running the Tests","text":""},{"location":"tests/TRANSFER_TEST_CASES/#run-all-transfer-tests","title":"Run All Transfer Tests","text":"<pre><code>python tests/manual/manual_test_runner.py --test-id uat_transfer_amount_only_base_to_foreign\n</code></pre>"},{"location":"tests/TRANSFER_TEST_CASES/#run-specific-test-category","title":"Run Specific Test Category","text":"<pre><code># Amount-only tests\npython tests/manual/manual_test_runner.py --test-id uat_transfer_amount_only_base_to_foreign\npython tests/manual/manual_test_runner.py --test-id uat_transfer_amount_only_foreign_to_base\npython tests/manual/manual_test_runner.py --test-id uat_transfer_amount_only_foreign_to_foreign\n\n# Batch transfer tests\npython tests/manual/manual_test_runner.py --test-id uat_batch_transfer_valid\npython tests/manual/manual_test_runner.py --test-id uat_batch_transfer_invalid\n</code></pre>"},{"location":"tests/TRANSFER_TEST_CASES/#run-all-transfer-tests-batch","title":"Run All Transfer Tests (Batch)","text":"<pre><code># Use the UAT runner to execute all transfer tests\npython tests/manual/run_uat_tests.py | grep transfer\n</code></pre>"},{"location":"tests/TRANSFER_TEST_CASES/#key-validation-points-for-manual-testing","title":"Key Validation Points for Manual Testing","text":""},{"location":"tests/TRANSFER_TEST_CASES/#for-valid-transfers","title":"For Valid Transfers","text":"<ol> <li>\u2705 Verify SyncUpdate is created for each transfer</li> <li>\u2705 Verify transfer appears in Windows app and mobile app</li> <li>\u2705 Verify currency and currency_amount are correct in app display</li> <li>\u2705 Verify from_account and to_account amounts are different for cross-currency</li> <li>\u2705 Verify from_account and to_account amounts are equal for same-currency</li> <li>\u2705 Verify delete creates SyncUpdate and removes from both apps</li> </ol>"},{"location":"tests/TRANSFER_TEST_CASES/#for-invalid-transfers","title":"For Invalid Transfers","text":"<ol> <li>\u2705 Verify appropriate error message is shown</li> <li>\u2705 Verify no transfer is created in database</li> <li>\u2705 Verify no SyncUpdate is created</li> <li>\u2705 Verify app remains consistent (no orphaned data)</li> </ol>"},{"location":"tests/TRANSFER_TEST_CASES/#test-execution-dependencies","title":"Test Execution Dependencies","text":"<p>Prerequisites for running full test suite:</p> <ul> <li>Database must have accounts:</li> <li><code>TWH - Personal</code> (SGD base)</li> <li><code>TWH IB USD</code> (USD foreign)</li> <li>Forex rates available for USD/SGD and EUR conversions</li> </ul> <p>Prerequisites for sync validation:</p> <ul> <li>Mobile app configured and on same WiFi network</li> <li>Mobile app synced before running tests</li> <li>API server accessible for SyncUpdate updates</li> </ul>"},{"location":"tests/TRANSFER_TEST_CASES/#coverage-matrix","title":"Coverage Matrix","text":"Test Scenario Base\u2192Foreign Foreign\u2192Base Foreign\u2192Foreign Same Currency Amount only \u2705 \u2705 \u2705 \u2705 Full spec \u2705 \u2705 \u2705 N/A Invalid: Over-spec \u2705 \u2705 \u2705 \u2705 Invalid: Missing field \u2705 \u2705 \u2705 \u2705 Invalid: 3rd currency \u2705 \u2705 \u2705 N/A Invalid: Wrong currency \u2705 \u2705 \u2705 N/A Invalid: Negative amount \u2705 \u2705 \u2705 \u2705 Invalid: Zero amount \u2705 \u2705 \u2705 \u2705 Invalid: Bad rate \u2705 \u2705 \u2705 N/A Invalid: Account constraints \u2705 \u2705 \u2705 \u2705"},{"location":"tests/TRANSFER_TEST_CASES/#maintenance-notes","title":"Maintenance Notes","text":"<p>When updating transfer business logic:</p> <ol> <li>Add corresponding test case if new feature/scenario</li> <li>Update invalid test cases if validation rules change</li> <li>Update expected values if forex conversion logic changes</li> <li>Document any new test prerequisites</li> <li>Verify all existing tests still pass after changes</li> </ol>"},{"location":"tests/feature_5.1_expense_crud/","title":"Manual test for expense CRUD","text":""},{"location":"tests/feature_5.1_expense_crud/#table-of-contents","title":"Table of contents","text":"<ul> <li>Purpose</li> <li>Prerequisites</li> <li>Test procedure</li> <li>Results</li> </ul>"},{"location":"tests/feature_5.1_expense_crud/#purpose","title":"Purpose","text":"<p>User acceptance test to validate expense create, read, update, and delete operations with sync confirmation in the HomeBudget apps.</p>"},{"location":"tests/feature_5.1_expense_crud/#prerequisites","title":"Prerequisites","text":"<ul> <li>HomeBudget Windows app installed and running</li> <li>HomeBudget mobile app available for sync checks</li> <li>Live HomeBudget database configured and connected to the apps</li> <li>Copy <code>config/hb-config.json.sample</code> to <code>%USERPROFILE%/OneDrive/Documents/HomeBudgetData/hb-config.json</code></li> <li>Edit the config file to set <code>db_path</code> to your operational homebudget.db</li> <li> <p>Or use <code>--db</code> flag to specify your operational database path</p> </li> <li> <p>Wrapper environment activated</p> </li> <li>Package installed in editable mode</li> </ul>"},{"location":"tests/feature_5.1_expense_crud/#test-procedure","title":"Test procedure","text":"<ol> <li>User action: record the current expense count in the Windows app</li> <li>Automated: add an expense with the wrapper (uses config database by default)</li> </ol> <pre><code>homebudget expense add \\\n  --date 2026-02-16 \\\n  --category Dining \\\n  --subcategory Restaurant \\\n  --amount 25.50 \\\n  --account Wallet \\\n  --notes \"TDD Test Expense\"\n</code></pre> <p>Note: To use a specific database, add <code>--db &lt;path_to_your_homebudget.db&gt;</code></p> <ol> <li>Automated: verify a new SyncUpdate entry exists</li> </ol> <pre><code>python tests/manual/verify_syncupdate.py\n</code></pre> <ol> <li>User action: confirm the new expense appears in the Windows app</li> <li>User action: wait for sync and confirm the expense appears in the mobile app</li> <li>Automated: locate the new expense key using the list command</li> </ol> <pre><code>homebudget expense list --limit 5\n</code></pre> <ol> <li>Automated: update the expense amount with the wrapper using the new key</li> </ol> <pre><code>homebudget expense update KEY \\\n  --amount 27.50 \\\n  --notes \"TDD Test Expense updated\"\n</code></pre> <ol> <li>User action: confirm the expense amount update in the Windows app</li> <li>Automated: delete the expense with the wrapper using the new key</li> </ol> <pre><code>homebudget expense delete KEY --yes\n</code></pre> <ol> <li>User action: confirm the expense is removed in the Windows app</li> <li>User action: wait for sync and confirm the deletion in the mobile app</li> <li>Record results and any notes</li> </ol>"},{"location":"tests/feature_5.1_expense_crud/#results","title":"Results","text":"<ul> <li>Result status</li> <li>Notes</li> <li>Timestamp</li> </ul>"},{"location":"tests/feature_5.3_transfer_crud/","title":"Manual test for transfer CRUD","text":""},{"location":"tests/feature_5.3_transfer_crud/#table-of-contents","title":"Table of contents","text":"<ul> <li>Purpose</li> <li>Prerequisites</li> <li>Test procedure</li> <li>Results</li> </ul>"},{"location":"tests/feature_5.3_transfer_crud/#purpose","title":"Purpose","text":"<p>User acceptance test to validate transfer create, read, update, and delete operations with sync confirmation in the HomeBudget apps.</p>"},{"location":"tests/feature_5.3_transfer_crud/#prerequisites","title":"Prerequisites","text":"<ul> <li>HomeBudget Windows app installed and running</li> <li>HomeBudget mobile app available for sync checks</li> <li>Live HomeBudget database configured and connected to the apps</li> <li>Copy <code>config/hb-config.json.sample</code> to <code>%USERPROFILE%/OneDrive/Documents/HomeBudgetData/hb-config.json</code></li> <li>Edit the config file to set <code>db_path</code> to your operational homebudget.db</li> <li> <p>Or use <code>--db</code> flag to specify your operational database path</p> </li> <li> <p>Wrapper environment activated</p> </li> <li>Package installed in editable mode</li> </ul>"},{"location":"tests/feature_5.3_transfer_crud/#test-procedure","title":"Test procedure","text":"<ol> <li>User action: record the current transfer count in the Windows app</li> <li>Automated: add a transfer with the wrapper (uses config database by default)</li> </ol> <pre><code>homebudget transfer add \\\n  --date 2026-02-20 \\\n  --from-account \"Bank TWH SGD\" \\\n  --to-account \"Wallet\" \\\n  --amount 200.00 \\\n  --notes \"TDD Test Transfer\"\n</code></pre> <p>Note: To use a specific database, add <code>--db &lt;path_to_your_homebudget.db&gt;</code></p> <ol> <li>Automated: verify a new SyncUpdate entry exists</li> </ol> <pre><code>python tests/manual/verify_syncupdate.py\n</code></pre> <ol> <li>User action: confirm the new transfer appears in the Windows app</li> <li>User action: wait for sync and confirm the transfer appears in the mobile app</li> <li>Automated: locate the new transfer key using the list command</li> </ol> <pre><code>homebudget transfer list --limit 5\n</code></pre> <ol> <li>Automated: update the transfer amount with the wrapper using the new key</li> </ol> <pre><code>homebudget transfer update KEY \\\n  --amount 250.00 \\\n  --notes \"TDD Test Transfer updated\"\n</code></pre> <ol> <li>User action: confirm the transfer amount update in the Windows app</li> <li>Automated: delete the transfer with the wrapper using the new key</li> </ol> <pre><code>homebudget transfer delete KEY --yes\n</code></pre> <ol> <li>User action: confirm the transfer is removed in the Windows app</li> <li>User action: wait for sync and confirm the deletion in the mobile app</li> <li>Record results and any notes</li> </ol>"},{"location":"tests/feature_5.3_transfer_crud/#results","title":"Results","text":"<ul> <li>Result status</li> <li>Notes</li> <li>Timestamp</li> </ul>"},{"location":"tests/sync_validation_procedure/","title":"Sync validation procedure","text":""},{"location":"tests/sync_validation_procedure/#table-of-contents","title":"Table of contents","text":"<ul> <li>Purpose</li> <li>Prerequisites</li> <li>Test procedure</li> <li>Results</li> </ul>"},{"location":"tests/sync_validation_procedure/#purpose","title":"Purpose","text":"<p>User acceptance test to validate that SyncUpdate entries created by the wrapper appear in the HomeBudget apps.</p>"},{"location":"tests/sync_validation_procedure/#prerequisites","title":"Prerequisites","text":"<ul> <li>HomeBudget Windows app installed and running</li> <li>HomeBudget mobile app available for sync checks</li> <li>Live HomeBudget database configured and connected to the apps</li> <li>Copy <code>config/hb-config.json.sample</code> to <code>%USERPROFILE%/OneDrive/Documents/HomeBudgetData/hb-config.json</code></li> <li>Edit the config file to set <code>db_path</code> to your operational homebudget.db</li> <li> <p>Or use <code>--db</code> flag to specify your operational database path</p> </li> <li> <p>Wrapper environment activated</p> </li> </ul>"},{"location":"tests/sync_validation_procedure/#test-procedure","title":"Test procedure","text":"<ol> <li>User action: record the current transaction count in the Windows app</li> <li>Automated: add a test expense with the wrapper</li> <li>Automated: verify a new SyncUpdate entry exists</li> <li>User action: confirm the new expense appears in the Windows app</li> <li>User action: wait for sync and confirm the expense appears in the mobile app</li> <li>Record results and any notes</li> </ol>"},{"location":"tests/sync_validation_procedure/#results","title":"Results","text":"<ul> <li>Result status</li> <li>Notes</li> <li>Timestamp</li> </ul>"}]}